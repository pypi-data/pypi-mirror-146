"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_alerts_rules_index_tsx"],{"./app/components/alertBadge.tsx":(e,t,s)=>{s.d(t,{Z:()=>c});var a=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=s("./app/icons/index.tsx"),n=s("./app/locale.tsx"),i=s("./app/styles/space.tsx"),o=s("./app/views/alerts/types.tsx"),l=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function d(e){let{status:t,hideText:s=!1,isIssue:a}=e,i=(0,n.t)("Resolved"),d=r.DL,c="green300";return a?(i=(0,n.t)("Issue"),d=r.XI,c="gray300"):t===o.vt.CRITICAL?(i=(0,n.t)("Critical"),d=r.zC,c="red300"):t===o.vt.WARNING&&(i=(0,n.t)("Warning"),d=r.qV,c="yellow300"),(0,l.BX)(p,{"data-test-id":"alert-badge",children:[(0,l.BX)(u,{color:c,icon:d,children:[(0,l.tZ)(m,{color:c}),(0,l.tZ)(d,{color:"white"})]}),!s&&(0,l.tZ)(h,{color:c,children:i})]})}d.displayName="AlertBadge";const c=d,p=(0,a.Z)("div",{target:"ef4c9wd3"})({name:"s5xdrg",styles:"display:flex;align-items:center"}),u=(0,a.Z)("div",{target:"ef4c9wd2"})("width:36px;height:36px;position:relative;svg:last-child{width:",(e=>e.icon===r.XI?"13px":"16px"),";z-index:2;position:absolute;top:0;bottom:0;left:0;right:0;margin:auto;}"),m=(0,a.Z)(r.Sq,{target:"ef4c9wd1"})({name:"bgbjt4",styles:"width:36px;height:36px"}),h=(0,a.Z)("div",{target:"ef4c9wd0"})("margin-left:",(0,i.Z)(1),";")},"./app/views/alerts/rules/index.tsx":(e,t,s)=>{s.r(t),s.d(t,{default:()=>ae});var a=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),n=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/react/index.js")),i=s("./app/actionCreators/indicator.tsx"),o=s("./app/components/asyncComponent.tsx"),l=s("./app/components/layouts/thirds.tsx"),d=s("./app/components/links/link.tsx"),c=s("./app/components/organizations/pageFilters/container.tsx"),p=s("./app/components/pagination.tsx"),u=s("./app/components/panels/index.tsx"),m=s("./app/components/sentryDocumentTitle.tsx"),h=s("./app/icons/index.tsx"),g=s("./app/locale.tsx"),x=s("./app/utils/analytics/trackAdvancedAnalyticsEvent.tsx"),Z=s("./app/utils/projects.tsx"),v=s("./app/utils/teams.tsx"),y=s("./app/utils/withPageFilters.tsx"),w=s("./app/views/alerts/filterBar.tsx"),f=s("./app/views/alerts/list/header.tsx"),I=s("./app/views/alerts/types.tsx"),b=s("./app/views/alerts/utils/index.tsx"),C=s("../node_modules/lodash/memoize.js"),A=s.n(C),q=s("./app/components/acl/access.tsx"),T=s("./app/components/alertBadge.tsx"),j=s("./app/components/avatar/actorAvatar.tsx"),L=s("./app/components/confirm.tsx"),B=s("./app/components/dateTime.tsx"),_=s("./app/components/dropdownMenuControlV2.tsx"),R=s("./app/components/errorBoundary.tsx"),z=s("./app/components/idBadge/index.tsx"),S=s("./app/components/timeSince.tsx"),k=s("./app/components/tooltip.tsx"),E=s("./app/styles/overflowEllipsis.tsx"),$=s("./app/styles/space.tsx"),D=s("./app/utils/getDynamicText.tsx"),G=s("./app/views/alerts/incidentRules/types.tsx"),N=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const X=A()(((e,t)=>t.find((t=>t.slug===e))));function F(e){var t,s,a,r,n;let{rule:i,projectsLoaded:o,projects:l,orgId:c,onDelete:p,userTeams:u}=e;const m=void 0!==(null===(t=i.latestIncident)||void 0===t?void 0:t.status)&&[I.vt.CRITICAL,I.vt.WARNING].includes(i.latestIncident.status),x=i.projects[0],Z=`/organizations/${c}/alerts/${(0,b.Gm)(i)?"rules":"metric-rules"}/${x}/${i.id}/`,v=`/organizations/${c}/alerts/rules/details/${i.id}/`,y=null===(s=i.owner)||void 0===s?void 0:s.split(":")[1],w=y?{type:"team",id:y,name:""}:null,f=!y||u.has(y),C=(0,b.Gm)(i)?(0,N.tZ)(d.Z,{to:`/organizations/${c}/alerts/rules/${i.projects[0]}/${i.id}/details/`,children:i.name}):(0,N.tZ)(V,{to:(0,b.Gm)(i)?Z:v,children:i.name}),A={[I.vt.CRITICAL]:(0,g.t)("Critical"),[I.vt.WARNING]:(0,g.t)("Warning"),[I.vt.CLOSED]:(0,g.t)("Resolved"),[I.vt.OPENED]:(0,g.t)("Resolved")},B=[{key:"edit",label:(0,g.t)("Edit"),to:Z},{key:"delete",label:(0,g.t)("Delete"),priority:"danger",onAction:()=>{(0,L._)({onConfirm:()=>p(x,i),header:(0,g.t)("Delete Alert Rule?"),message:(0,g._N)("Are you sure you want to delete [name]? You won't be able to view the history of this alert once it's deleted.",{name:i.name}),confirmText:(0,g.t)("Delete Rule"),priority:"danger"})}}];return(0,N.BX)(R.Z,{children:[(0,N.BX)(W,{isIssueAlert:(0,b.Gm)(i),children:[(0,N.tZ)(P,{children:(0,N.tZ)(k.ZP,{title:(0,b.Gm)(i)?(0,g.t)("Issue Alert"):(0,g._N)("Metric Alert Status: [status]",{status:A[null!==(a=null==i||null===(r=i.latestIncident)||void 0===r?void 0:r.status)&&void 0!==a?a:I.vt.CLOSED]}),children:(0,N.tZ)(T.Z,{status:null==i||null===(n=i.latestIncident)||void 0===n?void 0:n.status,isIssue:(0,b.Gm)(i),hideText:!0})})}),(0,N.BX)(O,{children:[(0,N.tZ)(M,{children:C}),(0,N.tZ)(U,{children:!(0,b.Gm)(i)&&((0,b.Gm)(i)?null:i.latestIncident?m?(0,N.BX)("div",{children:[(0,g.t)("Triggered "),(0,N.tZ)(S.Z,{date:i.latestIncident.dateCreated})]}):(0,N.BX)("div",{children:[(0,g.t)("Resolved "),(0,N.tZ)(S.Z,{date:i.latestIncident.dateClosed})]}):"-")})]})]}),(0,N.tZ)(P,{children:function(){var e,t;if((0,b.Gm)(i))return null;const s=i.triggers.find((e=>{let{label:t}=e;return t===G.F4.CRITICAL})),a=i.triggers.find((e=>{let{label:t}=e;return t===G.F4.WARNING})),r=i.resolveThreshold,n=m&&(null===(e=i.latestIncident)||void 0===e?void 0:e.status)===I.vt.CRITICAL?s:null!=a?a:s;let o,l="green300",d=m&&i.thresholdType===G.lT.ABOVE?(0,g.t)("Above"):(0,g.t)("Below");return m?(l=(null==n?void 0:n.label)===G.F4.CRITICAL?"red300":(null==n?void 0:n.label)===G.F4.WARNING?"yellow300":"green300",o=i.thresholdType===G.lT.ABOVE?"up":"down"):(o=i.thresholdType===G.lT.ABOVE?"down":"up",d=i.thresholdType===G.lT.ABOVE?(0,g.t)("Below"):(0,g.t)("Above")),(0,N.BX)(P,{children:[(0,N.tZ)(h.CC,{color:l,direction:o}),(0,N.tZ)(J,{children:`${d} ${i.latestIncident||!i.latestIncident&&!r?null==n||null===(t=n.alertThreshold)||void 0===t?void 0:t.toLocaleString():null==r?void 0:r.toLocaleString()}`})]})}()}),(0,N.tZ)(P,{children:(0,N.tZ)(K,{children:(0,N.tZ)(Y,{avatarSize:18,project:o?X(x,l):{slug:x}})})}),(0,N.tZ)(P,{children:w?(0,N.tZ)(j.Z,{actor:w,size:24}):"-"}),(0,N.tZ)(P,{children:(0,N.tZ)(H,{date:(0,D.Z)({value:i.dateCreated,fixed:new Date("2021-04-20")}),format:"ll"})}),(0,N.tZ)(Q,{children:(0,N.tZ)(q.Z,{access:["alerts:write"],children:e=>{let{hasAccess:t}=e;return(0,N.tZ)(_.Z,{items:B,placement:"bottom right",triggerProps:{"aria-label":(0,g.t)("Show more"),size:"xsmall",icon:(0,N.tZ)(h.YR,{size:"xs"}),showChevron:!1},disabledKeys:t&&f?[]:["delete"]})}})})]})}F.displayName="RuleListRow";const V=(0,r.Z)(d.Z,{target:"e1f6xqs310"})(E.Z,";"),P=(0,r.Z)("div",{target:"e1f6xqs39"})({name:"s5xdrg",styles:"display:flex;align-items:center"}),W=(0,r.Z)(P,{target:"e1f6xqs38"})("position:relative;",(e=>e.isIssueAlert&&`padding: ${(0,$.Z)(3)} ${(0,$.Z)(2)}; line-height: 2.4;`),";"),O=(0,r.Z)("div",{target:"e1f6xqs37"})(E.Z," margin-left:",(0,$.Z)(2),";line-height:1.35;"),M=(0,r.Z)("div",{target:"e1f6xqs36"})(E.Z," font-size:",(e=>e.theme.fontSizeLarge),";@media (max-width: ",(e=>e.theme.breakpoints[3]),"){max-width:300px;}@media (max-width: ",(e=>e.theme.breakpoints[2]),"){max-width:165px;}@media (max-width: ",(e=>e.theme.breakpoints[1]),"){max-width:100px;}"),U=(0,r.Z)("div",{target:"e1f6xqs35"})("color:",(e=>e.theme.gray300),";"),K=(0,r.Z)("div",{target:"e1f6xqs34"})({name:"1d3w5wq",styles:"width:100%"}),Y=(0,r.Z)(z.Z,{target:"e1f6xqs33"})({name:"ozd7xs",styles:"flex-shrink:0"}),H=(0,r.Z)(B.Z,{target:"e1f6xqs32"})("font-variant-numeric:tabular-nums;color:",(e=>e.theme.gray300),";"),J=(0,r.Z)("div",{target:"e1f6xqs31"})("margin-left:",(0,$.Z)(1),";white-space:nowrap;font-variant-numeric:tabular-nums;"),Q=(0,r.Z)(P,{target:"e1f6xqs30"})("justify-content:center;padding:",(0,$.Z)(1),";"),ee=F;class te extends o.Z{constructor(){super(...arguments),(0,a.Z)(this,"handleChangeFilter",((e,t)=>{const{router:s,location:a}=this.props,{cursor:r,page:n,...i}=a.query,o=[...t];s.push({pathname:a.pathname,query:{...i,team:o.length?o:""}})})),(0,a.Z)(this,"handleChangeSearch",(e=>{const{router:t,location:s}=this.props,{cursor:a,page:r,...n}=s.query;t.push({pathname:s.pathname,query:{...n,name:e}})})),(0,a.Z)(this,"handleDeleteRule",(async(e,t)=>{const{params:s}=this.props,{orgId:a}=s,r=(0,b.Gm)(t)?"rules":"alert-rules";try{await this.api.requestPromise(`/projects/${a}/${e}/${r}/${t.id}/`,{method:"DELETE"}),this.reloadData()}catch(e){(0,i.Iw)((0,g.t)("Error deleting rule"))}}))}getEndpoints(){const{params:e,location:t}=this.props,{query:s}=t;return s.expand=["latestIncident"],s.team=(0,b.LI)(s.team),s.sort||(s.sort=["incident_status","date_triggered"]),[["ruleList",`/organizations/${e&&e.orgId}/combined-rules/`,{query:s}]]}get projectsFromIncidents(){const{ruleList:e=[]}=this.state;return[...new Set(null==e?void 0:e.map((e=>{let{projects:t}=e;return t})).flat())]}renderLoading(){return this.renderBody()}renderList(){const{params:{orgId:e},location:t,router:s}=this.props,{loading:a,ruleList:r=[],ruleListPageLinks:n}=this.state,{query:i}=t,o={asc:"1"===i.asc,field:i.sort||"date_added"},{cursor:d,page:c,...u}=i,m=o.field.includes("incident_status")||o.field.includes("date_triggered"),x=(0,N.tZ)(h.CC,{color:"gray300",size:"xs",direction:o.asc?"up":"down"});return(0,N.tZ)(l.uT,{children:(0,N.BX)(l.or,{fullWidth:!0,children:[(0,N.tZ)(w.Z,{location:t,onChangeFilter:this.handleChangeFilter,onChangeSearch:this.handleChangeSearch}),(0,N.tZ)(v.Z,{provideUserTeams:!0,children:s=>{let{initiallyLoaded:n,teams:i}=s;return(0,N.tZ)(ne,{headers:[(0,N.BX)(re,{role:"columnheader","aria-sort":"name"!==o.field?"none":o.asc?"ascending":"descending",to:{pathname:t.pathname,query:{...u,asc:"name"===o.field&&o.asc?void 0:"1",sort:"name"}},children:[(0,g.t)("Alert Rule")," ","name"===o.field&&x]},"name"),(0,N.BX)(re,{role:"columnheader","aria-sort":m?o.asc?"ascending":"descending":"none",to:{pathname:t.pathname,query:{...u,asc:m&&!o.asc?"1":void 0,sort:["incident_status","date_triggered"]}},children:[(0,g.t)("Status")," ",m&&x]},"status"),(0,g.t)("Project"),(0,g.t)("Team"),(0,N.BX)(re,{role:"columnheader","aria-sort":"date_added"!==o.field?"none":o.asc?"ascending":"descending",to:{pathname:t.pathname,query:{...u,asc:"date_added"!==o.field||o.asc?void 0:"1",sort:"date_added"}},children:[(0,g.t)("Created")," ","date_added"===o.field&&x]},"dateAdded"),(0,g.t)("Actions")],isLoading:a||!n,isEmpty:0===(null==r?void 0:r.length),emptyMessage:(0,g.t)("No alert rules found for the current query."),children:(0,N.tZ)(Z.Z,{orgId:e,slugs:this.projectsFromIncidents,children:t=>{let{initiallyLoaded:s,projects:a}=t;return r.map((t=>(0,N.tZ)(ee,{projectsLoaded:s,projects:a,rule:t,orgId:e,onDelete:this.handleDeleteRule,userTeams:new Set(i.map((e=>e.id)))},`${(0,b.Gm)(t)?I.ok.METRIC:I.ok.ISSUE}-${t.id}`)))}})})}}),(0,N.tZ)(p.Z,{pageLinks:n,onCursor:(e,t,a)=>{let r=u.team;r&&0!==r.length||(r=""),s.push({pathname:t,query:{...u,team:r,cursor:e}})}})]})})}renderBody(){const{params:e,organization:t,router:s}=this.props,{orgId:a}=e;return(0,N.tZ)(m.Z,{title:(0,g.t)("Alerts"),orgSlug:a,children:(0,N.BX)(c.Z,{organization:t,showDateSelector:!1,showEnvironmentSelector:!1,hideGlobalHeader:!0,children:[(0,N.tZ)(f.Z,{organization:t,router:s,activeTab:"rules",projectSlugs:this.projectsFromIncidents}),this.renderList()]})})}}class se extends n.Component{componentDidMount(){this.trackView()}componentDidUpdate(e){var t,s;const{location:a}=this.props;(null===(t=e.location.query)||void 0===t?void 0:t.sort)!==(null===(s=a.query)||void 0===s?void 0:s.sort)&&this.trackView()}trackView(){const{organization:e,location:t}=this.props;(0,x.Z)("alert_rules.viewed",{organization:e,sort:Array.isArray(t.query.sort)?t.query.sort.join(","):t.query.sort})}render(){return(0,N.tZ)(te,{...this.props})}}se.displayName="AlertRulesListContainer";const ae=(0,y.Z)(se),re=(0,r.Z)(d.Z,{target:"eddauwb1"})({name:"1sbdiq8",styles:"color:inherit;:hover{color:inherit;}"}),ne=(0,r.Z)(u.KB,{target:"eddauwb0"})("position:static;overflow:auto;@media (min-width: ",(e=>e.theme.breakpoints[0]),"){overflow:initial;}grid-template-columns:4fr auto 140px 60px 110px auto;white-space:nowrap;font-size:",(e=>e.theme.fontSizeMedium),";")}}]);
//# sourceMappingURL=../sourcemaps/app_views_alerts_rules_index_tsx.076872e30c1d836a97ca32ed655d196c.js.map