"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_components_createAlertButton_tsx"],{"./app/components/createAlertButton.tsx":(e,t,r)=>{r.d(t,{K:()=>v,Z:()=>f});var n=r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),s=(r("../node_modules/core-js/modules/web.dom-collections.iterator.js"),r("../node_modules/core-js/modules/es.string.replace.js"),r("../node_modules/react/index.js")),a=r("../node_modules/react-router/es/index.js"),o=r("./app/actionCreators/indicator.tsx"),i=r("./app/actionCreators/navigation.tsx"),l=r("./app/components/acl/access.tsx"),c=r("./app/components/alert.tsx"),u=r("./app/components/assistant/guideAnchor.tsx"),d=r("./app/components/button.tsx"),p=r("./app/components/links/link.tsx"),E=r("./app/icons/index.tsx"),R=r("./app/locale.tsx"),g=r("./app/utils/discover/fields.tsx"),m=r("./app/utils/useApi.tsx"),A=r("./app/views/alerts/incidentRules/constants.tsx"),y=r("./app/views/alerts/utils/index.tsx"),T=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function S(e){let{incompatibleQuery:t,eventView:r,orgId:n,onClose:a}=e;const{hasProjectError:o,hasEnvironmentError:i,hasEventTypeError:l,hasYAxisError:c}=t,u=Object.values(t).filter((e=>e)).length,g=r.clone();g.query+=" event.type:error";const m=r.clone();m.query+=" event.type:transaction";const A=r.clone();A.query+=" event.type:default";const y=r.clone();y.query+=" event.type:error or event.type:default";const S=`/organizations/${n}/discover/results/`,v={error:(0,T.tZ)(p.Z,{to:{pathname:S,query:g.generateQueryStringObject()}}),default:(0,T.tZ)(p.Z,{to:{pathname:S,query:A.generateQueryStringObject()}}),transaction:(0,T.tZ)(p.Z,{to:{pathname:S,query:m.generateQueryStringObject()}}),errorDefault:(0,T.tZ)(p.Z,{to:{pathname:S,query:y.generateQueryStringObject()}})};return(0,T.BX)(O,{type:"warning",showIcon:!0,trailingItems:(0,T.tZ)(d.ZP,{icon:(0,T.tZ)(E.bM,{size:"sm"}),"aria-label":(0,R.t)("Close"),size:"zero",onClick:a,borderless:!0}),children:[1===u&&(0,T.BX)(s.Fragment,{children:[o&&(0,R.t)("An alert can use data from only one Project. Select one and try again."),i&&(0,R.t)("An alert supports data from a single Environment or All Environments. Pick one try again."),l&&(0,R._N)("An alert needs a filter of [error:event.type:error], [default:event.type:default], [transaction:event.type:transaction], [errorDefault:(event.type:error OR event.type:default)]. Use one of these and try again.",v),c&&(0,R._N)("An alert can’t use the metric [yAxis] just yet. Select another metric and try again.",{yAxis:(0,T.tZ)(_,{children:r.getYAxis()})})]}),u>1&&(0,T.BX)(s.Fragment,{children:[(0,R.t)("Yikes! That button didn’t work. Please fix the following problems:"),(0,T.BX)(N,{children:[o&&(0,T.tZ)("li",{children:(0,R.t)("Select one Project.")}),i&&(0,T.tZ)("li",{children:(0,R.t)("Select a single Environment or All Environments.")}),l&&(0,T.tZ)("li",{children:(0,R._N)("Use the filter [error:event.type:error], [default:event.type:default], [transaction:event.type:transaction], [errorDefault:(event.type:error OR event.type:default)].",v)}),c&&(0,T.tZ)("li",{children:(0,R._N)("An alert can’t use the metric [yAxis] just yet. Select another metric and try again.",{yAxis:(0,T.tZ)(_,{children:r.getYAxis()})})})]})]})]})}function v(e){var t;let{projects:r,eventView:n,organization:s,referrer:a,onIncompatibleQuery:o,onSuccess:i,...l}=e;const c=1!==n.project.length||-1===n.project[0],u=n.environment.length>1,d=null===(0,y.A4)(n.query),p=function(e){var t;const r=(0,g.nr)(e.getYAxis());if("field"===r.kind||"equation"===r.kind||"calculatedField"===r.kind)return!0;const n=e.query.match(/event\.type:(transaction|error)/);if(!n)return!1;const s="error"===n[1]?A.yq:A.Yp,a=!s.aggregations.includes(r.function[0]),o=g.lx[r.function[0]];if(!o)return!1;const i=o.parameters.some((e=>"value"===e.kind&&"number"===e.dataType)),l=["",...s.fields,...null!==(t=s.measurementKeys)&&void 0!==t?t:[]],c=!i&&!l.includes(r.function[1]);return a||c}(n),E={hasProjectError:c,hasEnvironmentError:u,hasEventTypeError:d,hasYAxisError:p},m=r.find((e=>e.id===`${n.project[0]}`)),v=n.generateQueryStringObject();null!==(t=v.query)&&void 0!==t&&t.includes(`project:${null==m?void 0:m.slug}`)&&(v.query=v.query.replace(`project:${null==m?void 0:m.slug}`,""));const f=Object.values(E).some((e=>e)),O=f?void 0:{pathname:`/organizations/${s.slug}/alerts/${null==m?void 0:m.slug}/new/`,query:{...v,createFromDiscover:!0,referrer:a}};return(0,T.tZ)(h,{organization:s,onClick:e=>{if(f)return e.preventDefault(),void o((e=>(0,T.tZ)(S,{incompatibleQuery:E,eventView:n,orgId:s.slug,onClose:e})),E);i()},to:O,"aria-label":(0,R.t)("Create Alert"),...l})}S.displayName="IncompatibleQueryAlert",v.displayName="CreateAlertFromViewButton";const h=(0,a.withRouter)((e=>{let{organization:t,projectSlug:r,iconProps:n,referrer:s,router:a,hideIcon:c,showPermissionGuide:g,...A}=e;const y=(0,m.Z)(),S=e=>{const r=t.features.includes("alert-wizard-v3"),n=r?`/organizations/${t.slug}/alerts`:`/organizations/${t.slug}/alerts/${e}`,a=[s?`referrer=${s}`:"",r&&e&&":projectId"!==e?`project=${e}`:""].filter((e=>""!==e));return`${n}/wizard/${a.length?"?":""}${a.join("&")}`};function v(e){e.preventDefault(),(0,i.T)(S(":projectId"),a)}async function h(){const e=`/organizations/${t.slug}/`;(0,o.E3)();try{await y.requestPromise(e,{method:"PUT",data:{alertsMemberWrite:!0}}),(0,o.S9)((0,R.t)("Successfully updated organization settings"))}catch(e){(0,o.Iw)((0,R.t)("Unable to update organization settings"))}}const f=(0,R._N)("Ask your organization owner or manager to [settingsLink:enable alerts access] for you.",{settingsLink:(0,T.tZ)(p.Z,{to:`/settings/${t.slug}`})}),O=e=>{var t;return(0,T.tZ)(d.ZP,{disabled:!e,title:e?void 0:f,icon:!c&&(0,T.tZ)(E.vr,{...n}),to:r?S(r):void 0,tooltipProps:{isHoverable:!0,position:"top",popperStyle:{maxWidth:"270px"}},onClick:r?void 0:v,...A,children:null!==(t=A.children)&&void 0!==t?t:(0,R.t)("Create Alert")})},N=!t.alertsMemberWrite&&!!g;return(0,T.tZ)(l.Z,{organization:t,access:["alerts:write"],children:e=>{let{hasAccess:r}=e;return N?(0,T.tZ)(l.Z,{organization:t,access:["org:write"],children:e=>{let{hasAccess:t}=e;return(0,T.tZ)(u.Z,{target:t?"alerts_write_owner":"alerts_write_member",onFinish:t?h:void 0,children:O(r)})}}):O(r)}})})),f=h,O=(0,n.Z)(c.Z,{target:"e173ycuj2"})("color:",(e=>e.theme.textColor),";margin-bottom:0;"),N=(0,n.Z)("ul",{target:"e173ycuj1"})({name:"1ykowef",styles:"margin-bottom:0"}),_=(0,n.Z)("code",{target:"e173ycuj0"})({name:"1imza1v",styles:"background-color:transparent;padding:0"})},"./app/views/alerts/incidentRules/constants.tsx":(e,t,r)=>{r.d(t,{b1:()=>i,wT:()=>l,kV:()=>c,Vr:()=>u,Ng:()=>d,hh:()=>p,P1:()=>E,yq:()=>R,KP:()=>A,nM:()=>y,Yp:()=>T,W7:()=>S,ep:()=>v,H9:()=>h,Q6:()=>f}),r("../node_modules/core-js/modules/web.dom-collections.iterator.js");var n=r("./app/locale.tsx"),s=r("./app/utils/performance/vitals/constants.tsx"),a=r("./app/views/alerts/incidentRules/types.tsx"),o=r("./app/views/alerts/utils/index.tsx");const i=1,l=60,c=10080,u="count()",d="p95(transaction.duration)",p={[a.qz.ERRORS]:"event.type:error",[a.qz.TRANSACTIONS]:"event.type:transaction"},E={[a.Yh.ERROR_DEFAULT]:"event.type:[error, default]",[a.Yh.ERROR]:"event.type:error",[a.Yh.DEFAULT]:"event.type:default",[a.Yh.TRANSACTION]:"event.type:transaction"},R={aggregations:["count","count_unique"],fields:["user"]},g=["avg","percentile","p50","p75","p95","p99","p100"],m=[...g,"failure_rate","apdex","count"],A=[{value:5,label:(0,n.t)("same time 5 minutes ago")},{value:15,label:(0,n.t)("same time 15 minutes ago")},{value:60,label:(0,n.t)("same time one hour ago")},{value:1440,label:(0,n.t)("same time one day ago")},{value:10080,label:(0,n.t)("same time one week ago")},{value:43200,label:(0,n.t)("same time one month ago")}];function y(e,t){return"custom"===e&&t===a.qz.ERRORS?R:{aggregations:"apdex"===e||"custom"===e?m:g,fields:["transaction.duration"],measurementKeys:Object.keys(s.r9)}}const T={aggregations:m,fields:["transaction.duration"],measurementKeys:Object.keys(s.r9)};function S(e){return{label:e,alertThreshold:"",actions:[]}}function v(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{dataset:a.qz.ERRORS,eventTypes:[a.GM.ERROR],aggregate:u,query:"",timeWindow:60,thresholdPeriod:1,triggers:[S(a.F4.CRITICAL),S(a.F4.WARNING)],projects:[],environment:null,resolveThreshold:"",thresholdType:a.lT.ABOVE,...e}}function h(e){var t;const r=(0,o.A4)(e.query),n=r?o.Ey[r.source]:o.Ey.error;let s=e.getYAxis();return"transactions"===n.dataset&&/^p\d{2,3}\(\)/.test(e.getYAxis())&&(s=e.getYAxis().slice(0,3)+"(transaction.duration)"),{...v(),...n,query:null!==(t=null==r?void 0:r.query)&&void 0!==t?t:e.query,aggregate:s,environment:e.environment.length?e.environment[0]:null}}function f(e){const{eventTypes:t,aggregate:r,dataset:n}=e,s={};return(0,o.Eb)(r)&&(s.thresholdType=a.lT.BELOW,s.timeWindow=a.Tb.ONE_HOUR),r.includes("apdex")&&(s.thresholdType=a.lT.BELOW),{...v(s),eventTypes:[t],aggregate:r,dataset:n}}},"./app/views/alerts/incidentRules/types.tsx":(e,t,r)=>{r.d(t,{lT:()=>s,F4:()=>a,t6:()=>o,qz:()=>i,GM:()=>l,Yh:()=>c,lK:()=>u,XH:()=>d,Tb:()=>p,Us:()=>E,LO:()=>R,Lm:()=>g,hd:()=>m});var n=r("./app/locale.tsx");let s,a,o,i,l,c,u,d,p,E;!function(e){e[e.ABOVE=0]="ABOVE",e[e.BELOW=1]="BELOW"}(s||(s={})),function(e){e.CRITICAL="critical",e.WARNING="warning",e.RESOLVE="resolve"}(a||(a={})),function(e){e.COUNT="count",e.CHANGE="change"}(o||(o={})),function(e){e.ERRORS="events",e.TRANSACTIONS="transactions",e.SESSIONS="sessions",e.METRICS="metrics"}(i||(i={})),function(e){e.DEFAULT="default",e.ERROR="error",e.TRANSACTION="transaction",e.USER="user",e.SESSION="session"}(l||(l={})),function(e){e.ERROR_DEFAULT="error_default",e.DEFAULT="default",e.ERROR="error",e.TRANSACTION="transaction"}(c||(c={})),function(e){e.CRASH_FREE_SESSIONS="percentage(sessions_crashed, sessions) AS _crash_rate_alert_aggregate",e.CRASH_FREE_USERS="percentage(users_crashed, users) AS _crash_rate_alert_aggregate"}(u||(u={})),function(e){e.SIX_HOURS="6h",e.ONE_DAY="1d",e.THREE_DAYS="3d",e.SEVEN_DAYS="10000m",e.FOURTEEN_DAYS="14d",e.THIRTY_DAYS="30d"}(d||(d={})),function(e){e[e.ONE_MINUTE=1]="ONE_MINUTE",e[e.FIVE_MINUTES=5]="FIVE_MINUTES",e[e.TEN_MINUTES=10]="TEN_MINUTES",e[e.FIFTEEN_MINUTES=15]="FIFTEEN_MINUTES",e[e.THIRTY_MINUTES=30]="THIRTY_MINUTES",e[e.ONE_HOUR=60]="ONE_HOUR",e[e.TWO_HOURS=120]="TWO_HOURS",e[e.FOUR_HOURS=240]="FOUR_HOURS",e[e.ONE_DAY=1440]="ONE_DAY"}(p||(p={})),function(e){e.EMAIL="email",e.SLACK="slack",e.PAGERDUTY="pagerduty",e.MSTEAMS="msteams",e.SENTRY_APP="sentry_app"}(E||(E={}));const R={[E.EMAIL]:(0,n.t)("Email"),[E.SLACK]:(0,n.t)("Slack"),[E.PAGERDUTY]:(0,n.t)("Pagerduty"),[E.MSTEAMS]:(0,n.t)("MS Teams"),[E.SENTRY_APP]:(0,n.t)("Notification")};let g;!function(e){e.SPECIFIC="specific",e.USER="user",e.TEAM="team",e.SENTRY_APP="sentry_app"}(g||(g={}));const m={[g.USER]:(0,n.t)("Member"),[g.TEAM]:(0,n.t)("Team")}},"./app/views/alerts/types.tsx":(e,t,r)=>{let n,s,a,o,i;r.d(t,{ok:()=>n,lm:()=>s,vt:()=>a,Gb:()=>i}),function(e){e.METRIC="metric",e.ISSUE="issue"}(n||(n={})),function(e){e[e.CREATED=0]="CREATED",e[e.DETECTED=1]="DETECTED",e[e.STATUS_CHANGE=2]="STATUS_CHANGE",e[e.COMMENT=3]="COMMENT",e[e.STARTED=4]="STARTED"}(s||(s={})),function(e){e[e.OPENED=1]="OPENED",e[e.CLOSED=2]="CLOSED",e[e.WARNING=10]="WARNING",e[e.CRITICAL=20]="CRITICAL"}(a||(a={})),function(e){e[e.MANUAL=1]="MANUAL",e[e.RULE_UPDATED=2]="RULE_UPDATED",e[e.RULE_TRIGGERED=3]="RULE_TRIGGERED"}(o||(o={})),function(e){e[e.PENDING=0]="PENDING",e[e.SNAPSHOT=4]="SNAPSHOT",e[e.DISABLED=5]="DISABLED"}(i||(i={}))},"./app/views/alerts/utils/index.tsx":(e,t,r)=>{r.d(t,{dX:()=>R,hl:()=>g,yN:()=>m,Eq:()=>A,Gm:()=>y,CM:()=>T,Ey:()=>S,KC:()=>v,A4:()=>h,Eb:()=>f,Vc:()=>O,lR:()=>N,qn:()=>_,t3:()=>I,QR:()=>U,Gu:()=>x,g2:()=>C,LI:()=>D}),r("../node_modules/core-js/modules/es.string.replace.js");var n=r("../node_modules/lodash/round.js"),s=r.n(n),a=r("./app/api.tsx"),o=r("./app/locale.tsx"),i=r("./app/types/index.tsx"),l=r("./app/utils.tsx"),c=r("./app/utils/dates.tsx"),u=r("./app/utils/discover/charts.tsx"),d=r("./app/views/alerts/incidentRules/types.tsx"),p=r("./app/views/alerts/types.tsx");const E=new a.KU;function R(e,t,r){return E.requestPromise(`/organizations/${e}/alert-rules/${t}/`,{query:r})}function g(e,t,r,n){return E.requestPromise(`/organizations/${e}/incidents/`,{query:{project:"-1",alertRule:t,includeSnapshots:!0,start:r,end:n,expand:["activities","seen_by","original_alert_rule"]}})}function m(e,t,r){return e.requestPromise(`/organizations/${t}/incidents/${r}/`)}function A(e){return{start:(0,c.v5)(1e3*e.eventStats.data[0][0]),end:(0,c.v5)(1e3*e.eventStats.data[e.eventStats.data.length-1][0])}}function y(e){return!e.hasOwnProperty("triggers")}const T={[d.qz.ERRORS]:(0,o.t)("Errors"),[d.qz.TRANSACTIONS]:(0,o.t)("Transactions"),[d.Yh.ERROR_DEFAULT]:"event.type:error OR event.type:default",[d.Yh.ERROR]:"event.type:error",[d.Yh.DEFAULT]:"event.type:default",[d.Yh.TRANSACTION]:"event.type:transaction"},S={[d.Yh.ERROR_DEFAULT]:{dataset:d.qz.ERRORS,eventTypes:[d.GM.ERROR,d.GM.DEFAULT]},[d.Yh.ERROR]:{dataset:d.qz.ERRORS,eventTypes:[d.GM.ERROR]},[d.Yh.DEFAULT]:{dataset:d.qz.ERRORS,eventTypes:[d.GM.DEFAULT]},[d.Yh.TRANSACTION]:{dataset:d.qz.TRANSACTIONS,eventTypes:[d.GM.TRANSACTION]}};function v(e,t){return e===d.qz.TRANSACTIONS?d.Yh.TRANSACTION:t?t.includes(d.GM.DEFAULT)&&t.includes(d.GM.ERROR)?d.Yh.ERROR_DEFAULT:t.includes(d.GM.DEFAULT)?d.Yh.DEFAULT:d.Yh.ERROR:d.Yh.ERROR}function h(e){let t=e.match(/\(?\bevent\.type:(error|default|transaction)\)?\WOR\W\(?event\.type:(error|default|transaction)\)?/i);return t?"default,error"!==t.slice(1,3).sort().join(",")?null:{source:d.Yh.ERROR_DEFAULT,query:e.replace(t[0],"").trim()}:(t=e.match(/(^|\s)event\.type:(error|default|transaction)/i),t&&d.Yh[t[2].toUpperCase()]?{source:d.Yh[t[2].toUpperCase()],query:e.replace(t[0],"").trim()}:null)}function f(e){return Object.values(d.lK).includes(e)}const O={[d.lK.CRASH_FREE_SESSIONS]:i.r2.SESSIONS,[d.lK.CRASH_FREE_USERS]:i.r2.USERS};function N(e,t,r){return f(r)?(0,l.ri)(e)?`${s()(e,2)}%`:"―":(0,u.gu)(e,t)}function _(e,t,r){return f(r)?(0,l.ri)(e)?`${e}%`:"―":(0,u.CX)(e,t)}const I=1.03;function U(e){return f(e)}function x(e,t){return`/organizations/${e.slug}/alerts/rules/details/${t.alertRule.status===p.Gb.SNAPSHOT&&t.alertRule.originalAlertRuleId?t.alertRule.originalAlertRuleId:t.alertRule.id}/`}function C(e){return Array.isArray(e)?e:""===e?[]:["open","closed"].includes(e)?[e]:[]}const b=["myteams","unassigned"];function D(e){return void 0===e?b:""===e?[]:Array.isArray(e)?e:[e]}}}]);
//# sourceMappingURL=../sourcemaps/app_components_createAlertButton_tsx.26287f79f5c8b7230c2cb74c83b19fc3.js.map