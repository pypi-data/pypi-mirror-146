"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_components_modals_widgetViewerModal_utils_tsx-app_views_dashboardsV2_widgetCard_widgetCar-7a3063"],{"./app/components/charts/simpleTableChart.tsx":(e,t,s)=>{s.d(t,{p:()=>R,Z:()=>_});var r=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),i=s("../node_modules/react/index.js"),n=s("./app/components/links/link.tsx"),o=s("./app/components/panels/panelTable.tsx"),a=s("./app/components/tooltip.tsx"),l=s("./app/components/truncate.tsx"),d=s("./app/locale.tsx"),u=s("./app/styles/space.tsx"),c=s("./app/utils/discover/fieldRenderers.tsx"),p=s("./app/utils/discover/fields.tsx"),g=s("./app/utils/discover/urls.tsx"),m=s("./app/utils/withOrganization.tsx"),h=s("./app/views/eventsV2/table/topResultsIndicator.tsx"),v=s("./app/views/eventsV2/utils.tsx"),f=s("./app/views/performance/traceDetails/utils.tsx"),y=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function b(e){let{className:t,loading:s,eventView:r,fields:o,metadata:l,data:u,title:m,fieldHeaderMap:b,stickyHeaders:_,getCustomFieldRenderer:j,organization:F,topResultsIndicators:q,location:S,fieldAliases:C,loader:M}=e;const E=null!=l?l:{},D=(0,v.Hg)(o.map(((e,t)=>({field:e,alias:C[t]}))));return(0,y.BX)(i.Fragment,{children:[m&&(0,y.tZ)("h4",{children:m}),(0,y.tZ)(x,{className:t,isLoading:s,loader:M,headers:D.map(((e,t)=>{var s;const r=(0,p.qG)(e.name,e.type,E),i=e.column.alias||(null!==(s=null==b?void 0:b[e.key])&&void 0!==s?s:e.name);return(0,y.tZ)(Z,{align:r,children:(0,y.tZ)(a.ZP,{title:i,children:(0,y.tZ)(w,{value:i,maxLength:30,expandable:!1})})},t)})),isEmpty:!(null!=u&&u.length),stickyHeaders:_,disablePadding:!0,children:null==u?void 0:u.map(((e,t)=>function(e,t,s,i){return i.map(((i,o)=>{var l;let u=(null!==(l=null==j?void 0:j(i.key,s))&&void 0!==l?l:(0,c.Js)(i.key,s))(t,{organization:F,location:S});if("id"===i.key){const e=(0,g.JE)(t),s=(0,g.eQ)({orgSlug:F.slug,eventSlug:e,eventView:r});u=(0,y.tZ)(a.ZP,{title:(0,d.t)("View Event"),children:(0,y.tZ)(n.Z,{"data-test-id":"view-event",to:s,children:u})})}else if("trace"===i.key){const e=r.normalizeDateSelection(S);if(t.trace){const s=(0,f.YA)(F,String(t.trace),e,{});u=(0,y.tZ)(a.ZP,{title:(0,d.t)("View Trace"),children:(0,y.tZ)(n.Z,{"data-test-id":"view-trace",to:s,children:u})})}}return(0,y.BX)(R,{children:[q&&0===o&&(0,y.tZ)(h.Z,{count:q,index:e}),u]},`${e}-${o}:${i.name}`)}))}(t,e,E,D)))})]})}b.displayName="SimpleTableChart";const w=(0,r.Z)(l.Z,{target:"e3tr8vk3"})({name:"1bmnxg7",styles:"white-space:nowrap"}),x=(0,r.Z)(o.Z,{target:"e3tr8vk2"})("border-radius:0;border-left:0;border-right:0;border-bottom:0;margin:0;",o.z,"{height:min-content;}"),Z=(0,r.Z)("div",{target:"e3tr8vk1"})((e=>e.align?`text-align: ${e.align};`:"")," padding:",(0,u.Z)(1)," ",(0,u.Z)(3),";"),R=(0,r.Z)("div",{target:"e3tr8vk0"})("padding:",(0,u.Z)(1)," ",(0,u.Z)(3),";"),_=(0,m.Z)(b)},"./app/components/modals/widgetViewerModal/utils.tsx":(e,t,s)=>{let r;function i(e){return e.match(/\/widget\/[0-9]+\/$/)}s.d(t,{R:()=>r,X:()=>i}),function(e){e.SORT="sort",e.QUERY="query",e.LEGEND="legend",e.PAGE="page",e.CURSOR="cursor",e.WIDTH="width",e.START="viewerStart",e.END="viewerEnd"}(r||(r={}))},"./app/utils/dashboards/issueFieldRenderers.tsx":(e,t,s)=>{s.d(t,{N:()=>x,O:()=>M});var r=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),i=s("../node_modules/react/index.js"),n=s("./app/components/assigneeSelector.tsx"),o=s("./app/components/count.tsx"),a=s("./app/components/links/link.tsx"),l=s("./app/components/organizations/timeRangeSelector/utils.tsx"),d=s("./app/components/tooltip.tsx"),u=s("./app/constants/index.tsx"),c=s("./app/locale.tsx"),p=s("./app/stores/memberListStore.tsx"),g=s("./app/styles/space.tsx"),m=s("./app/utils/discover/eventView.tsx"),h=s("./app/views/dashboardsV2/widgetBuilder/issueWidget/fields.tsx"),v=s("./app/utils/discover/styles.tsx"),f=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const y={issue:{sortField:null,renderFunc:(e,t)=>{let{organization:s}=t;const r=e["issue.id"];if(!r)return(0,f.tZ)(v.W2,{children:(0,f.tZ)(v.PV,{shortId:`${e.issue}`})});const i={pathname:`/organizations/${s.slug}/issues/${r}/`};return(0,f.tZ)(v.W2,{children:(0,f.tZ)(v.Jo,{to:i,"aria-label":r,children:(0,f.tZ)(v.PV,{shortId:`${e.issue}`})})})}},assignee:{sortField:null,renderFunc:e=>{const t=p.Z.getAll();return(0,f.tZ)(S,{children:(0,f.tZ)(n.Z,{id:e.id,memberList:t,noDropdown:!0})})}},lifetimeEvents:{sortField:null,renderFunc:(e,t)=>{let{organization:s}=t;return b(e,s,"lifetimeEvents")}},lifetimeUsers:{sortField:null,renderFunc:(e,t)=>{let{organization:s}=t;return b(e,s,"lifetimeUsers")}},events:{sortField:"freq",renderFunc:(e,t)=>{let{organization:s}=t;return b(e,s,"events")}},users:{sortField:"user",renderFunc:(e,t)=>{let{organization:s}=t;return b(e,s,"users")}},lifetimeCount:{sortField:null,renderFunc:(e,t)=>{let{organization:s}=t;return b(e,s,"lifetimeEvents")}},lifetimeUserCount:{sortField:null,renderFunc:(e,t)=>{let{organization:s}=t;return b(e,s,"lifetimeUsers")}},count:{sortField:null,renderFunc:(e,t)=>{let{organization:s}=t;return b(e,s,"events")}},userCount:{sortField:null,renderFunc:(e,t)=>{let{organization:s}=t;return b(e,s,"users")}},links:{sortField:null,renderFunc:e=>{let{links:t}=e;return(0,f.tZ)(C,{dangerouslySetInnerHTML:{__html:t}})}}},b=(e,t,s)=>{const{start:r,end:n,period:a}=e,p=!!/user/i.exec(s.toLowerCase()),g=e[s],m=e[p?"users":"events"],h=e[p?"lifetimeUsers":"lifetimeEvents"],y=e[p?"filteredUsers":"filteredEvents"],b=w(e,t),x=w(e,t,!0),Z=r&&n?"time range":(0,l.T)(a||u.GY).toLowerCase();return(0,f.tZ)(v.W2,{children:(0,f.tZ)(d.ZP,{isHoverable:!0,skipWrapper:!0,popperStyle:{padding:0},title:(0,f.BX)("div",{children:[y?(0,f.BX)(i.Fragment,{children:[(0,f.BX)(_,{to:x,children:[(0,c.t)("Matching search filters"),(0,f.tZ)(F,{value:y})]}),(0,f.tZ)(q,{})]}):null,(0,f.BX)(_,{to:b,children:[(0,c.t)(`Total in ${Z}`),(0,f.tZ)(F,{value:m})]}),(0,f.tZ)(q,{}),(0,f.BX)(R,{children:[(0,c.t)("Since issue began"),(0,f.tZ)(F,{value:h})]})]}),children:(0,f.tZ)("span",{children:["events","users"].includes(s)&&y?(0,f.BX)(i.Fragment,{children:[(0,f.tZ)(o.Z,{value:y}),(0,f.tZ)(j,{value:g})]}):(0,f.tZ)(o.Z,{value:g})})})})};b.displayName="issuesCountRenderer";const w=(e,t,s)=>{const r={projects:[Number(e.projectId)]};return m.ZP.fromSavedQuery({...r,id:void 0,start:e.start,end:e.end,range:e.period,name:e.title,fields:["title","release","environment","user","timestamp"],orderby:"-timestamp",query:`issue.id:${e.id}${s?e.discoverSearchQuery:""}`,version:2}).getResultsViewUrlTarget(t.slug)};function x(e){if(y.hasOwnProperty(e))return y[e].sortField;switch(e){case h.Sh.LAST_SEEN:return"date";case h.Sh.FIRST_SEEN:return"new";default:return null}}const Z={name:"s5gdgx",styles:"width:100%;justify-content:space-between;display:flex;padding:6px 10px"},R=(0,r.Z)("div",{target:"e1va53iy6"})(Z,";"),_=(0,r.Z)(a.Z,{target:"e1va53iy5"})(Z,";color:",(e=>e.theme.gray400),";&:hover{color:",(e=>e.theme.gray400),";background:",(e=>e.theme.hover),";}"),j=(0,r.Z)(o.Z,{target:"e1va53iy4"})(":before{content:'/';padding-left:",(0,g.Z)(.25),";padding-right:2px;}"),F=(0,r.Z)((e=>{let{value:t,...s}=e;return(0,f.tZ)("div",{...s,children:(0,f.tZ)(o.Z,{value:t})})}),{target:"e1va53iy3"})("text-align:right;font-weight:bold;font-variant-numeric:tabular-nums;padding-left:",(0,g.Z)(2),";color:",(e=>e.theme.subText),";"),q=(0,r.Z)("div",{target:"e1va53iy2"})("height:1px;overflow:hidden;background-color:",(e=>e.theme.innerBorder),";"),S=(0,r.Z)("div",{target:"e1va53iy1"})({name:"1sl6pdq",styles:"display:flex;justify-content:left;margin-left:18px;height:24px;:hover{cursor:default;}"}),C=(0,r.Z)("span",{target:"e1va53iy0"})({name:"1bmnxg7",styles:"white-space:nowrap"});function M(e){return y.hasOwnProperty(e)?y[e].renderFunc:null}},"./app/utils/discover/charts.tsx":(e,t,s)=>{s.d(t,{CX:()=>a,gu:()=>l});var r=s("./app/locale.tsx"),i=s("./app/utils.tsx"),n=s("./app/utils/discover/fields.tsx"),o=s("./app/utils/formatters.tsx");function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(!(0,i.ri)(e))return"â€”";switch((0,n.Px)(t)){case"integer":case"number":return e.toLocaleString();case"percentage":return(0,o.rl)(e,2);case"duration":return(0,o.g9)(e/1e3,2,!0);default:return e.toString()}}function l(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];switch((0,n.Px)(t)){case"integer":case"number":return s?(0,o.Du)(e):e.toLocaleString();case"percentage":return(0,o.rl)(e,0);case"duration":return d(e);default:return e.toString()}}function d(e){if(0===e)return"0";if(e>=o.ps){const t=(e/o.ps).toFixed(0);return(0,r.t)("%swk",t)}if(e>=o.x4){const t=(e/o.x4).toFixed(0);return(0,r.t)("%sd",t)}if(e>=o.kr){const t=(e/o.kr).toFixed(0);return(0,r.t)("%shr",t)}if(e>=o.EB){const t=(e/o.EB).toFixed(0);return(0,r.t)("%smin",t)}if(e>=o.sh){const t=(e/o.sh).toFixed(0);return(0,r.t)("%ss",t)}const t=e.toFixed(0);return(0,r.t)("%sms",t)}},"./app/utils/discover/genericDiscoverQuery.tsx":(e,t,s)=>{s.d(t,{o:()=>u,AA:()=>g,ZP:()=>m});var r=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),i=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/react/index.js")),n=s("./app/locale.tsx"),o=s("./app/utils/discover/eventView.tsx"),a=s("./app/utils/performance/contexts/performanceEventViewContext.tsx"),l=s("./app/utils/useOrganization.tsx"),d=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class u{constructor(e,t){(0,r.Z)(this,"message",void 0),(0,r.Z)(this,"originalError",void 0),this.message=e,this.originalError=t}getOriginalError(){return this.originalError}}class c extends i.Component{constructor(){super(...arguments),(0,r.Z)(this,"state",{isLoading:!0,tableFetchID:void 0,error:null,tableData:null,pageLinks:null}),(0,r.Z)(this,"_shouldRefetchData",(e=>{const t=this.getPayload(this.props),s=this.getPayload(e);return!(0,o.ze)(t,s)||e.limit!==this.props.limit||e.route!==this.props.route||e.cursor!==this.props.cursor})),(0,r.Z)(this,"_parseError",(e=>{var t;if(this.props.parseError)return this.props.parseError(e);if(!e)return null;const s=null===(t=e.responseJSON)||void 0===t?void 0:t.detail;if("string"==typeof s)return new u(s,e);const r=null==s?void 0:s.message;return new u("string"==typeof r?r:(0,n.t)("An unknown error occurred."),e)})),(0,r.Z)(this,"fetchData",(async()=>{const{api:e,beforeFetch:t,afterFetch:s,didFetch:r,eventView:i,orgSlug:n,route:o,setError:a}=this.props;if(!i.isValid())return;const l=`/organizations/${n}/${o}/`,d=Symbol("tableFetchID"),u=this.getPayload(this.props);this.setState({isLoading:!0,tableFetchID:d}),null==a||a(void 0),null==t||t(e),e.clear();try{const[t,,i]=await g(e,l,u);if(this.state.tableFetchID!==d)return;const n=s?s(t,this.props):t;null==r||r(n),this.setState((e=>{var t;return{isLoading:!1,tableFetchID:void 0,error:null,pageLinks:null!==(t=null==i?void 0:i.getResponseHeader("Link"))&&void 0!==t?t:e.pageLinks,tableData:n}}))}catch(e){const t=this._parseError(e);this.setState({isLoading:!1,tableFetchID:void 0,error:t,tableData:null}),a&&a(null!=t?t:void 0)}}))}componentDidMount(){this.fetchData()}componentDidUpdate(e){const t=this._shouldRefetchData(e),s=!1===e.eventView.isValid()&&this.props.eventView.isValid(),r=!!this.props.shouldRefetchData&&this.props.shouldRefetchData(e,this.props);(t||s||r)&&this.fetchData()}getPayload(e){var t;const{cursor:s,limit:r,noPagination:i,referrer:n}=e,o=this.props.getRequestPayload?this.props.getRequestPayload(e):e.eventView.getEventsAPIPayload(e.location);return s&&(o.cursor=s),r&&(o.per_page=r),i&&(o.noPagination=i),n&&(o.referrer=n),Object.assign(o,null!==(t=e.queryExtras)&&void 0!==t?t:{}),o}render(){const{isLoading:e,error:t,tableData:s,pageLinks:r}=this.state,i={isLoading:e,error:t,tableData:s,pageLinks:r},n=this.props.children;return null==n?void 0:n(i)}}function p(e){var t,s;const r=null!==(t=e.orgSlug)&&void 0!==t?t:(0,l.Z)().slug,i=null!==(s=e.eventView)&&void 0!==s?s:(0,a.wj)(),n={...e,orgSlug:r,eventView:i};return(0,d.tZ)(c,{...n})}async function g(e,t,s){return e.requestPromise(t,{method:"GET",includeAllArgs:!0,query:{...s}})}c.displayName="_GenericDiscoverQuery",p.displayName="GenericDiscoverQuery";const m="app"==s.j?p:null},"./app/utils/performance/contexts/performanceEventViewContext.tsx":(e,t,s)=>{s.d(t,{bq:()=>i,wj:()=>o}),s("../node_modules/core-js/modules/web.dom-collections.iterator.js");var r=s("./app/utils/performance/contexts/utils.tsx");const[i,n]=(0,r.n)({name:"PerformanceEventViewContext"});function o(){return n().eventView}},"./app/utils/performance/contexts/utils.tsx":(e,t,s)=>{s.d(t,{n:()=>i});var r=s("../node_modules/react/index.js");function i(e){const{strict:t=!0,errorMessage:s=`useContext for "${e.name}" must be inside a Provider with a value`,name:i}=e,n=r.createContext(void 0);return n.displayName=i,[n.Provider,function(){const e=r.useContext(n);if(!e&&t)throw new Error(s);return e},n]}},"./app/views/dashboardsV2/utils.tsx":(e,t,s)=>{s.d(t,{qk:()=>Z,tT:()=>R,y1:()=>j,DW:()=>F,s:()=>q,Mf:()=>S,z1:()=>C,hS:()=>M,Tk:()=>E}),s("../node_modules/core-js/modules/web.dom-collections.iterator.js");var r=s("../node_modules/lodash/cloneDeep.js"),i=s.n(r),n=s("../node_modules/lodash/pick.js"),o=s.n(n),a=s("../node_modules/query-string/index.js"),l=s("./images/dashboard/widget-area.svg"),d=s("./images/dashboard/widget-bar.svg"),u=s("./images/dashboard/widget-big-number.svg"),c=s("./images/dashboard/widget-line-1.svg"),p=s("./images/dashboard/widget-table.svg"),g=s("./images/dashboard/widget-world-map.svg"),m=s("./app/components/arithmeticInput/parser.tsx"),h=s("./app/components/charts/utils.tsx"),v=s("./app/utils.tsx"),f=s("./app/utils/dates.tsx"),y=s("./app/utils/discover/eventView.tsx"),b=s("./app/utils/discover/fields.tsx"),w=s("./app/utils/discover/types.tsx"),x=s("./app/views/dashboardsV2/types.tsx");function Z(e){return i()(e)}function R(e,t,s,r){const{start:i,end:n,period:o}=s.datetime,{projects:a,environments:l}=s,d=r!==x.FO.WORLD_MAP||t.columns.includes("geo.country_code")?[...t.columns,...t.aggregates]:["geo.country_code",...t.columns,...t.aggregates],u=r!==x.FO.WORLD_MAP||t.conditions.includes("has:geo.country_code")?t.conditions:`${t.conditions} has:geo.country_code`.trim();return y.ZP.fromSavedQuery({id:void 0,name:e,version:2,fields:d,query:u,orderby:t.orderby,projects:a,range:null!=o?o:void 0,start:i?(0,f.v5)(i):void 0,end:n?(0,f.v5)(n):void 0,environment:l})}function _(e){return"string"==typeof e?[e]:e}function j(e){if(e){const t=_(e.queryNames),s=_(e.queryConditions),r=_(e.queryFields),i=[];if(s&&t&&r&&"string"==typeof e.queryOrderby){const{columns:n,aggregates:o}=(0,b.n0)(r);s.forEach(((s,a)=>{i.push({name:t[a],conditions:s,fields:r,columns:n,aggregates:o,orderby:e.queryOrderby})}))}if(e.title&&e.displayType&&e.interval&&i.length>0)return{...o()(e,["title","displayType","interval"]),widgetType:x.l9.DISCOVER,queries:i}}}function F(e){switch(e){case x.FO.BAR:return d;case x.FO.AREA:case x.FO.TOP_N:return l;case x.FO.BIG_NUMBER:return u;case x.FO.TABLE:return p;case x.FO.WORLD_MAP:return g;case x.FO.LINE:default:return c}}function q(e,t){let s="bar"===e.displayType?"1d":e.interval;s||(s="5m");const r=(0,f.YJ)(s),i=(0,h.Nm)(t);if(e.widgetType===x.l9.METRICS)return s=(0,h.ZS)(t,"medium"),i>h.aC&&i<=h.w3&&(s="1h"),"bar"===e.displayType?"1d":s;if(i/(60*r)>66){const e=(0,h.ZS)(t,"high");if(r<(0,f.YJ)(e))return e}return s}function S(e){const t=new Set;return e.filter(b.GO).forEach((e=>{const s=(0,m.W9)((0,b.bQ)(e)).tc;s.fields.forEach((e=>{let{term:s}=e;return t.add(s)})),s.functions.forEach((e=>{let{term:s}=e;return t.add(s)}))})),Array.from(t)}function C(e,t,s){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const i=R(e.title,e.queries[r],t,e.displayType),n=i.getResultsViewUrlTarget(s.slug),o=i.getYAxisOptions().map((e=>{let{value:t}=e;return t}));switch(n.query.yAxis=[...new Set(e.queries[0].aggregates.filter((e=>o.includes(e))))].slice(0,3),e.displayType){case x.FO.WORLD_MAP:n.query.display=w.DC.WORLDMAP;break;case x.FO.BAR:n.query.display=w.DC.BAR;break;case x.FO.TOP_N:n.query.display=w.DC.TOP5;const t=e.queries[0].aggregates;n.query.yAxis=t[t.length-1],t.slice(0,-1).includes(t[t.length-1])&&(n.query.field=t.slice(0,-1))}const l=n.query.field,d=e.queries[0],u=(0,v.ri)(d.fields)?d.fields:[...d.columns,...d.aggregates],c=S(u);c.forEach((e=>{Array.isArray(l)&&!l.includes(e)&&l.unshift(e)}));const p=`${n.pathname}?${a.stringify({...n.query})}`;return p}function M(e,t,s){var r,i,n,o;const{start:l,end:d,utc:u,period:c}=t.datetime,p=l&&d?{start:(0,f.v5)(l),end:(0,f.v5)(d),utc:u}:{statsPeriod:c};return`/organizations/${s.slug}/issues/?${a.stringify({query:null===(r=e.queries)||void 0===r||null===(i=r[0])||void 0===i?void 0:i.conditions,sort:null===(n=e.queries)||void 0===n||null===(o=n[0])||void 0===o?void 0:o.orderby,...p})}`}function E(e,t){return Object.keys(e).forEach((s=>{const r=e[s];"string"!=typeof r?Array.isArray(r)&&"string"==typeof r[0]?t[s]=r[0]:Array.isArray(r)&&"object"==typeof r[0]?r.map((e=>E(e,t))):E(r,t):t[s]=r})),t}},"./app/views/dashboardsV2/widgetCard/chart.tsx":(e,t,s)=>{s.d(t,{Z:()=>A});var r=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),i=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),n=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/react/index.js")),o=s("../node_modules/@emotion/react/dist/emotion-element-a8309070.browser.esm.js"),a=s("../node_modules/lodash/isEqual.js"),l=s.n(a),d=s("../node_modules/lodash/omit.js"),u=s.n(d),c=s("./app/components/charts/areaChart.tsx"),p=s("./app/components/charts/barChart.tsx"),g=s("./app/components/charts/chartZoom.tsx"),m=s("./app/components/charts/errorPanel.tsx"),h=s("./app/components/charts/lineChart.tsx"),v=s("./app/components/charts/simpleTableChart.tsx"),f=s("./app/components/charts/transitionChart.tsx"),y=s("./app/components/charts/transparentLoadingMask.tsx"),b=s("./app/components/charts/utils.tsx"),w=s("./app/components/charts/worldMapChart.tsx"),x=s("./app/components/loadingIndicator.tsx"),Z=s("./app/components/placeholder.tsx"),R=s("./app/components/tooltip.tsx"),_=s("./app/icons/index.tsx"),j=s("./app/styles/space.tsx"),F=s("./app/utils/discover/charts.tsx"),q=s("./app/utils/discover/fieldRenderers.tsx"),S=s("./app/utils/discover/fields.tsx"),C=s("./app/utils/getDynamicText.tsx"),M=s("./app/views/dashboardsV2/utils.tsx"),E=s("./app/views/dashboardsV2/types.tsx"),D=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class T extends n.Component{constructor(){super(...arguments),(0,r.Z)(this,"state",{containerHeight:0})}shouldComponentUpdate(e,t){var s,r;if(this.props.widget.displayType===E.FO.BIG_NUMBER&&e.widget.displayType===E.FO.BIG_NUMBER&&(this.props.windowWidth!==e.windowWidth||!l()(null===(s=this.props.widget)||void 0===s?void 0:s.layout,null===(r=e.widget)||void 0===r?void 0:r.layout)))return!0;const i={...u()(this.props,["windowWidth"]),widget:{...this.props.widget,title:""}};return e={...u()(e,["windowWidth"]),widget:{...e.widget,title:""}},!l()(i,e)||!l()(this.state,t)}tableResultComponent(e){let{loading:t,errorMessage:s,tableResults:r}=e;const{location:i,widget:n,organization:o,selection:a}=this.props;return s?(0,D.tZ)(m.Z,{children:(0,D.tZ)(_.FC,{color:"gray500",size:"lg"})}):void 0===r?(0,D.tZ)(z,{}):r.map(((e,s)=>{var l,d,u,c,p;const g=null!==(l=null===(d=n.queries[s])||void 0===d||null===(u=d.fields)||void 0===u?void 0:u.map(S.hr))&&void 0!==l?l:[],m=null!==(c=null===(p=n.queries[s])||void 0===p?void 0:p.fieldAliases)&&void 0!==c?c:[],h=(0,M.tT)(n.title,n.queries[0],a,n.displayType);return(0,D.tZ)($,{eventView:h,fieldAliases:m,location:i,fields:g,title:r.length>1?e.title:"",loading:t,loader:(0,D.tZ)(z,{}),metadata:e.meta,data:e.data,organization:o,stickyHeaders:!0,getCustomFieldRenderer:(e,t)=>(0,q.Js)(e,t,n.widgetType!==E.l9.METRICS)},`table:${e.title}`)}))}bigNumberComponent(e){let{loading:t,errorMessage:s,tableResults:r}=e;if(s)return(0,D.tZ)(m.Z,{children:(0,D.tZ)(_.FC,{color:"gray500",size:"lg"})});if(void 0===r||t)return(0,D.tZ)(P,{children:"â€”"});const{containerHeight:i}=this.state,{organization:n,widget:o,isMobile:a,expandNumbers:l}=this.props;return r.map((e=>{var t;const s=null!==(t=e.meta)&&void 0!==t?t:{},r=Object.keys(null!=s?s:{})[0];if(l&&"integer"===s[r]&&(s[r]="number"),!r||!e.data.length)return(0,D.tZ)(P,{children:"â€”"},`big_number:${e.title}`);const d=e.data[0],u=(0,q.fK)(r,s,o.widgetType!==E.l9.METRICS)(d),c=!(o.id||o.tempId);if(!n.features.includes("dashboard-grid-layout")||c||a)return(0,D.tZ)(P,{children:u},`big_number:${e.title}`);const p=l?`max(min(8vw, 90px), ${(0,j.Z)(4)})`:i-parseInt((0,j.Z)(1),10)-parseInt((0,j.Z)(3),10);return(0,D.tZ)(P,{style:{fontSize:p,...l?{padding:`${(0,j.Z)(1)} ${(0,j.Z)(3)} 0 ${(0,j.Z)(3)}`}:{}},children:(0,D.tZ)(R.ZP,{title:u,showOnlyOnOverflow:!0,children:u})},`big_number:${e.title}`)}))}chartComponent(e){const{organization:t,widget:s}=this.props,r=t.features.includes("new-widget-builder-experience-design")&&s.queries[0].columns.length>0;switch(s.displayType){case"bar":return(0,D.tZ)(p.v,{...e,stacked:r});case"area":case"top_n":return(0,D.tZ)(c.T,{stacked:!0,...e});case"world_map":return(0,D.tZ)(w.y,{...e});default:return(0,D.tZ)(h.w,{...e})}}render(){var e,t,s;const{theme:r,tableResults:i,timeseriesResults:n,errorMessage:o,loading:a,widget:l,organization:d,onZoom:u,legendOptions:c}=this.props;if("table"===l.displayType)return(0,C.Z)({value:(0,D.BX)(f.Z,{loading:a,reloading:a,children:[(0,D.tZ)(k,{loading:a}),this.tableResultComponent({tableResults:i,loading:a,errorMessage:o})]}),fixed:(0,D.tZ)(Z.Z,{height:"200px",testId:"skeleton-ui"})});if("big_number"===l.displayType)return(0,D.BX)(f.Z,{loading:a,reloading:a,children:[(0,D.tZ)(k,{loading:a}),(0,D.tZ)(L,{ref:e=>{if(null!==e){const{height:t}=e.getBoundingClientRect();this.setState({containerHeight:t})}},children:this.bigNumberComponent({tableResults:i,loading:a,errorMessage:o})})]});if(o)return(0,D.tZ)(m.Z,{children:(0,D.tZ)(_.FC,{color:"gray500",size:"lg"})});const{location:p,router:h,selection:v,onLegendSelectChanged:y}=this.props,{start:w,end:x,period:R,utc:j}=v.datetime,q=Boolean(d.features.includes("dashboard-grid-layout")&&(l.id||l.tempId));if("world_map"===l.displayType){const{data:e,title:t}=(0,b.JT)(i),s=[{seriesName:t,data:e}];return(0,D.BX)(f.Z,{loading:a,reloading:a,children:[(0,D.tZ)(k,{loading:a}),(0,D.tZ)(I,{autoHeightResize:q,children:(0,C.Z)({value:this.chartComponent({series:s,autoHeightResize:q}),fixed:(0,D.tZ)(Z.Z,{height:"200px",testId:"skeleton-ui"})})})]})}const M={left:0,top:0,selected:(0,b.RI)(p),formatter:e=>{const t=(0,S.hW)(e);if(null!==t){const s=(0,S.b8)(t);null!==s&&(e=s.toUpperCase())}return(0,S.by)(e)&&(e=(0,S.bQ)(e)),e},...c},E=null!==(e=null===(t=l.queries[0])||void 0===t||null===(s=t.aggregates)||void 0===s?void 0:s[0])&&void 0!==e?e:"count()",T=(0,S.GO)(E)?(0,S.vp)(E):E,O={autoHeightResize:q,grid:{left:4,right:0,top:"40px",bottom:0},seriesOptions:{showSymbol:!1},tooltip:{trigger:"axis",valueFormatter:F.CX},yAxis:{axisLabel:{color:r.chartLabel,formatter:e=>(0,F.gu)(e,T)}}};return(0,D.tZ)(g.Z,{router:h,period:R,start:w,end:x,utc:j,children:e=>{if(o)return(0,D.tZ)(m.Z,{children:(0,D.tZ)(_.FC,{color:"gray500",size:"lg"})});const t="top_n"===l.displayType&&n&&n.length>5,s=n?r.charts.getColorPalette(n.length-(t?3:2)):[];t&&(s[s.length]=r.chartOther);const i=n?n.map(((e,t)=>{let r="";return void 0!==e.seriesName&&(r=(0,S.GO)(e.seriesName)?(0,S.vp)(e.seriesName):e.seriesName),{...e,seriesName:r,color:s[t]}})):[];return(0,D.BX)(f.Z,{loading:a,reloading:a,children:[(0,D.tZ)(k,{loading:a}),(0,D.tZ)(I,{autoHeightResize:q,children:(0,C.Z)({value:this.chartComponent({...e,...O,...u?{onDataZoom:u}:{},legend:M,series:i,onLegendSelectChanged:y}),fixed:(0,D.tZ)(Z.Z,{height:"200px",testId:"skeleton-ui"})})})]})}})}}T.displayName="WidgetCardChart";const O=(0,i.Z)((e=>(0,D.tZ)(y.Z,{...e,maskBackgroundColor:"transparent"})),{target:"eb7j3e5"})({name:"1vcob1d",styles:"display:flex;justify-content:center;align-items:center"}),k=e=>{let{loading:t}=e;return t?(0,D.tZ)(O,{visible:t,children:(0,D.tZ)(x.Z,{mini:!0})}):null};k.displayName="LoadingScreen";const z=(0,i.Z)((e=>{let{className:t}=e;return(0,D.tZ)(Z.Z,{height:"200px",className:t})}),{target:"eb7j3e4"})("background-color:",(e=>e.theme.surface200),";"),L=(0,i.Z)("div",{target:"eb7j3e3"})({name:"af8mp8",styles:"height:100%;width:100%;overflow:hidden"}),P=(0,i.Z)("div",{target:"eb7j3e2"})("line-height:1;display:inline-flex;flex:1;width:100%;min-height:0;font-size:32px;color:",(e=>e.theme.headingColor),";padding:",(0,j.Z)(1)," ",(0,j.Z)(3)," ",(0,j.Z)(3)," ",(0,j.Z)(3),";*{text-align:left!important;}"),I=(0,i.Z)("div",{target:"eb7j3e1"})((e=>e.autoHeightResize&&"height: 100%;")," padding:0 ",(0,j.Z)(3)," ",(0,j.Z)(3),";"),$=(0,i.Z)(v.Z,{target:"eb7j3e0"})("margin-top:",(0,j.Z)(1.5),";border-bottom-left-radius:",(e=>e.theme.borderRadius),";border-bottom-right-radius:",(e=>e.theme.borderRadius),";font-size:",(e=>e.theme.fontSizeMedium),";box-shadow:none;"),A=(0,o.b)(T)},"./app/views/dashboardsV2/widgetCard/issueWidgetQueries.tsx":(e,t,s)=>{s.d(t,{Z:()=>w});var r=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),i=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/react/index.js")),n=s("../node_modules/lodash/isEqual.js"),o=s.n(n),a=s("./app/components/organizations/pageFilters/utils.tsx"),l=s("./app/locale.tsx"),d=s("./app/stores/groupStore.tsx"),u=s("./app/stores/memberListStore.tsx"),c=s("./app/utils/dates.tsx"),p=s("./app/utils/getDynamicText.tsx"),g=s("./app/utils/stream.tsx"),m=s("./app/views/issueList/utils.tsx"),h=s("./app/views/dashboardsV2/types.tsx"),v=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const f=m.qh.DATE,y=["owners"];class b extends i.Component{constructor(){super(...arguments),(0,r.Z)(this,"state",{loading:!0,errorMessage:void 0,tableResults:[],memberListStoreLoaded:u.Z.isLoaded(),totalCount:null,pageLinks:null}),(0,r.Z)(this,"unlisteners",[u.Z.listen((()=>{this.setState({memberListStoreLoaded:u.Z.isLoaded()})}),void 0)])}componentDidMount(){this.fetchData()}componentDidUpdate(e){const{selection:t,widget:s,cursor:r}=this.props,[i]=e.widget.queries.reduce(((e,t)=>{let[s,r]=e,{name:i,...n}=t;return s.push(n),r.push(i),[s,r]}),[[],[]]),[n]=s.queries.reduce(((e,t)=>{let[s,r]=e,{name:i,...n}=t;return s.push(n),r.push(i),[s,r]}),[[],[]]);o()(s.displayType,e.widget.displayType)&&o()(s.interval,e.widget.interval)&&o()(n,i)&&(0,a.WO)(t,e.selection)&&r===e.cursor||this.fetchData()}componentWillUnmount(){this.unlisteners.forEach((e=>null==e?void 0:e()))}transformTableResults(){const{selection:e,widget:t}=this.props,{tableResults:s}=this.state;d.Z.add(s);const r=[];return s.forEach((s=>{let{id:i,shortId:n,title:o,lifetime:a,filtered:l,count:d,userCount:u,project:p,annotations:h,...v}=s;const f={};Object.keys(v).filter((e=>["number","string"].includes(typeof v[e]))).forEach((e=>{f[e]=v[e]}));const y={...f,events:d,users:u,id:i,"issue.id":i,issue:n,title:o,project:p.slug,links:null==h?void 0:h.join(", ")};a&&(y.lifetimeEvents=null==a?void 0:a.count,y.lifetimeUsers=null==a?void 0:a.userCount),l&&(y.filteredEvents=null==l?void 0:l.count,y.filteredUsers=null==l?void 0:l.userCount);const b=t.queries[0].conditions,w=[];if("string"==typeof b){const e=(0,g.w)(b);for(const t in e)if(!m.QL.includes(t)){const s=e[t].includes(" ")?`"${e[t]}"`:e[t];w.push(`${t}:${s}`)}e.__text&&w.push(e.__text)}y.discoverSearchQuery=(w.length?" ":"")+w.join(" "),y.projectId=p.id;const{period:x,start:Z,end:R}=e.datetime||{};Z&&R&&(y.start=(0,c.v5)(Z),y.end=(0,c.v5)(R)),y.period=null!=x?x:"",r.push(y)})),r}async fetchIssuesData(){const{selection:e,api:t,organization:s,widget:r,limit:i,cursor:n}=this.props;this.setState({tableResults:[]});const o=r.queries[0],a=`/organizations/${s.slug}/issues/`,d={project:e.projects,environment:e.environments,query:o.conditions,sort:o.orderby||f,expand:y,limit:null!=i?i:h.$V,cursor:n};e.datetime.period&&(d.statsPeriod=e.datetime.period),e.datetime.end&&(d.end=(0,c.v5)(e.datetime.end)),e.datetime.start&&(d.start=(0,c.v5)(e.datetime.start)),e.datetime.utc&&(d.utc=e.datetime.utc);try{var u,p;const[e,s,r]=await t.requestPromise(a,{includeAllArgs:!0,method:"GET",data:{...d}});this.setState({loading:!1,errorMessage:void 0,tableResults:e,totalCount:null!==(u=null==r?void 0:r.getResponseHeader("X-Hits"))&&void 0!==u?u:null,pageLinks:null!==(p=null==r?void 0:r.getResponseHeader("Link"))&&void 0!==p?p:null})}catch(e){var g,m;const t=null!==(g=null==e||null===(m=e.responseJSON)||void 0===m?void 0:m.detail)&&void 0!==g?g:null;this.setState({loading:!1,errorMessage:null!=t?t:(0,l.t)("Unable to load Widget"),tableResults:[]})}}fetchData(){this.setState({loading:!0,errorMessage:void 0}),this.fetchIssuesData()}render(){const{children:e}=this.props,{loading:t,errorMessage:s,memberListStoreLoaded:r,pageLinks:i,totalCount:n}=this.state,o=this.transformTableResults();return(0,p.Z)({value:e({loading:t||!r,transformedResults:o,errorMessage:s,pageLinks:i,totalCount:null!=n?n:void 0}),fixed:(0,v.tZ)("div",{})})}}b.displayName="IssueWidgetQueries";const w=b},"./app/views/dashboardsV2/widgetCard/widgetCardChartContainer.tsx":(e,t,s)=>{s.d(t,{b:()=>V,Z:()=>B});var r=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),i=s("../node_modules/react/index.js"),n=s("../node_modules/react-router/es/index.js"),o=s("./app/components/charts/transparentLoadingMask.tsx"),a=s("./app/components/loadingIndicator.tsx"),l=s("./app/views/dashboardsV2/types.tsx"),d=s("./app/views/dashboardsV2/widgetCard/chart.tsx"),u=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("./app/components/charts/errorPanel.tsx")),c=s("./app/components/charts/simpleTableChart.tsx"),p=s("./app/components/placeholder.tsx"),g=s("./app/icons/index.tsx"),m=s("./app/styles/space.tsx"),h=s("./app/utils.tsx"),v=s("./app/utils/dashboards/issueFieldRenderers.tsx"),f=s("./app/views/dashboardsV2/utils.tsx"),y=s("./app/views/dashboardsV2/widgetBuilder/issueWidget/fields.tsx"),b=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function w(e){var t;let{organization:s,selection:r,widget:i,errorMessage:n,loading:o,transformedResults:a,location:l}=e;if(n)return(0,b.tZ)(u.Z,{children:(0,b.tZ)(g.FC,{color:"gray500",size:"lg"})});if(o)return(0,b.tZ)(x,{height:"200px"});const d=i.queries[0],c=(0,h.ri)(d.fields)?d.fields:[...d.columns,...d.aggregates],p=null!==(t=d.fieldAliases)&&void 0!==t?t:[],m=(0,f.tT)(i.title,i.queries[0],r,i.displayType);return(0,b.tZ)(Z,{location:l,title:"",eventView:m,fields:c,fieldAliases:p,loading:o,metadata:y.$L,data:a,organization:s,getCustomFieldRenderer:v.O,fieldHeaderMap:y.kh,stickyHeaders:!0})}w.displayName="IssueWidgetCard";const x=(0,r.Z)(p.Z,{target:"e11eoa721"})("background-color:",(e=>e.theme.surface200),";"),Z=(0,r.Z)(c.Z,{target:"e11eoa720"})("margin-top:",(0,m.Z)(1.5),";border-bottom-left-radius:",(e=>e.theme.borderRadius),";border-bottom-right-radius:",(e=>e.theme.borderRadius),";font-size:",(e=>e.theme.fontSizeMedium),";box-shadow:none;");var R=s("./app/views/dashboardsV2/widgetCard/issueWidgetQueries.tsx"),_=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),j=s("../node_modules/lodash/cloneDeep.js"),F=s.n(j),q=s("../node_modules/lodash/isEqual.js"),S=s.n(q),C=s("../node_modules/lodash/omit.js"),M=s.n(C),E=s("./app/components/charts/utils.tsx"),D=s("./app/components/organizations/pageFilters/parse.tsx"),T=s("./app/components/organizations/pageFilters/utils.tsx"),O=s("./app/locale.tsx"),k=s("./app/utils/discover/fields.tsx"),z=s("./app/utils/discover/types.tsx");function L(e,t){var s;return null!==(s=null==e?void 0:e.groups.flatMap((s=>Object.keys(s.series).map((r=>({seriesName:`${t?`${t}: `:""}${r}${Object.entries(s.by).map((e=>{let[t,s]=e;return`|${t}:${s}`})).join("")}`,data:e.intervals.map(((e,t)=>{var i;return{name:e,value:null!==(i=s.series[r][t])&&void 0!==i?i:0}}))}))))))&&void 0!==s?s:[]}var P=s("./app/views/dashboardsV2/widgetBuilder/releaseWidget/fields.tsx");function I(e){return Object.keys(null!=e?e:{}).reduce(((e,t)=>(e[t]=P.ve.includes(t)?"string":(0,k.Px)(t),e)),{})}class $ extends i.Component{constructor(){super(...arguments),(0,_.Z)(this,"state",{loading:!0,queryFetchID:void 0,errorMessage:void 0,timeseriesResults:void 0,rawResults:void 0,tableResults:void 0}),(0,_.Z)(this,"_isMounted",!1)}componentDidMount(){this._isMounted=!0,this.fetchData()}componentDidUpdate(e){const{loading:t,rawResults:s}=this.state,{selection:r,widget:i,organization:n,limit:o}=this.props,a=["queries","title","id","layout","tempId","widgetType"],l=["name","fields","aggregates","columns"],d=i.queries.map((e=>e.name)),u=e.widget.queries.map((e=>e.name));o===e.limit&&n.slug===e.organization.slug&&(0,T.WO)(r,e.selection)&&S()(M()(i,a),M()(e.widget,a))&&S()(i.queries.map((e=>M()(e,l))),e.widget.queries.map((e=>M()(e,l))))&&S()(i.queries.flatMap((e=>{var t;return null===(t=e.fields)||void 0===t?void 0:t.filter((e=>!!e))})),e.widget.queries.flatMap((e=>{var t;return null===(t=e.fields)||void 0===t?void 0:t.filter((e=>!!e))})))&&S()(i.queries.flatMap((e=>e.aggregates.filter((e=>!!e)))),e.widget.queries.flatMap((e=>e.aggregates.filter((e=>!!e)))))&&S()(i.queries.flatMap((e=>e.columns.filter((e=>!!e)))),e.widget.queries.flatMap((e=>e.columns.filter((e=>!!e)))))?t||S()(d,u)||(null==s?void 0:s.length)!==i.queries.length||this.setState((e=>{var t;return{...e,timeseriesResults:null===(t=e.rawResults)||void 0===t?void 0:t.flatMap(((e,t)=>L(e,i.queries[t].name)))}})):this.fetchData()}componentWillUnmount(){this._isMounted=!1}get limit(){const{limit:e}=this.props;switch(this.props.widget.displayType){case l.FO.TOP_N:return z.hY;case l.FO.TABLE:return null!=e?e:l.$V;case l.FO.BIG_NUMBER:return 1;default:return null!=e?e:20}}fetchData(){const{selection:e,api:t,organization:s,widget:r}=this.props;if(r.displayType===l.FO.WORLD_MAP)return void this.setState({errorMessage:(0,O.t)("World Map is not supported by metrics.")});const i=Symbol("queryFetchID");this.setState({loading:!0,errorMessage:void 0,timeseriesResults:[],rawResults:[],tableResults:[],queryFetchID:i});const{environments:n,projects:o,datetime:a}=e,{start:d,end:u,period:c}=a,p=(0,f.s)(r,{start:d,end:u,period:c}),g=r.queries.map((e=>{const r={field:e.aggregates.map(k.hr),orgSlug:s.slug,end:u,environment:n,groupBy:e.columns,interval:p,project:o,query:e.conditions,start:d,statsPeriod:c};return((e,t)=>{let{field:s,orgSlug:r,cursor:i,environment:n,groupBy:o,interval:a,project:l,query:d,statsPeriodStart:u,statsPeriodEnd:c,...p}=t;const{start:g,end:m,statsPeriod:v}=(0,D.fK)(p,{allowEmptyPeriod:!0}),f=Object.fromEntries(Object.entries({field:s.filter((e=>!!e)),cursor:i,end:m,environment:n,groupBy:null==o?void 0:o.filter((e=>!!e)),interval:a||(0,E.ZS)({start:g,end:m,period:v}),query:d||void 0,project:l,start:g,statsPeriod:v,statsPeriodStart:u,statsPeriodEnd:c}).filter((e=>{let[,t]=e;return(0,h.ri)(t)&&""!==t})));return e.requestPromise(`/organizations/${r}/sessions/`,{query:f})})(t,r)}));let m=0;g.forEach((async(e,t)=>{try{const s=await e;if(!this._isMounted)return;this.setState((e=>{var n,o;if(e.queryFetchID!==i)return e;if([l.FO.TABLE,l.FO.BIG_NUMBER].includes(r.displayType)){var a,d,u;const i=function(e){var t;const s=null!==(t=null==e?void 0:e.groups.map(((e,t)=>({id:String(t),...e.by,...e.totals}))))&&void 0!==t?t:[],r=null==e?void 0:e.groups[0];return{meta:{...I(null==r?void 0:r.by),...I(null==r?void 0:r.totals)},data:s}}(s);return i.title=null!==(a=null===(d=r.queries[t])||void 0===d?void 0:d.name)&&void 0!==a?a:"",{...e,errorMessage:void 0,tableResults:[...null!==(u=e.tableResults)&&void 0!==u?u:[],i]}}const c=[...null!==(n=e.timeseriesResults)&&void 0!==n?n:[]],p=L(s,r.queries[t].name);p.forEach(((e,s)=>{c[t*p.length+s]=e}));const g=F()(null!==(o=e.rawResults)&&void 0!==o?o:[]);return g[t]=s,{...e,errorMessage:void 0,timeseriesResults:c,rawResults:g}}))}catch(e){var s;const t=(null==e||null===(s=e.responseJSON)||void 0===s?void 0:s.detail)||(0,O.t)("An unknown error occurred.");this.setState({errorMessage:t})}finally{if(m++,!this._isMounted)return;this.setState((e=>e.queryFetchID!==i?e:{...e,loading:m!==g.length}))}}))}render(){const{children:e}=this.props,{loading:t,timeseriesResults:s,tableResults:r,errorMessage:i}=this.state;return e({loading:t,timeseriesResults:s,tableResults:r,errorMessage:i})}}$.displayName="MetricsWidgetQueries";const A=$;var N=s("./app/views/dashboardsV2/widgetCard/widgetQueries.tsx");function V(e){let{location:t,router:s,api:r,organization:n,selection:o,widget:a,isMobile:u,renderErrorMessage:c,tableItemLimit:p,windowWidth:g,onZoom:m,onLegendSelectChanged:h,legendOptions:v,expandNumbers:f,onDataFetched:y}=e;return a.widgetType===l.l9.ISSUE?(0,b.tZ)(R.Z,{api:r,organization:n,widget:a,selection:o,limit:p,children:e=>{let{transformedResults:s,errorMessage:r,loading:l}=e;return(0,b.BX)(i.Fragment,{children:["function"==typeof c?c(r):null,(0,b.tZ)(U,{loading:l}),(0,b.tZ)(w,{transformedResults:s,loading:l,errorMessage:r,widget:a,organization:n,location:t,selection:o})]})}}):a.widgetType===l.l9.METRICS?(0,b.tZ)(A,{api:r,organization:n,widget:a,selection:o,limit:null!==(x=a.limit)&&void 0!==x?x:p,children:e=>{let{tableResults:r,timeseriesResults:l,errorMessage:p,loading:m}=e;return(0,b.BX)(i.Fragment,{children:["function"==typeof c?c(p):null,(0,b.tZ)(d.Z,{timeseriesResults:l,tableResults:r,errorMessage:p,loading:m,location:t,widget:a,selection:o,router:s,organization:n,isMobile:u,windowWidth:g})]})}}):(0,b.tZ)(N.Z,{api:r,organization:n,widget:a,selection:o,limit:p,onDataFetched:y,children:e=>{let{tableResults:r,timeseriesResults:l,errorMessage:p,loading:y}=e;return(0,b.BX)(i.Fragment,{children:["function"==typeof c?c(p):null,(0,b.tZ)(d.Z,{timeseriesResults:l,tableResults:r,errorMessage:p,loading:y,location:t,widget:a,selection:o,router:s,organization:n,isMobile:u,windowWidth:g,onZoom:m,onLegendSelectChanged:h,legendOptions:v,expandNumbers:f})]})}});var x}V.displayName="WidgetCardChartContainer";const B=(0,n.withRouter)(V),W=(0,r.Z)((e=>(0,b.tZ)(o.Z,{...e,maskBackgroundColor:"transparent"})),{target:"e14ay5ol0"})({name:"1vcob1d",styles:"display:flex;justify-content:center;align-items:center"}),U=e=>{let{loading:t}=e;return t?(0,b.tZ)(W,{visible:t,children:(0,b.tZ)(a.Z,{mini:!0})}):null};U.displayName="LoadingScreen"},"./app/views/dashboardsV2/widgetCard/widgetQueries.tsx":(e,t,s)=>{s.d(t,{Z:()=>R});var r=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),i=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/react/index.js")),n=s("../node_modules/lodash/cloneDeep.js"),o=s.n(n),a=s("../node_modules/lodash/isEqual.js"),l=s.n(a),d=s("../node_modules/lodash/omit.js"),u=s.n(d),c=s("./app/actionCreators/events.tsx"),p=s("./app/components/charts/utils.tsx"),g=s("./app/components/organizations/pageFilters/utils.tsx"),m=s("./app/locale.tsx"),h=s("./app/utils/discover/genericDiscoverQuery.tsx"),v=s("./app/utils/discover/types.tsx"),f=s("./app/views/dashboardsV2/types.tsx"),y=s("./app/views/dashboardsV2/utils.tsx");function b(e,t){var s,r;return{seriesName:t,data:null!==(s=null==e||null===(r=e.data)||void 0===r?void 0:r.map((e=>{let[t,s]=e;return{name:1e3*t,value:s.reduce(((e,t)=>{let{count:s}=t;return e+s}),0)}})))&&void 0!==s?s:[]}}function w(e,t){const s=[];return Object.keys(e).forEach((r=>{Object.keys(u()(e[r],"order")).forEach((i=>{const n=`${r} : ${i}`,o=t?`${t} > ${n}`:n,a=e[r][i];s.push([e[r].order||0,b(a,o)])}))})),s}function x(e,t,s){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=[];const n=e.name;if((0,p.Xe)(t)){let o=[];const a=e.aggregates.length>1&&e.columns.length;o=r&&s!==f.FO.TOP_N&&a?w(t,n):Object.keys(t).map((e=>{const s=n?`${n} : ${e}`:e,r=t[e];return[r.order||0,b(r,s)]})),i=[...o.sort().map((e=>e[1]))]}else{const s=e.aggregates[0],r=b(t,n?`${n} : ${s}`:s);i.push(r)}return i}class Z extends i.Component{constructor(){super(...arguments),(0,r.Z)(this,"state",{loading:!0,queryFetchID:void 0,errorMessage:void 0,timeseriesResults:void 0,rawResults:void 0,tableResults:void 0,pageLinks:void 0}),(0,r.Z)(this,"_isMounted",!1)}componentDidMount(){this._isMounted=!0,this.fetchData()}componentDidUpdate(e){var t;const{selection:s,widget:r,cursor:i,organization:n}=this.props,o=n.features.includes("new-widget-builder-experience-design"),[a,d]=e.widget.queries.map((e=>(e.aggregates=e.aggregates.filter((e=>!!e)),e.columns=e.columns.filter((e=>!!e)),e))).reduce(((e,t)=>{let[s,r]=e,{name:i,...n}=t;return s.push(i),r.push(n),[s,r]}),[[],[]]),[u,c]=r.queries.map((e=>(e.aggregates=e.aggregates.filter((e=>!!e&&"equation|"!==e)),e.columns=e.columns.filter((e=>!!e&&"equation|"!==e)),e))).reduce(((e,t)=>{let[s,r]=e,{name:i,...n}=t;return s.push(i),r.push(n),[s,r]}),[[],[]]);r.limit===e.widget.limit&&l()(r.displayType,e.widget.displayType)&&l()(r.interval,e.widget.interval)&&l()(c,d)&&(0,g.WO)(s,e.selection)&&i===e.cursor?this.state.loading||l()(a,u)||(null===(t=this.state.rawResults)||void 0===t?void 0:t.length)!==r.queries.length||this.setState((e=>{const t=r.queries.reduce(((t,s,i)=>t.concat(x(s,e.rawResults[i],r.displayType,o))),[]);return{...e,timeseriesResults:t}})):this.fetchData()}componentWillUnmount(){this._isMounted=!1}fetchEventData(e){const{selection:t,api:s,organization:r,widget:i,limit:n,cursor:o,pagination:a,onDataFetched:l}=this.props;let d=[];const u=i.queries.map((e=>{const l=(0,y.tT)(i.title,e,t);let d="";const u={per_page:null!=n?n:f.$V,...a?{cursor:o}:{noPagination:!0}};if("table"===i.displayType)d=`/organizations/${r.slug}/eventsv2/`,u.referrer="api.dashboards.tablewidget";else if("big_number"===i.displayType)d=`/organizations/${r.slug}/eventsv2/`,u.per_page=1,u.referrer="api.dashboards.bignumberwidget";else{if("world_map"!==i.displayType)throw Error("Expected widget displayType to be either big_number, table or world_map");d=`/organizations/${r.slug}/events-geo/`,delete u.per_page,u.referrer="api.dashboards.worldmapwidget"}return(0,h.AA)(s,d,{...l.generateQueryStringObject(),...u})}));let c=0;u.forEach((async(t,s)=>{try{var r,n;const[o,a,p]=await t,g=o;if(g.title=null!==(r=null===(n=i.queries[s])||void 0===n?void 0:n.name)&&void 0!==r?r:"",d=[...d,g],!this._isMounted)return;null==l||l({tableResults:d}),this.setState((t=>t.queryFetchID!==e?t:{...t,tableResults:d,pageLinks:null==p?void 0:p.getResponseHeader("Link")}))}catch(e){var o;const t=(null==e||null===(o=e.responseJSON)||void 0===o?void 0:o.detail)||(0,m.t)("An unknown error occurred.");this.setState({errorMessage:t})}finally{if(c++,!this._isMounted)return;this.setState((t=>t.queryFetchID!==e?t:{...t,loading:c!==u.length}))}}))}fetchTimeseriesData(e,t){const{selection:s,api:r,organization:i,widget:n,onDataFetched:a}=this.props,l=i.features.includes("new-widget-builder-experience-design");this.setState({timeseriesResults:[],rawResults:[]});const{environments:d,projects:u}=s,{start:p,end:g,period:h}=s.datetime,b=(0,y.s)(n,{start:p,end:g,period:h}),w=n.queries.map((e=>{let s;var o,a;return"top_n"===n.displayType?(s={organization:i,interval:b,start:p,end:g,project:u,environment:d,period:h,query:e.conditions,yAxis:e.aggregates[e.aggregates.length-1],includePrevious:!1,referrer:`api.dashboards.widget.${t}-chart`,partial:!0,topEvents:v.hY,field:[...e.columns,...e.aggregates]},e.orderby&&(s.orderby=e.orderby)):(s={organization:i,interval:b,start:p,end:g,project:u,environment:d,period:h,query:e.conditions,yAxis:e.aggregates,orderby:e.orderby,includePrevious:!1,referrer:`api.dashboards.widget.${t}-chart`,partial:!0},i.features.includes("new-widget-builder-experience-design")&&[f.FO.AREA,f.FO.BAR,f.FO.LINE].includes(t)&&0!==(null===(o=e.columns)||void 0===o?void 0:o.length)&&(s.topEvents=null!==(a=n.limit)&&void 0!==a?a:v.hY,s.field=[...e.columns,...e.aggregates])),(0,c.lI)(r,s)}));let Z=0;w.forEach((async(t,s)=>{try{const r=await t;if(!this._isMounted)return;this.setState((t=>{var i,d;if(t.queryFetchID!==e)return t;const u=[...null!==(i=t.timeseriesResults)&&void 0!==i?i:[]],c=x(n.queries[s],r,n.displayType,l);c.forEach(((e,t)=>{u[s*c.length+t]=e}));const p=o()(null!==(d=t.rawResults)&&void 0!==d?d:[]);return p[s]=r,null==a||a({timeseriesResults:u}),{...t,timeseriesResults:u,rawResults:p}}))}catch(e){var r;const t=(null==e||null===(r=e.responseJSON)||void 0===r?void 0:r.detail)||(0,m.t)("An unknown error occurred.");this.setState({errorMessage:t})}finally{if(Z++,!this._isMounted)return;this.setState((t=>t.queryFetchID!==e?t:{...t,loading:Z!==w.length}))}}))}fetchData(){const{widget:e}=this.props,t=Symbol("queryFetchID");this.setState({loading:!0,errorMessage:void 0,queryFetchID:t}),["table","world_map","big_number"].includes(e.displayType)?this.fetchEventData(t):this.fetchTimeseriesData(t,e.displayType)}render(){const{children:e}=this.props,{loading:t,timeseriesResults:s,tableResults:r,errorMessage:i,pageLinks:n}=this.state;return e({loading:t,timeseriesResults:null==s?void 0:s.filter((e=>!!e)),tableResults:r,errorMessage:i,pageLinks:n})}}Z.displayName="WidgetQueries";const R=Z}}]);
//# sourceMappingURL=../sourcemaps/app_components_modals_widgetViewerModal_utils_tsx-app_views_dashboardsV2_widgetCard_widgetCar-7a3063.70331a6c86d63661ce67fe39b8b0283f.js.map