"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_utils_performance_spanOperationBreakdowns_constants_tsx-app_views_dashboardsV2_widgetBuil-c85449"],{"./app/utils/performance/spanOperationBreakdowns/constants.tsx":(e,t,i)=>{i.d(t,{$:()=>s});const s=["spans.browser","spans.http","spans.db","spans.resource"]},"./app/utils/usePrevious.tsx":(e,t,i)=>{i.d(t,{Z:()=>r});var s=i("../node_modules/react/index.js");const r=function(e){const t=(0,s.useRef)(e);return(0,s.useEffect)((()=>{t.current=e}),[e]),t.current}},"./app/views/dashboardsV2/widgetBuilder/buildSteps/filterResultsStep/issuesSearchBar.tsx":(e,t,i)=>{i.d(t,{i:()=>g});var s=i("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=i("../node_modules/@emotion/react/dist/emotion-react.browser.esm.js"),a=i("./app/actionCreators/tags.tsx"),o=i("./app/utils/dates.tsx"),n=i("./app/utils/useApi.tsx"),d=i("./app/utils/withIssueTags.tsx"),l=i("./app/views/dashboardsV2/widgetBuilder/utils.tsx"),u=i("./app/views/issueList/searchBar.tsx"),c=i("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function p(e){let{tags:t,onSearch:i,onBlur:s,organization:d,query:u,selection:p,searchSource:g}=e;const h=(0,n.Z)();function y(e,t){const i=d.slug,s=p.projects.map((e=>e.toString())),r={start:(0,o.v5)(p.datetime.start),end:(0,o.v5)(p.datetime.end),statsPeriod:p.datetime.period};return(0,a.Fo)(h,i,e,t,s,r)}return(0,c.tZ)(r.ms,{children:e=>{let{css:r}=e;return(0,c.tZ)(m,{searchSource:g,organization:d,query:u.conditions||"",sort:"",onSearch:i,onBlur:s,excludeEnvironment:!0,supportedTags:t,tagValueLoader:y,onSidebarToggle:()=>{},maxSearchItems:l.yM,dropdownClassName:r`
            max-height: ${l.CD}px;
            overflow-y: auto;
          `})}})}p.displayName="IssuesSearchBarContainer";const g=(0,d.Z)(p),m=(0,s.Z)(u.Z,{target:"ewve4jj0"})({name:"1hoyb5r",styles:"flex-grow:1;button:not([aria-label='Clear search']){display:none;}"})},"./app/views/dashboardsV2/widgetBuilder/index.tsx":(e,t,i)=>{i.r(t),i.d(t,{default:()=>Lt});var s=i("../node_modules/react/index.js"),r=i("./app/components/acl/feature.tsx"),a=i("./app/components/alert.tsx"),o=i("./app/locale.tsx"),n=i("./app/styles/organization.tsx"),d=i("./app/utils/useOrganization.tsx"),l=i("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),u=(i("../node_modules/core-js/modules/web.dom-collections.iterator.js"),i("../node_modules/core-js/modules/es.string.replace.js"),i("../node_modules/lodash/cloneDeep.js")),c=i.n(u),p=i("../node_modules/lodash/isEmpty.js"),g=i.n(p),m=i("../node_modules/lodash/omit.js"),h=i.n(m),y=i("../node_modules/lodash/set.js"),f=i.n(y),b=i("./app/actionCreators/dashboards.tsx"),v=i("./app/actionCreators/indicator.tsx"),w=i("./app/actionCreators/members.tsx"),Z=i("./app/actionCreators/tags.tsx"),S=i("./app/components/dashboards/widgetQueriesForm.tsx"),T=i("./app/components/layouts/thirds.tsx"),x=i("./app/components/list/index.tsx"),E=i("./app/components/loadingError.tsx"),C=i("./app/components/organizations/pageFilters/container.tsx"),q=i("./app/components/sentryDocumentTitle.tsx"),O=i("./app/styles/space.tsx"),B=i("./app/types/index.tsx"),A=i("./app/utils.tsx"),F=i("./app/utils/analytics/trackAdvancedAnalyticsEvent.tsx"),N=i("./app/utils/discover/fields.tsx"),k=i("./app/utils/handleXhrErrorResponse.tsx"),_=i("./app/utils/useApi.tsx"),L=i("./app/utils/withPageFilters.tsx"),I=i("./app/utils/withTags.tsx"),D=i("./app/views/dashboardsV2/layoutUtils.tsx"),R=i("./app/views/dashboardsV2/types.tsx"),z=i("./app/views/issueList/utils.tsx"),j=i("./app/views/dashboardsV2/data.tsx"),V=i("./app/components/links/externalLink.tsx"),P=i("./app/utils/measurements/measurements.tsx"),M=i("./app/views/dashboardsV2/widgetBuilder/issueWidget/utils.tsx"),U=i("./app/views/dashboardsV2/widgetBuilder/utils.tsx"),W=i("./app/components/list/listItem.tsx"),H=i("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function X(e){let{title:t,description:i,required:s=!1,children:r}=e;return(0,H.BX)($,{children:[(0,H.BX)(G,{children:[t,s&&(0,H.tZ)(J,{})]}),(0,H.tZ)(Q,{children:i}),(0,H.tZ)(Y,{children:r})]})}X.displayName="BuildStep";const $=(0,l.Z)(W.Z,{target:"ecpormx4"})({name:"vetbs0",styles:"display:grid"}),G=(0,l.Z)("h5",{target:"ecpormx3"})("margin-bottom:0;color:",(e=>e.theme.gray500),";"),Q=(0,l.Z)("small",{target:"ecpormx2"})("color:",(e=>e.theme.gray300),";padding:",(0,O.Z)(.25)," ",(0,O.Z)(2)," ",(0,O.Z)(2)," 0;@media (max-width: ",(e=>e.theme.breakpoints[0]),"){padding-top:",(0,O.Z)(1),";margin-left:-",(0,O.Z)(4),";}"),Y=(0,l.Z)("div",{target:"ecpormx1"})("display:grid;@media (max-width: ",(e=>e.theme.breakpoints[0]),"){margin-left:-",(0,O.Z)(4),";}"),J=(0,l.Z)("div",{target:"ecpormx0"})("background:",(e=>e.theme.red300),";opacity:0.6;width:5px;height:5px;border-radius:5px;margin-left:",(0,O.Z)(.5),";display:inline-block;vertical-align:super;");var K=i("./app/components/forms/field/index.tsx"),ee=i("./app/views/eventsV2/table/columnEditCollection.tsx");function te(e){var t;let{displayType:i,fieldOptions:s,widgetType:r,fields:a,organization:o,errors:n,onChange:d,filterPrimaryOptions:l,noFieldsMessage:u}=e;return(0,H.tZ)(K.Z,{inline:!1,error:null==n||null===(t=n.find((e=>null==e?void 0:e.fields)))||void 0===t?void 0:t.fields,flexibleControlStateSize:!0,stacked:!0,children:i===R.FO.TABLE?(0,H.tZ)(ie,{columns:a,onChange:d,fieldOptions:s,organization:o,source:r,showAliasField:o.features.includes("new-widget-builder-experience-design"),filterPrimaryOptions:l,noFieldsMessage:u}):(0,H.tZ)(ie,{columns:a.slice(0,a.length-1),onChange:e=>{d([...e,a[a.length-1]])},fieldOptions:s,organization:o,source:r,filterPrimaryOptions:l,noFieldsMessage:u})})}te.displayName="ColumnFields";const ie=(0,l.Z)(ee.Z,{target:"e2w4m990"})("margin-top:",(0,O.Z)(1),";");var se=i("./app/views/dashboardsV2/widgetBuilder/releaseWidget/fields.tsx");function re(e){let{displayType:t,organization:i,widgetType:s,explodedFields:r,queryErrors:a,onYAxisOrColumnFieldChange:n}=e;return(0,H.tZ)(te,{displayType:t,organization:i,widgetType:s,fields:r,errors:null!=a&&a[0]?[null==a?void 0:a[0]]:void 0,fieldOptions:(0,se.e1)(Object.values(se.Jo),se.ve),filterPrimaryOptions:e=>(0,U.wy)({option:e,widgetType:s,displayType:t}),onChange:n,noFieldsMessage:(0,o.t)("There are no metrics for this project.")})}function ae(e){let{dataSet:t,displayType:i,onQueryChange:s,organization:r,queries:a,widgetType:n,onYAxisOrColumnFieldChange:d,queryErrors:l,explodedFields:u,tags:p}=e;return(0,H.tZ)(X,{title:(0,o.t)("Choose your columns"),description:t===U.qg.ISSUES?(0,o._N)("[fieldTagLink: Field and tag] columns will help you view more details about the issues (e.g., title).",{fieldTagLink:(0,H.tZ)(V.Z,{href:"https://docs.sentry.io/product/sentry-basics/search/searchable-properties/#event-properties"})}):(0,o._N)("To stack events, add [functionLink: functions] f(x) that may take in additional parameters. [fieldTagLink: Field and tag] columns will help you view more details about the events (e.g., title).",{functionLink:(0,H.tZ)(V.Z,{href:"https://docs.sentry.io/product/discover-queries/query-builder/#filter-by-table-columns"}),fieldTagLink:(0,H.tZ)(V.Z,{href:"https://docs.sentry.io/product/sentry-basics/search/searchable-properties/#event-properties"})}),children:t===U.qg.EVENTS?(0,H.tZ)(P.Z,{children:e=>{let{measurements:t}=e;return(0,H.tZ)(te,{displayType:i,organization:r,widgetType:n,fields:u,errors:l,fieldOptions:(0,U.jd)({measurements:t,organization:r,tags:p}),onChange:d})}}):t===U.qg.ISSUES?(0,H.tZ)(te,{displayType:i,organization:r,widgetType:n,fields:u,errors:null!=l&&l[0]?[null==l?void 0:l[0]]:void 0,fieldOptions:(0,M.S)(),onChange:e=>{const t=e.map(N.sN),i=(0,N.KZ)(e),r=c()(a[0]);r.fields=t,r.aggregates=i.aggregates,r.columns=i.columns,r.fieldAliases=i.fieldAliases,s(0,r)}}):(0,H.tZ)(re,{displayType:i,organization:r,widgetType:n,explodedFields:u,queryErrors:l,onYAxisOrColumnFieldChange:d})})}re.displayName="ReleaseColumnFields",ae.displayName="ColumnsStep";var oe=i("./app/components/forms/selectControl.tsx"),ne=i("./app/components/forms/selectOption.tsx"),de=i("./app/components/tooltip.tsx");function le(e){let{dashboards:t,error:i,onChange:s,disabled:r}=e;return(0,H.tZ)(X,{title:(0,o.t)("Choose your dashboard"),description:(0,o.t)("Choose which dashboard you'd like to add this query to. It will appear as a widget."),required:!0,children:(0,H.tZ)(K.Z,{inline:!1,flexibleControlStateSize:!0,stacked:!0,error:i,children:(0,H.tZ)(oe.Z,{menuPlacement:"auto",name:"dashboard",placeholder:(0,o.t)("Select a dashboard"),options:[{label:(0,o.t)("+ Create New Dashboard"),value:"new"},...t.map((e=>{let{title:t,id:i,widgetDisplay:s}=e;return{label:t,value:i,isDisabled:s.length>=R.ZU}}))],onChange:e=>{e.disabled||s(e)},disabled:r,components:{Option:e=>{let{label:t,data:i,...s}=e;return(0,H.tZ)(de.ZP,{disabled:!i.isDisabled,title:(0,o._N)("Max widgets ([maxWidgets]) per dashboard reached.",{maxWidgets:R.ZU}),containerDisplayMode:"block",position:"right",children:(0,H.tZ)(ne.Z,{label:t,data:i,...s})})}}})})})}le.displayName="DashboardStep";var ue=i("./app/components/forms/controls/radioGroup.tsx");const ce=[[U.qg.EVENTS,(0,o.t)("Errors and Transactions")],[U.qg.ISSUES,(0,o.t)("Issues (States, Assignment, Time, etc.)")]];function pe(e){let{dataSet:t,onChange:i,widgetBuilderNewDesign:s,displayType:r}=e;const a=[];return r!==R.FO.TABLE&&(a.push([U.qg.ISSUES,(0,o.t)("This data set is restricted to tabular visualization.")]),r===R.FO.WORLD_MAP&&a.push([U.qg.RELEASE,(0,o.t)("This data set is restricted to big number, tabular and time series visualizations.")])),(0,H.tZ)(X,{title:(0,o.t)("Choose your data set"),description:(0,o._N)("This reflects the type of information you want to use. To learn more, [link: read the docs].",{link:(0,H.tZ)(V.Z,{href:"https://docs.sentry.io/product/dashboards/custom-dashboards/#data-set-selection"})}),children:(0,H.tZ)(ge,{label:"dataSet",value:t,choices:s?[...ce,[U.qg.RELEASE,(0,o.t)("Releases (sessions, crash rates)")]]:ce,disabledChoices:a,onChange:e=>{i(e)}})})}pe.displayName="DataSetStep";const ge=(0,l.Z)(ue.Z,{target:"e1eujfdx0"})("gap:",(0,O.Z)(2),";@media (min-width: ",(e=>e.theme.breakpoints[2]),"){grid-auto-flow:column;}");var me=i("./app/components/button.tsx"),he=i("./app/components/forms/controls/input.tsx"),ye=i("./app/icons/index.tsx"),fe=i("./app/components/events/searchBar.tsx"),be=i("./app/constants/index.tsx");function ve(e){let{projectIds:t,onSearch:i,onBlur:s,organization:r,query:a}=e;return(0,H.tZ)(we,{searchSource:"widget_builder",organization:r,projectIds:t,query:a.conditions,fields:[],onSearch:i,onBlur:s,useFormWrapper:!1,maxQueryLength:be.dI,maxSearchItems:U.yM,maxMenuHeight:U.CD})}ve.displayName="EventsSearchBar";const we=(0,l.Z)(fe.Z,{target:"e1pc9id60"})({name:"1ff36h2",styles:"flex-grow:1"});var Ze=i("./app/views/dashboardsV2/widgetBuilder/buildSteps/filterResultsStep/issuesSearchBar.tsx"),Se=i("./app/views/dashboardsV2/widgetBuilder/buildSteps/filterResultsStep/releaseSearchBar.tsx");function Te(e){let{canAddSearchConditions:t,queries:i,onQueryRemove:r,onAddSearchConditions:a,onQueryChange:n,organization:d,hideLegendAlias:l,projectIds:u,queryErrors:c,widgetType:p,selection:g}=e;const m=(0,s.useRef)(void 0);(0,s.useEffect)((()=>()=>{window.clearTimeout(m.current)}),[]);const h=(0,s.useCallback)((e=>t=>{window.clearTimeout(m.current),m.current=window.setTimeout((()=>{m.current=void 0}),200);const s={...i[e],conditions:t};n(e,s)}),[i]),y=(0,s.useCallback)((e=>t=>{if(!m.current){const s={...i[e],conditions:t};n(e,s)}}),[i]);return(0,H.tZ)(X,{title:(0,o.t)("Filter your results"),description:t?(0,o.t)("This is how you filter down your search. You can add multiple queries to compare data for each overlay."):(0,o.t)("This is how you filter down your search."),children:(0,H.BX)("div",{children:[i.map(((e,t)=>{var s;return(0,H.tZ)(Ee,{inline:!1,flexibleControlStateSize:!0,stacked:!0,error:null==c||null===(s=c[t])||void 0===s?void 0:s.conditions,children:(0,H.BX)(Ce,{children:[p===R.l9.ISSUE?(0,H.tZ)(Ze.i,{searchSource:"widget_builder",organization:d,query:e,onBlur:y(t),onSearch:h(t),selection:g}):p===R.l9.DISCOVER?(0,H.tZ)(ve,{organization:d,query:e,projectIds:u,onBlur:y(t),onSearch:h(t)}):(0,H.tZ)(Se.D,{orgSlug:d.slug,query:e,projectIds:u,onBlur:y(t),onSearch:h(t)}),!l&&(0,H.tZ)(xe,{type:"text",name:"name",value:e.name,placeholder:(0,o.t)("Legend Alias"),onChange:e=>{const s={...i[t],name:e.target.value};n(t,s)}}),i.length>1&&(0,H.tZ)(me.ZP,{size:"zero",borderless:!0,onClick:()=>r(t),icon:(0,H.tZ)(ye.Fz,{}),title:(0,o.t)("Remove query"),"aria-label":(0,o.t)("Remove query")})]})},t)})),t&&(0,H.tZ)(me.ZP,{size:"small",icon:(0,H.tZ)(ye.N_,{isCircled:!0}),onClick:a,children:(0,o.t)("Add Query")})]})})}Te.displayName="FilterResultsStep";const xe=(0,l.Z)(he.Z,{target:"e12061i92"})({name:"1f6lq61",styles:"width:33%"}),Ee=(0,l.Z)(K.Z,{target:"e12061i91"})("padding-bottom:",(0,O.Z)(1),";"),Ce=(0,l.Z)("div",{target:"e12061i90"})("display:flex;align-items:center;>*+*{margin-left:",(0,O.Z)(1),";}");var qe=i("./app/views/eventsV2/table/queryField.tsx"),Oe=i("./app/views/eventsV2/table/types.tsx");const Be={kind:Oe.L.FIELD,field:""};function Ae(e){var t;let{fieldOptions:i,columns:r=[],onChange:a}=e;function n(e){return e.value.kind!==Oe.L.FUNCTION}function d(){const e=0===r.length?[{...Be},{...Be}]:[...r,{...Be}];a(e)}function l(e,t){const i=[...r];0===r.length?i.push(e):(0,A.ri)(t)&&(i[t]=e),a(i)}if(0===r.length)return(0,H.BX)(s.Fragment,{children:[(0,H.tZ)(Fe,{inline:!1,flexibleControlStateSize:!0,stacked:!0,children:(0,H.tZ)(Ne,{children:(0,H.tZ)(qe.q,{placeholder:(0,o.t)("Select group"),fieldValue:Be,fieldOptions:i,onChange:e=>l(e,0),filterPrimaryOptions:n})})}),(0,H.tZ)(ke,{size:"small",icon:(0,H.tZ)(ye.N_,{isCircled:!0}),onClick:d,children:(0,o.t)("Add Group")})]});const u=1===r.length&&r[0].kind===Oe.L.FIELD&&""!==(null===(t=r[0])||void 0===t?void 0:t.field),c=r.length>1||u;return(0,H.BX)(s.Fragment,{children:[(0,H.tZ)(Fe,{inline:!1,flexibleControlStateSize:!0,stacked:!0,children:r.map(((e,t)=>(0,H.BX)(Ne,{children:[(0,H.tZ)(qe.q,{placeholder:(0,o.t)("Select group"),fieldValue:e,fieldOptions:i,onChange:e=>l(e,t),filterPrimaryOptions:n}),c&&(0,H.tZ)(me.ZP,{size:"zero",borderless:!0,onClick:()=>function(e){const t=[...r];t.splice(e,1),a(t)}(t),icon:(0,H.tZ)(ye.Fz,{}),title:(0,o.t)("Remove group"),"aria-label":(0,o.t)("Remove group")})]},`groupby-${t}`)))}),r.length<20&&(0,H.tZ)(ke,{size:"small",icon:(0,H.tZ)(ye.N_,{isCircled:!0}),onClick:d,children:(0,o.t)("Add Group")})]})}Ae.displayName="GroupBySelector";const Fe=(0,l.Z)(K.Z,{target:"esrd23w2"})("padding-bottom:",(0,O.Z)(1),";"),Ne=(0,l.Z)("div",{target:"esrd23w1"})("display:flex;align-items:center;justify-content:space-between;:not(:last-child){margin-bottom:",(0,O.Z)(1),";}>*+*{margin-left:",(0,O.Z)(1),";}"),ke=(0,l.Z)(me.ZP,{target:"esrd23w0"})({name:"b9l38d",styles:"width:min-content"});function _e(e){let{columns:t,onChange:i}=e;const s=Object.values(se.ve).sort(((e,t)=>e.localeCompare(t))).reduce(((e,t)=>(e[`tag:${t}`]={label:t,value:{kind:Oe.L.TAG,meta:{name:t,dataType:"string"}}},e)),{});return(0,H.tZ)(Ae,{columns:t,fieldOptions:s,onChange:i})}function Le(e){let{dataSet:t,columns:i,onGroupByChange:s,organization:r,tags:a}=e;return(0,H.tZ)(X,{title:(0,o.t)("Group your results"),description:(0,o.t)("This is how you can group your data result by field or tag."),children:t===U.qg.RELEASE?(0,H.tZ)(_e,{columns:i,onChange:s}):(0,H.tZ)(P.Z,{children:e=>{let{measurements:t}=e;return(0,H.tZ)(Ae,{columns:i,fieldOptions:(0,U.jd)({measurements:t,tags:a,organization:r}),onChange:s})}})})}_e.displayName="ReleaseGroupBySelector",Le.displayName="GroupByStep";var Ie=i("../node_modules/lodash/uniqBy.js"),De=i.n(Ie);function Re(e){let{values:t,sortByOptions:i,widgetType:s,onChange:r}=e;return(0,H.BX)(ze,{children:[(0,H.tZ)(de.ZP,{title:s===R.l9.ISSUE?(0,o.t)("Issues dataset does not yet support descending order"):void 0,disabled:s!==R.l9.ISSUE,children:(0,H.tZ)(oe.Z,{name:"sortDirection",menuPlacement:"auto",disabled:s===R.l9.ISSUE,options:Object.keys(U.Qj).map((e=>({label:U.Qj[e],value:e}))),value:t.sortDirection,onChange:e=>{r({sortBy:t.sortBy,sortDirection:e.value})}})}),(0,H.tZ)(oe.Z,{name:"sortBy",menuPlacement:"auto",placeholder:`${(0,o.t)("Select a column")}â€¦`,value:t.sortBy,options:De()(i,(e=>{let{value:t}=e;return t})),onChange:e=>{r({sortBy:e.value,sortDirection:t.sortDirection})}})]})}Re.displayName="SortBySelectors";const ze=(0,l.Z)("div",{target:"e1grfh1l0"})("display:grid;gap:",(0,O.Z)(1),";@media (min-width: ",(e=>e.theme.breakpoints[0]),"){grid-template-columns:200px 1fr;}");function je(e){let{displayType:t,onSortByChange:i,queries:s,dataSet:r,widgetBuilderNewDesign:a,widgetType:n,organization:d,error:l,limit:u,onLimitChange:c}=e;const p=s[0].orderby;return a?(0,H.tZ)(X,{title:t===R.FO.TABLE?(0,o.t)("Sort by a column"):(0,o.t)("Sort by a y-axis"),description:t===R.FO.TABLE?(0,o.t)("Choose one of the columns you've created to sort by."):(0,o.t)("Choose one of the y-axis you've created to sort by."),children:(0,H.BX)(K.Z,{inline:!1,error:l,flexibleControlStateSize:!0,stacked:!0,children:[[R.FO.AREA,R.FO.BAR,R.FO.LINE].includes(t)&&u&&(0,H.tZ)(Ve,{name:"resultsLimit",menuPlacement:"auto",options:[...Array(U.BC).keys()].map((e=>{const t=e+1;return{label:(0,o.tn)("Limit to %s result","Limit to %s results",t),value:t}})),value:u,onChange:e=>{c(e.value)}}),(0,H.tZ)(Re,{widgetType:n,sortByOptions:r===U.qg.ISSUES?(0,M.W)(d.features.includes("issue-list-trend-sort")):(0,S._4)({widgetType:n,widgetBuilderNewDesign:!0,columns:s[0].columns,aggregates:s[0].aggregates}),values:{sortDirection:"-"===p[0]?U.Sr.HIGH_TO_LOW:U.Sr.LOW_TO_HIGH,sortBy:"-"===p[0]?p.substring(1,p.length):p},onChange:e=>{let{sortDirection:t,sortBy:s}=e;const r=t===U.Sr.HIGH_TO_LOW?`-${s}`:s;i(r)}})]})}):(0,H.tZ)(X,{title:(0,o.t)("Sort by a column"),description:(0,o.t)("Choose one of the columns you've created to sort by."),children:(0,H.tZ)(K.Z,{inline:!1,error:l,flexibleControlStateSize:!0,stacked:!0,children:(0,H.tZ)(oe.Z,{menuPlacement:"auto",value:r===U.qg.EVENTS?s[0].orderby:s[0].orderby||z.qh.DATE,name:"orderby",options:r===U.qg.EVENTS?(0,S._4)({widgetType:n,columns:s[0].columns,aggregates:s[0].aggregates}):(0,M.W)(d.features.includes("issue-list-trend-sort")),onChange:e=>{i(e.value)}})})})}je.displayName="SortByStep";const Ve=(0,l.Z)(oe.Z,{target:"e14t0x3e0"})("margin-bottom:",(0,O.Z)(1),";");var Pe=i("../node_modules/@emotion/react/dist/emotion-react.browser.esm.js"),Me=i("../node_modules/lodash/debounce.js"),Ue=i.n(Me),We=i("../node_modules/lodash/isEqual.js"),He=i.n(We),Xe=i("./app/components/charts/simpleTableChart.tsx"),$e=i("./app/components/panels/index.tsx"),Ge=i("./app/utils/usePrevious.tsx"),Qe=i("./app/views/dashboardsV2/widgetCard/index.tsx");function Ye(e){let{organization:t,pageFilters:i,displayType:r,error:a,onChange:n,widget:d}=e;const[l,u]=(0,s.useState)(d),c=(0,Ge.Z)(d),p=(0,s.useCallback)(Ue()(((e,t)=>{t||u(e)}),be.Dk),[]);return(0,s.useEffect)((()=>{let e=!1;return He()(c,d)||p(d,e),()=>{e=!0}}),[d,c]),(0,H.BX)(X,{title:(0,o.t)("Choose your visualization"),description:(0,o.t)("This is a preview of how your widget will appear in the dashboard."),children:[(0,H.tZ)(K.Z,{error:a,inline:!1,flexibleControlStateSize:!0,stacked:!0,children:(0,H.tZ)(oe.Z,{name:"displayType",options:Object.keys(U.hV).map((e=>({label:U.hV[e],value:e}))),value:r,onChange:e=>{n(e.value)}})}),(0,H.tZ)(Je,{displayType:r,children:(0,H.tZ)(Qe.Z,{organization:t,selection:i,widget:l,isEditing:!1,widgetLimitReached:!1,renderErrorMessage:e=>"string"==typeof e&&(0,H.tZ)($e.aU,{type:"error",children:e}),isSorting:!1,currentWidgetDragging:!1,noLazyLoad:!0})})]})}Ye.displayName="VisualizationStep";const Je=(0,l.Z)("div",{target:"e1huhsf60"})("padding-right:",(0,O.Z)(2),";",(e=>e.displayType===R.FO.TABLE&&(0,Pe.iv)(Xe.p,"{height:41px;}height:300px;overflow:hidden;","")),";");var Ke=i("./app/components/buttonBar.tsx"),et=i("./app/views/eventsV2/utils.tsx");function tt(e){let{title:t,onAdd:i}=e;return(0,H.tZ)(me.ZP,{size:"small",onClick:i,icon:(0,H.tZ)(ye.N_,{isCircled:!0}),children:t})}function it(e){let{onDelete:t}=e;return(0,H.tZ)(me.ZP,{size:"zero",borderless:!0,onClick:t,icon:(0,H.tZ)(ye.Fz,{}),title:(0,o.t)("Remove this Y-Axis"),"aria-label":(0,o.t)("Remove this Y-Axis")})}function st(e){var t;let{displayType:i,widgetType:s,aggregates:r,fieldOptions:a,onChange:n,errors:l,noFieldsMessage:u}=e;const c=(0,d.Z)(),p=s===R.l9.METRICS;function g(e){return t=>{if((0,U.sv)(i))return!0;if(e.kind!==Oe.L.FUNCTION)return!0;if(p||t.value.kind===Oe.L.METRICS)return!0;const s=e.function[0],r=(0,N._4)(s,t.value.meta.name);return r?(0,N.HW)(r):t.value.kind!==Oe.L.FUNCTION&&(0,N.HW)(t.value.meta.dataType)}}const m=null==l||null===(t=l.find((e=>null==e?void 0:e.aggregates)))||void 0===t?void 0:t.aggregates;if(i===R.FO.TOP_N){const e=r[r.length-1];return(0,H.tZ)(K.Z,{inline:!1,flexibleControlStateSize:!0,error:m,stacked:!0,children:(0,H.tZ)(rt,{children:(0,H.tZ)(qe.q,{fieldValue:e,fieldOptions:(0,et.R0)({organization:c}),onChange:function(e){n([e])},filterPrimaryOptions:e=>(0,U.wy)({option:e,widgetType:s,displayType:i}),filterAggregateParameters:g(e)})})})}const h=r.length>1,y=[R.FO.WORLD_MAP,R.FO.BIG_NUMBER].includes(i)&&1===r.length||[R.FO.LINE,R.FO.AREA,R.FO.BAR].includes(i)&&3===r.length;return(0,H.BX)(K.Z,{inline:!1,flexibleControlStateSize:!0,error:m,stacked:!0,children:[r.map(((e,t)=>(0,H.BX)(rt,{children:[(0,H.tZ)(qe.q,{fieldValue:e,fieldOptions:a,onChange:e=>function(e,t){const i=[...r];i[t]=e,n(i)}(e,t),filterPrimaryOptions:e=>(0,U.wy)({option:e,widgetType:s,displayType:i}),filterAggregateParameters:g(e),otherColumns:r,noFieldsMessage:u}),r.length>1&&(h||e.kind===Oe.L.EQUATION)&&(0,H.tZ)(it,{onDelete:e=>function(e,t){e.preventDefault();const i=[...r];i.splice(t,1),n(i)}(e,t)})]},`${e}:${t}`))),!y&&(0,H.BX)(at,{gap:1,children:[(0,H.tZ)(tt,{title:(0,o.t)("Add Overlay"),onAdd:function(e){e.preventDefault();const t=[...r,{kind:Oe.L.FIELD,field:""}];n(t)}}),!p&&(0,H.tZ)(tt,{title:(0,o.t)("Add an Equation"),onAdd:function(e){e.preventDefault();const t=[...r,{kind:Oe.L.EQUATION,field:""}];n(t)}})]})]})}tt.displayName="AddButton",it.displayName="DeleteButton",st.displayName="YAxisSelector";const rt=(0,l.Z)("div",{target:"ew36myz1"})("display:flex;align-items:center;justify-content:space-between;:not(:last-child){margin-bottom:",(0,O.Z)(1),";}>*+*{margin-left:",(0,O.Z)(1),";}"),at=(0,l.Z)(Ke.ZP,{target:"ew36myz0"})({name:"11g6mpt",styles:"justify-content:flex-start"});function ot(e){let{aggregates:t,displayType:i,widgetType:s,onChange:r,errors:a}=e;return(0,H.tZ)(st,{widgetType:s,displayType:i,aggregates:t,onChange:r,errors:a,fieldOptions:(0,se.e1)(Object.values(se.Jo),se.ve),noFieldsMessage:(0,o.t)("There are no metrics for this project.")})}function nt(e){let{displayType:t,dataSet:i,queryErrors:s,aggregates:r,onYAxisChange:a,organization:n,tags:d,widgetType:l}=e;return(0,H.tZ)(X,{title:t===R.FO.BIG_NUMBER?(0,o.t)("Choose what to plot"):(0,o.t)("Choose what to plot in the y-axis"),description:[R.FO.AREA,R.FO.BAR,R.FO.LINE].includes(t)?(0,o.t)("This is the data you'd be visualizing in the display. If the overlay units conflict, the charts will always base it off of the first line."):(0,o.t)("This is the data you'd be visualizing in the display."),children:i===U.qg.RELEASE?(0,H.tZ)(ot,{widgetType:l,displayType:t,aggregates:r,onChange:a,errors:s}):(0,H.tZ)(P.Z,{children:e=>{let{measurements:i}=e;return(0,H.tZ)(st,{widgetType:l,displayType:t,aggregates:r,fieldOptions:(0,U.jd)({measurements:i,organization:n,tags:d}),onChange:a,errors:s})}})})}ot.displayName="ReleaseYAxisSelector",nt.displayName="YAxisStep";var dt=i("./app/components/confirm.tsx");function lt(e){let{goBackLocation:t,onSave:i,onDelete:s,invalidForm:r,isEditing:a}=e;return(0,H.tZ)(ct,{children:(0,H.BX)(ut,{gap:1,children:[(0,H.tZ)(me.ZP,{to:t,children:(0,o.t)("Cancel")}),a&&s&&(0,H.tZ)(dt.Z,{priority:"danger",message:(0,o.t)("Are you sure you want to delete this widget?"),onConfirm:s,children:(0,H.tZ)(me.ZP,{priority:"danger",children:(0,o.t)("Delete")})}),(0,H.tZ)(me.ZP,{priority:"primary",onClick:i,disabled:r,title:r?(0,o.t)("Required fields must be filled out"):void 0,children:a?(0,o.t)("Update Widget"):(0,o.t)("Add Widget")})]})})}lt.displayName="Footer";const ut=(0,l.Z)(Ke.ZP,{target:"e1golk021"})("justify-content:flex-end;max-width:1000px;padding:",(0,O.Z)(4)," ",(0,O.Z)(2),";padding-right:calc(",(0,O.Z)(2)," + ",(0,O.Z)(2),");@media (min-width: ",(e=>e.theme.breakpoints[1]),"){padding:",(0,O.Z)(4),";padding-right:calc(",(0,O.Z)(4)," + ",(0,O.Z)(2),");}"),ct=(0,l.Z)("div",{target:"e1golk020"})("background:",(e=>e.theme.background),";border-top:1px solid ",(e=>e.theme.gray200),";");var pt=i("./app/components/breadcrumbs.tsx"),gt=i("./app/components/editableText.tsx");function mt(e){let{title:t,orgSlug:i,goBackLocation:s,dashboardTitle:r,onChangeTitle:a}=e;return(0,H.BX)(T.h4,{children:[(0,H.BX)(T.oB,{children:[(0,H.tZ)(pt.Z,{crumbs:[{to:`/organizations/${i}/dashboards/`,label:(0,o.t)("Dashboards")},{to:s,label:r},{label:(0,o.t)("Widget Builder")}]}),(0,H.tZ)(T.Dx,{children:(0,H.tZ)(gt.Z,{"aria-label":(0,o.t)("Widget title"),value:t,onChange:a,errorMessage:(0,o.t)("Widget title is required"),maxLength:255})})]}),(0,H.tZ)(T.kP,{children:(0,H.BX)(Ke.ZP,{gap:1,children:[(0,H.tZ)(me.ZP,{external:!0,title:(0,o.t)("How do you like the new widget builder? Submit feedback on GitHub."),href:"https://github.com/getsentry/sentry/issues/new/choose",children:(0,o.t)("Give Feedback")}),(0,H.tZ)(me.ZP,{external:!0,href:"https://docs.sentry.io/product/dashboards/custom-dashboards/#widget-builder",children:(0,o.t)("Read the docs")})]})})]})}mt.displayName="Header";var ht=i("../node_modules/@emotion/react/dist/emotion-element-a8309070.browser.esm.js"),yt=i("./app/actionCreators/modal.tsx"),ft=i("./app/views/dashboardsV2/widgetLibrary/data.tsx"),bt=i("./app/views/dashboardsV2/widgetBuilder/widgetLibrary/card.tsx");function vt(e){let{bypassOverwriteModal:t,onWidgetSelect:i,widgetBuilderNewDesign:r}=e;const a=(0,ht.u)();function n(e,s){return function(){t?i(e):(0,yt.openWidgetBuilderOverwriteModal)({onConfirm:()=>i(e),widget:e,iconColor:s})}}return(0,H.BX)(s.Fragment,{children:[(0,H.tZ)(Zt,{children:(0,o.t)("Widget Library")}),(0,H.tZ)(wt,{children:ft.c.map(((e,t)=>{const i=a.charts.getColorPalette(ft.c.length-2)[t],s=r&&e.displayType===R.FO.TOP_N?R.FO.TABLE:e.displayType,o=(0,U.Zi)({displayType:s,queries:e.queries,widgetBuilderNewDesign:r,widgetType:e.widgetType}),d={...e,displayType:s,queries:o};return(0,H.tZ)(St,{onClick:n(d,i),children:(0,H.tZ)(bt.Z,{widget:d,iconColor:i})},e.title)}))})]})}vt.displayName="WidgetLibrary";const wt=(0,l.Z)("div",{target:"ess72gf2"})({name:"1fttcpj",styles:"display:flex;flex-direction:column"}),Zt=(0,l.Z)("h5",{target:"ess72gf1"})("padding-left:calc(",(0,O.Z)(2)," - ",(0,O.Z)(.25),");"),St=(0,l.Z)("div",{target:"ess72gf0"})("padding:calc(",(0,O.Z)(2)," - 3px);border:1px solid transparent;border-radius:",(e=>e.theme.borderRadius),";transition:border-color 0.3s ease;cursor:pointer;&:hover{border-color:",(e=>e.theme.gray100),";}");function Tt(e){return{[U.qg.EVENTS]:{name:"",fields:["count()"],columns:[],fieldAliases:[],aggregates:["count()"],conditions:"",orderby:e?"-count":""},[U.qg.ISSUES]:{name:"",fields:["issue","assignee","title"],columns:["issue","assignee","title"],fieldAliases:[],aggregates:[],conditions:"",orderby:e?z.qh.DATE:""},[U.qg.RELEASE]:{name:"",fields:[`sum(${B.Ol.SESSION})`],columns:[],fieldAliases:[],aggregates:[`sum(${B.Ol.SESSION})`],conditions:"",orderby:e?`-sum(${B.Ol.SESSION})`:""}}}const xt={[R.l9.DISCOVER]:U.qg.EVENTS,[R.l9.ISSUE]:U.qg.ISSUES,[R.l9.METRICS]:U.qg.RELEASE},Et={[U.qg.EVENTS]:R.l9.DISCOVER,[U.qg.ISSUES]:R.l9.ISSUE,[U.qg.RELEASE]:R.l9.METRICS};function Ct(e){var t,i,r,a,d,l,u,p;let{dashboard:m,params:y,location:T,organization:x,selection:O,start:B,end:L,statsPeriod:I,onSave:z,router:V,tags:P}=e;const{widgetIndex:M,orgId:W,dashboardId:X}=y,{source:$,displayType:G,defaultTitle:Q,defaultTableColumns:Y,limit:J}=T.query,K=(0,U.eQ)(T.query.defaultWidgetQuery);(0,s.useEffect)((()=>{(0,A.z)(P)&&(0,Z.QK)(de,x.slug,O)}),[]);const ee=(0,A.ri)(M),te=Number(M),ie=te>=0&&te<m.widgets.length&&Number.isInteger(te),se=x.slug,re=x.features.includes("new-widget-builder-experience-design"),oe=I?{...O,datetime:{start:null,end:null,period:I,utc:null}}:B&&L?{...O,datetime:{start:B,end:L,period:null,utc:null}}:O,ne=[R.EN.DISCOVERV2,R.EN.ISSUE_DETAILS].includes($),de=(0,_.Z)(),[ue,ce]=(0,s.useState)((()=>({title:null!=Q?Q:(0,o.t)("Custom Widget"),displayType:null!=G?G:R.FO.TABLE,interval:"5m",queries:[K?re?{...K,orderby:K.orderby||(0,S._4)({widgetType:R.l9.DISCOVER,widgetBuilderNewDesign:re,columns:K.columns,aggregates:K.aggregates})[0].value}:{...K}:{...Tt(re)[U.qg.EVENTS]}],limit:J,errors:void 0,loading:!!ne,dashboards:[],userHasModified:!1,dataSet:U.qg.EVENTS}))),[ge,me]=(0,s.useState)(null);(0,s.useEffect)((()=>{if((0,F.Z)("dashboards_views.widget_builder.opened",{organization:x,new_widget:!ee}),ee&&ie){var e;const t=m.widgets[te],i=re&&t.displayType===R.FO.TOP_N?R.FO.TABLE:t.displayType;ce({title:t.title,displayType:i,interval:t.interval,queries:(0,U.Zi)({displayType:i,queries:t.queries,widgetType:null!==(e=t.widgetType)&&void 0!==e?e:R.l9.DISCOVER,widgetBuilderNewDesign:re}),errors:void 0,loading:!1,dashboards:[],userHasModified:!1,dataSet:t.widgetType?xt[t.widgetType]:U.qg.EVENTS,limit:t.limit}),me(t)}}),[]),(0,s.useEffect)((()=>{ne&&async function(){const e=de.requestPromise(`/organizations/${x.slug}/dashboards/`,{method:"GET",query:{sort:"myDashboardsAndRecentlyViewed"}});try{const t=await e;ce((e=>({...e,dashboards:t,loading:!1})))}catch(e){const t=(0,o.t)("Unable to fetch dashboards");(0,v.Iw)(t),(0,k.Z)(t)(e),ce((e=>({...e,loading:!1})))}}(),re&&ce((e=>({...e,selectedDashboard:{label:m.title,value:m.id||U.i0}})))}),[$]),(0,s.useEffect)((()=>{var e;(0,w.MA)(de,x.slug,null===(e=O.projects)||void 0===e?void 0:e.map(String))}),[O.projects]);const he=ue.dataSet===U.qg.EVENTS?R.l9.DISCOVER:ue.dataSet===U.qg.ISSUES?R.l9.ISSUE:R.l9.METRICS,ye={title:ue.title,displayType:ue.displayType,interval:ue.interval,queries:ue.queries,limit:ue.limit,widgetType:he},fe=null!==(t=null===(i=ue.selectedDashboard)||void 0===i?void 0:i.value)&&void 0!==t?t:X,be=h()(T.query,"source"),ve={pathname:(0,A.ri)(fe)&&fe!==U.i0?`/organizations/${W}/dashboard/${fe}/`:`/organizations/${W}/dashboards/${U.i0}/`,query:g()(be)?void 0:be},we=[R.FO.LINE,R.FO.BAR,R.FO.AREA].includes(ue.displayType),Ze=[R.FO.TABLE,R.FO.TOP_N].includes(ue.displayType);function Se(e,t){var i;(0,F.Z)("dashboards_views.widget_builder.change",{from:$,field:e,value:t,widget_type:he,organization:x,new_widget:!ee}),ce((i=>{const s=c()(i);return f()(s,e,t),{...s,errors:void 0}})),"displayType"===e&&t!==ue.displayType&&(i=t,ce((e=>{const t=c()(e),s=(0,U.Zi)({displayType:i,queries:e.queries,widgetType:Et[e.dataSet],widgetBuilderNewDesign:re});if(i===R.FO.TOP_N&&s.splice(1),!re||Ze||we||(t.limit=void 0),e.displayType===R.FO.TABLE&&null!=ge&&ge.widgetType&&xt[ge.widgetType]===U.qg.ISSUES||e.dataSet===U.qg.RELEASE&&i===R.FO.WORLD_MAP)return f()(t,"queries",(0,U.Zi)({displayType:i,queries:[{...Tt(re)[U.qg.EVENTS]}],widgetType:R.l9.DISCOVER,widgetBuilderNewDesign:re})),f()(t,"dataSet",U.qg.EVENTS),{...t,errors:void 0};if(!e.userHasModified){if(i===R.FO.TABLE&&(null==ge?void 0:ge.widgetType)===R.l9.ISSUE)return f()(t,"queries",ge.queries),f()(t,"dataSet",U.qg.ISSUES),{...t,errors:void 0};K&&Y&&(i===R.FO.TABLE?s.forEach((e=>{const t=(0,N.n0)(Y);e.columns=[...t.columns],e.aggregates=[...t.aggregates],e.fields=[...Y]})):i===G&&s.forEach((e=>{e.fields=[...K.columns,...K.aggregates],e.aggregates=[...K.aggregates],e.columns=[...K.columns],K.orderby&&(e.orderby=K.orderby)})))}return e.dataSet===U.qg.ISSUES&&f()(t,"dataSet",U.qg.EVENTS),f()(t,"queries",s),{...t,errors:void 0}})))}function xe(e,t){ce((i=>{const s=c()(i);if(f()(s,`queries.${e}`,t),f()(s,"userHasModified",!0),re&&we&&0===e){const e=t.columns.filter((e=>!("equation|"===e)));var r;0===e.length?f()(s,"limit",void 0):f()(s,"limit",null!==(r=s.limit)&&void 0!==r?r:U._k)}return{...s,errors:void 0}}))}function Ee(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=e.map(N.sN),s=ue.dataSet===U.qg.RELEASE?i.map(N.hr):i.map(N.LY),r=t?(0,N.KZ)(e):void 0,a=c()(ue),o=ue.queries.map((a=>{const o=a.orderby.startsWith("-"),n=a.orderby.replace("-",""),d=a.aggregates.map((e=>ue.dataSet===U.qg.RELEASE?(0,N.hr)(e):(0,N.LY)(e))),l=c()(a);var u,p,g;if(t)l.fields=i,l.aggregates=null!==(u=null==r?void 0:r.aggregates)&&void 0!==u?u:[];else if(ue.displayType===R.FO.TOP_N){var m,h;l.fields=[...null!==(m=null===(h=l.fields)||void 0===h?void 0:h.slice(0,l.fields.length-1))&&void 0!==m?m:[],...i],l.aggregates=[...l.aggregates.slice(0,l.aggregates.length-1),...i]}else l.fields=[...l.columns,...i],l.aggregates=i;if(re&&we||!t||(l.columns=null!==(p=null==r?void 0:r.columns)&&void 0!==p?p:[]),!s.includes(n)&&""!==a.orderby)if(d.length===e.length){const e=s[d.indexOf(n)];l.orderby=o?`-${e}`:e}else l.orderby=re?s[0]:"";return re&&(l.fieldAliases=null!==(g=null==r?void 0:r.fieldAliases)&&void 0!==g?g:[]),l}));if(f()(a,"queries",o),f()(a,"userHasModified",!0),re&&we){const e=a.queries[0].columns.filter((e=>!("equation|"===e)));var n;0===e.length?f()(a,"limit",void 0):f()(a,"limit",null!==(n=a.limit)&&void 0!==n?n:U._k)}ce(a)}function Ce(e,t){const i=!g()(be)||t?{...be,...t}:void 0;e!==U.i0?V.push({pathname:`/organizations/${x.slug}/dashboard/${e}/`,query:i}):V.push({pathname:`/organizations/${x.slug}/dashboards/new/`,query:i})}if(ee&&!ie)return(0,H.tZ)(q.Z,{title:m.title,orgSlug:se,children:(0,H.tZ)(n.JH,{children:(0,H.tZ)(E.Z,{message:(0,o.t)("The widget you want to edit was not found.")})})});const qe=[R.FO.LINE,R.FO.AREA,R.FO.BAR].includes(ue.displayType)&&ue.queries.length<3,Oe=[R.FO.TABLE,R.FO.WORLD_MAP,R.FO.BIG_NUMBER].includes(ue.displayType),{columns:Be,aggregates:Ae,fields:Fe,fieldAliases:Ne=[]}=ue.queries[0],ke=(0,s.useMemo)((()=>Be.map(((e,t)=>(0,N.HM)({field:e,alias:Ne[t]})))),[Be,Ne]),_e=(0,s.useMemo)((()=>Ae.map(((e,t)=>(0,N.HM)({field:e,alias:Ne[t]})))),[Ae,Ne]),Ie=(0,A.ri)(Fe)?Fe.map(((e,t)=>(0,N.HM)({field:e,alias:Ne[t]}))):[...ke,..._e];return(0,H.tZ)(q.Z,{title:m.title,orgSlug:se,children:(0,H.tZ)(C.Z,{skipLoadLastUsed:x.features.includes("global-views"),defaultSelection:{datetime:{start:null,end:null,utc:!1,period:j.GY}},children:(0,H.BX)(Ot,{children:[(0,H.tZ)(mt,{orgSlug:se,title:ue.title,dashboardTitle:m.title,goBackLocation:ve,onChangeTitle:e=>{Se("title",e)}}),(0,H.BX)(At,{children:[(0,H.BX)(kt,{children:[(0,H.tZ)(Ft,{children:(0,H.BX)(Bt,{symbol:"colored-numeric",children:[(0,H.tZ)(Ye,{widget:ye,organization:x,pageFilters:oe,displayType:ue.displayType,error:null===(r=ue.errors)||void 0===r?void 0:r.displayType,onChange:e=>{Se("displayType",e)}}),(0,H.tZ)(pe,{dataSet:ue.dataSet,displayType:ue.displayType,onChange:function(e){ce((t=>{const i=c()(t);return i.queries.splice(0,i.queries.length),f()(i,"dataSet",e),e===U.qg.ISSUES&&f()(i,"displayType",R.FO.TABLE),i.queries.push(...null!=ge&&ge.widgetType&&xt[ge.widgetType]===e?ge.queries:[{...Tt(re)[e]}]),f()(i,"userHasModified",!0),{...i,errors:void 0}}))},widgetBuilderNewDesign:re}),Ze&&(0,H.tZ)(ae,{dataSet:ue.dataSet,queries:ue.queries,displayType:ue.displayType,widgetType:he,queryErrors:null===(a=ue.errors)||void 0===a?void 0:a.queries,onQueryChange:xe,onYAxisOrColumnFieldChange:e=>{Ee(e,!0)},explodedFields:Ie,tags:P,organization:x}),![R.FO.TABLE].includes(ue.displayType)&&(0,H.tZ)(nt,{dataSet:ue.dataSet,displayType:ue.displayType,widgetType:he,queryErrors:null===(d=ue.errors)||void 0===d?void 0:d.queries,onYAxisChange:e=>{Ee(e)},aggregates:_e,tags:P,organization:x}),(0,H.tZ)(Te,{queries:ue.queries,hideLegendAlias:Oe,canAddSearchConditions:qe,organization:x,queryErrors:null===(l=ue.errors)||void 0===l?void 0:l.queries,onAddSearchConditions:function(){ce((e=>{const t=c()(e),i=c()(Tt(re)[e.dataSet]);return i.fields=e.queries[0].fields,i.aggregates=e.queries[0].aggregates,i.columns=e.queries[0].columns,t.queries.push(i),t}))},onQueryChange:xe,onQueryRemove:function(e){ce((t=>{const i=c()(t);return i.queries.splice(e,1),{...i,errors:void 0}}))},selection:oe,widgetType:he}),re&&we&&(0,H.tZ)(Le,{columns:Be.filter((e=>!("equation|"===e))).map(((e,t)=>(0,N.HM)({field:e,alias:Ne[t]}))),onGroupByChange:function(e){const t=e.map(N.sN),i=c()(ue);if(ue.queries.forEach(((e,s)=>{const r=c()(e);r.columns=t,f()(i,`queries.${s}`,r)})),f()(i,"userHasModified",!0),re&&we){const e=i.queries[0].columns.filter((e=>!("equation|"===e)));var s;0===e.length?f()(i,"limit",void 0):f()(i,"limit",null!==(s=i.limit)&&void 0!==s?s:U._k)}ce(i)},organization:x,tags:P,dataSet:ue.dataSet}),(re&&we||Ze)&&(0,H.tZ)(je,{limit:ue.limit,displayType:ue.displayType,queries:ue.queries,dataSet:ue.dataSet,widgetBuilderNewDesign:re,error:null===(u=ue.errors)||void 0===u?void 0:u.orderby,onSortByChange:function(e){const t=c()(ue);ue.queries.forEach(((i,s)=>{const r=c()(i);r.orderby=e,f()(t,`queries.${s}`,r)})),f()(t,"userHasModified",!0),ce(t)},onLimitChange:function(e){ce({...ue,limit:e})},organization:x,widgetType:he}),ne&&!re&&(0,H.tZ)(le,{error:null===(p=ue.errors)||void 0===p?void 0:p.dashboard,dashboards:ue.dashboards,onChange:e=>ce({...ue,selectedDashboard:e,errors:{...ue.errors,dashboard:void 0}}),disabled:ue.loading})]})}),(0,H.tZ)(lt,{goBackLocation:ve,isEditing:ee,onSave:async function(){var e;const t=(0,D.TE)(ye);if(ge&&(t.layout=null==ge?void 0:ge.layout),re||Ze||t.queries.forEach((e=>{e.orderby=""})),re||t.queries.forEach((e=>h()(e,"fieldAliases"))),re&&!we&&(t.limit=void 0),await async function(e){if(ne&&(!ue.selectedDashboard||!ue.dashboards.find((e=>{var t,i;let{title:s,id:r}=e;return s===(null===(t=ue.selectedDashboard)||void 0===t?void 0:t.label)&&r===(null===(i=ue.selectedDashboard)||void 0===i?void 0:i.value)}))&&ue.selectedDashboard.value!==U.i0))return ce({...ue,errors:{...ue.errors,dashboard:(0,o.t)("This field may not be blank")}}),!1;ce({...ue,loading:!0});try{return await(0,b.QL)(de,x.slug,e),!0}catch(e){var t;return ce({...ue,loading:!1,errors:{...ue.errors,...(0,U.wc)(null!==(t=null==e?void 0:e.responseJSON)&&void 0!==t?t:{},{})}}),!1}}(t))if(ne)!function(e){var t;if(!ue.selectedDashboard)return;const i={queryNames:[],queryConditions:[],queryFields:[...e.queries[0].columns,...e.queries[0].aggregates],queryOrderby:e.queries[0].orderby};e.queries.forEach((e=>{i.queryNames.push(e.name),i.queryConditions.push(e.conditions)}));const s={displayType:e.displayType,interval:e.interval,title:e.title,...i,project:oe.projects,environment:oe.environments,...h()(oe.datetime,"period"),statsPeriod:null===(t=oe.datetime)||void 0===t?void 0:t.period};(0,v.S9)((0,o.t)("Added widget.")),Ce(ue.selectedDashboard.value,s)}(t);else{if(ge){var i;let e=[...m.widgets];const s=e.indexOf(ge),r={...t,id:ge.id};return(0,D.I_)(ge.displayType)!==(0,D.I_)(t.displayType)?(e[s]=(0,D.W8)(r),e=(0,D.Bb)(e)):e[s]=r,z(e),(0,v.S9)((0,o.t)("Updated widget.")),Ce(null!=X?X:U.i0),void(0,F.Z)("dashboards_views.widget_builder.save",{organization:x,data_set:null!==(i=t.widgetType)&&void 0!==i?i:R.l9.DISCOVER,new_widget:!1})}z([...m.widgets,t]),(0,v.S9)((0,o.t)("Added widget.")),Ce(null!=X?X:U.i0),(0,F.Z)("dashboards_views.widget_builder.save",{organization:x,data_set:null!==(e=t.widgetType)&&void 0!==e?e:R.l9.DISCOVER,new_widget:!0})}},onDelete:function(){if(!ee)return;let e=[...m.widgets];e.splice(te,1),e=(0,D.Bb)(e),z(e),V.push(ve)},invalidForm:!(!ne||ue.selectedDashboard)})]}),(0,H.tZ)(Nt,{children:(0,H.tZ)(vt,{widgetBuilderNewDesign:re,onWidgetSelect:e=>ce({...ue,...e,dataSet:e.widgetType?xt[e.widgetType]:U.qg.EVENTS,userHasModified:!1}),bypassOverwriteModal:!ue.userHasModified})})]})]})})})}Ct.displayName="WidgetBuilder";const qt=(0,L.Z)((0,I.Z)(Ct)),Ot=(0,l.Z)(n.JH,{target:"e1rwomk15"})({name:"1hcx8jb",styles:"padding:0"}),Bt=(0,l.Z)(x.Z,{target:"e1rwomk14"})("gap:",(0,O.Z)(4),";max-width:100%;"),At=(0,l.Z)(T.uT,{target:"e1rwomk13"})("grid-template-rows:1fr;&&{gap:0;padding:0;}@media (max-width: ",(e=>e.theme.breakpoints[3]),"){grid-template-columns:1fr;}@media (min-width: ",(e=>e.theme.breakpoints[2]),"){grid-template-columns:minmax(100px, auto) calc(325px + ",(0,O.Z)(2)+(0,O.Z)(2),");}@media (min-width: ",(e=>e.theme.breakpoints[3]),"){grid-template-columns:minmax(100px, auto) calc(325px + ",(0,O.Z)(2)+(0,O.Z)(4),");}"),Ft=(0,l.Z)(T.or,{target:"e1rwomk12"})("max-width:1000px;flex:1;padding:",(0,O.Z)(4)," ",(0,O.Z)(2),";@media (min-width: ",(e=>e.theme.breakpoints[1]),"){padding:",(0,O.Z)(4),";}"),Nt=(0,l.Z)(T.MF,{target:"e1rwomk11"})("padding:",(0,O.Z)(4)," ",(0,O.Z)(2),";@media (min-width: ",(e=>e.theme.breakpoints[3]),"){border-left:1px solid ",(e=>e.theme.gray200),";padding-right:",(0,O.Z)(4),";}@media (max-width: ",(e=>e.theme.breakpoints[3]),"){border-top:1px solid ",(e=>e.theme.gray200),";}@media (max-width: ",(e=>e.theme.breakpoints[3]),"){grid-row:2/2;grid-column:1/1;}"),kt=(0,l.Z)("div",{target:"e1rwomk10"})({name:"1fttcpj",styles:"display:flex;flex-direction:column"});function _t(e){const t=(0,d.Z)();return(0,H.tZ)(r.Z,{features:["new-widget-builder-experience","dashboards-edit"],organization:t,renderDisabled:()=>(0,H.tZ)(n.JH,{children:(0,H.tZ)(a.Z,{type:"warning",children:(0,o.t)("You don't have access to this feature")})}),children:(0,H.tZ)(qt,{...e,organization:t})})}_t.displayName="WidgetBuilderContainer";const Lt=_t},"./app/views/dashboardsV2/widgetBuilder/issueWidget/utils.tsx":(e,t,i)=>{i.d(t,{S:()=>o,W:()=>d}),i("../node_modules/core-js/modules/web.dom-collections.iterator.js");var s=i("./app/views/eventsV2/table/types.tsx"),r=i("./app/views/issueList/utils.tsx"),a=i("./app/views/dashboardsV2/widgetBuilder/issueWidget/fields.tsx");function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a.$L;const t=Object.keys(e).sort(),i={};return t.forEach((t=>{i[`field:${t}`]={label:t,value:{kind:s.L.FIELD,meta:{name:t,dataType:e[t]}}}})),i}const n=[r.qh.DATE,r.qh.NEW,r.qh.FREQ,r.qh.PRIORITY,r.qh.USER];function d(e){const t=[...n];return e&&t.push(r.qh.TREND),t.map((e=>({label:(0,r._k)(e),value:e})))}},"./app/views/dashboardsV2/widgetBuilder/widgetLibrary/card.tsx":(e,t,i)=>{i.d(t,{Z:()=>n});var s=i("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=i("./app/styles/space.tsx"),a=i("./app/views/dashboardsV2/widgetLibrary/widgetCard.tsx"),o=i("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function n(e){let{widget:t,iconColor:i}=e;const{title:s,description:r,displayType:n}=t,g=(0,a.T)(n);return(0,o.BX)(d,{children:[(0,o.tZ)(p,{backgroundColor:i,children:(0,o.tZ)(g,{color:"white"})}),(0,o.BX)(l,{children:[(0,o.tZ)(u,{children:s}),(0,o.tZ)(c,{children:r})]})]})}n.displayName="Card";const d=(0,s.Z)("div",{target:"e1kr3ej04"})("display:flex;flex-direction:row;gap:",(0,r.Z)(1),";"),l=(0,s.Z)("div",{target:"e1kr3ej03"})({name:"1fttcpj",styles:"display:flex;flex-direction:column"}),u=(0,s.Z)("div",{target:"e1kr3ej02"})("font-size:",(e=>e.theme.fontSizeLarge),";font-weight:500;margin-bottom:0;color:",(e=>e.theme.gray500),";"),c=(0,s.Z)("small",{target:"e1kr3ej01"})("color:",(e=>e.theme.gray300),";"),p=(0,s.Z)("div",{target:"e1kr3ej00"})("display:flex;justify-content:center;align-items:center;padding:",(0,r.Z)(1),";min-width:40px;height:40px;border-radius:",(e=>e.theme.borderRadius),";background:",(e=>e.backgroundColor),";")},"./app/views/dashboardsV2/widgetLibrary/data.tsx":(e,t,i)=>{i.d(t,{c:()=>a});var s=i("./app/locale.tsx"),r=i("./app/views/dashboardsV2/types.tsx");const a=[{id:void 0,title:(0,s.t)("Duration Distribution"),description:(0,s.t)("Compare transaction durations across different percentiles."),displayType:r.FO.LINE,widgetType:r.l9.DISCOVER,interval:"5m",queries:[{name:"",conditions:"event.type:transaction",fields:["p50(transaction.duration)","p75(transaction.duration)","p95(transaction.duration)"],aggregates:["p50(transaction.duration)","p75(transaction.duration)","p95(transaction.duration)"],columns:[],orderby:""}]},{id:void 0,title:(0,s.t)("High Throughput Transactions"),description:(0,s.t)("Top 5 transactions with the largest volume."),displayType:r.FO.TOP_N,widgetType:r.l9.DISCOVER,interval:"5m",queries:[{name:"",conditions:"event.type:transaction",fields:["transaction","count()"],aggregates:["count()"],columns:["transaction"],orderby:"-count"}]},{id:void 0,title:(0,s.t)("LCP by Country"),description:(0,s.t)("Density map showing page load times by country."),displayType:r.FO.WORLD_MAP,widgetType:r.l9.DISCOVER,interval:"5m",queries:[{name:"",conditions:"has:geo.country_code",fields:["p75(measurements.lcp)"],aggregates:["p75(measurements.lcp)"],columns:[],orderby:""}]},{id:void 0,title:(0,s.t)("Miserable Users"),description:(0,s.t)("Unique users who have experienced slow load times."),displayType:r.FO.BIG_NUMBER,widgetType:r.l9.DISCOVER,interval:"5m",queries:[{name:"",conditions:"",fields:["count_miserable(user,300)"],aggregates:["count_miserable(user,300)"],columns:[],orderby:""}]},{id:void 0,title:(0,s.t)("Slow vs. Fast Transactions"),description:(0,s.t)("Percentage breakdown of transaction durations over and under 300ms."),displayType:r.FO.BAR,widgetType:r.l9.DISCOVER,interval:"5m",queries:[{name:"",conditions:"event.type:transaction",fields:["equation|(count_if(transaction.duration,greater,300) / count()) * 100","equation|(count_if(transaction.duration,lessOrEquals,300) / count()) * 100"],aggregates:["equation|(count_if(transaction.duration,greater,300) / count()) * 100","equation|(count_if(transaction.duration,lessOrEquals,300) / count()) * 100"],columns:[],orderby:""}]},{id:void 0,title:(0,s.t)("Issues For Review"),description:(0,s.t)("Most recently seen unresolved issues for review."),displayType:r.FO.TABLE,widgetType:r.l9.ISSUE,interval:"5m",queries:[{name:"",conditions:"is:unresolved is:for_review",fields:["issue","assignee","events","title"],aggregates:[],columns:["issue","assignee","events","title"],orderby:"date"}]},{id:void 0,title:(0,s.t)("Top Unhandled Error Types"),description:(0,s.t)("Most frequently encountered unhandled errors."),displayType:r.FO.TOP_N,widgetType:r.l9.DISCOVER,interval:"5m",queries:[{name:"",conditions:"error.unhandled:true",fields:["error.type","count()"],aggregates:["count()"],columns:["error.type"],orderby:"-count"}]},{id:void 0,title:(0,s.t)("Users Affected by Errors"),description:(0,s.t)("Footprint of unique users affected by errors."),displayType:r.FO.LINE,widgetType:r.l9.DISCOVER,interval:"5m",queries:[{name:"",conditions:"event.type:error",fields:["count_unique(user)","count()"],aggregates:["count_unique(user)","count()"],columns:[],orderby:""}]}]},"./app/views/dashboardsV2/widgetLibrary/widgetCard.tsx":(e,t,i)=>{i.d(t,{T:()=>p,Z:()=>b});var s=i("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=(i("../node_modules/core-js/modules/web.dom-collections.iterator.js"),i("../node_modules/react/index.js")),a=i("./app/components/panels/index.tsx"),o=i("./app/icons/index.tsx"),n=i("./app/icons/iconGraphArea.tsx"),d=i("./app/icons/iconGraphBar.tsx"),l=i("./app/styles/space.tsx"),u=i("./app/views/dashboardsV2/types.tsx"),c=i("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function p(e){switch(e){case u.FO.TABLE:return o.dc;case u.FO.WORLD_MAP:return o.vc;case u.FO.BIG_NUMBER:return o.A8;case u.FO.BAR:return d.U;case u.FO.TOP_N:return o.CC;case u.FO.AREA:return n.g;case u.FO.LINE:default:return o.TX}}function g(e){let{selectedWidgets:t,widget:i,setSelectedWidgets:s,"data-test-id":o}=e;const[n,d]=(0,r.useState)(t.includes(i)),l=p(i.displayType);return(0,c.tZ)(f,{"data-test-id":o,selected:n,onClick:()=>{if(n){const e=t.filter((e=>i!==e));s(e)}else{const e=t.slice().concat(i);s(e)}d(!n)},children:(0,c.BX)(a.N,{children:[(0,c.BX)(h,{children:[(0,c.tZ)(l,{size:"xs"}),(0,c.tZ)(m,{children:i.title})]}),(0,c.tZ)(y,{children:i.description})]})})}g.displayName="WidgetLibraryCard";const m=(0,s.Z)("div",{target:"e11j9f793"})("padding-left:",(0,l.Z)(1),";font-size:16px;line-height:140%;color:",(e=>e.theme.gray500),";"),h=(0,s.Z)("div",{target:"e11j9f792"})("padding:",(0,l.Z)(1.5)," ",(0,l.Z)(2),";padding-bottom:",(0,l.Z)(.5),";display:flex;align-items:center;"),y=(0,s.Z)("div",{target:"e11j9f791"})("padding:0 ",(0,l.Z)(1)," ",(0,l.Z)(1.5)," 36px;font-size:14px;line-height:21px;color:",(e=>e.theme.gray300),";"),f=(0,s.Z)(a.s_,{target:"e11j9f790"})("border:",(e=>e.selected?`2px solid ${e.theme.active}`:`1px solid ${e.theme.border}`),";margin:",(e=>e.selected?"-1px":0),";box-sizing:border-box;box-shadow:0px 2px 1px rgba(0, 0, 0, 0.08);cursor:pointer;"),b=g}}]);
//# sourceMappingURL=../sourcemaps/app_utils_performance_spanOperationBreakdowns_constants_tsx-app_views_dashboardsV2_widgetBuil-c85449.e13cb85f75cf5cd7b5fc08b3d6982911.js.map