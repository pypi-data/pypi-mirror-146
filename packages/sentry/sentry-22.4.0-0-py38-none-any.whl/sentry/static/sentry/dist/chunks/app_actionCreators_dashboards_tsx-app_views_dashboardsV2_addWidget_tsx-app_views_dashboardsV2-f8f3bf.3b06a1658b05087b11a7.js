"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_actionCreators_dashboards_tsx-app_views_dashboardsV2_addWidget_tsx-app_views_dashboardsV2-f8f3bf"],{"./app/actionCreators/dashboards.tsx":(e,t,i)=>{i.d(t,{j2:()=>d,JR:()=>l,a_:()=>c,AK:()=>u,Y:()=>p,iM:()=>g,QL:()=>h});var s=i("../node_modules/lodash/omit.js"),o=i.n(s),a=i("./app/actionCreators/indicator.tsx"),n=i("./app/locale.tsx"),r=i("./app/views/dashboardsV2/utils.tsx");function d(e,t){const i=e.requestPromise(`/organizations/${t}/dashboards/`,{method:"GET",query:{sort:"myDashboardsAndRecentlyViewed"}});return i.catch((e=>{var t;const i=null!==(t=null==e?void 0:e.responseJSON)&&void 0!==t?t:null;if(i){const e=(0,r.Tk)(i,{});(0,a.Iw)(e[Object.keys(e)[0]])}else(0,a.Iw)((0,n.t)("Unable to fetch dashboards"))})),i}function l(e,t,i,s){const{title:d,widgets:l}=i,c=e.requestPromise(`/organizations/${t}/dashboards/`,{method:"POST",data:{title:d,widgets:l.map((e=>o()(e,["tempId"]))),duplicate:s}});return c.catch((e=>{var t;const i=null!==(t=null==e?void 0:e.responseJSON)&&void 0!==t?t:null;if(i){const e=(0,r.Tk)(i,{});(0,a.Iw)(e[Object.keys(e)[0]])}else(0,a.Iw)((0,n.t)("Unable to create dashboard"))})),c}function c(e,t,i){return e.requestPromise(`/organizations/${t}/dashboards/${i}/visit/`,{method:"POST"})}function u(e,t,i){const s=e.requestPromise(`/organizations/${t}/dashboards/${i}/`,{method:"GET"});return s.catch((e=>{var t;const i=null!==(t=null==e?void 0:e.responseJSON)&&void 0!==t?t:null;if(i){const e=(0,r.Tk)(i,{});(0,a.Iw)(e[Object.keys(e)[0]])}else(0,a.Iw)((0,n.t)("Unable to load dashboard"))})),s}function p(e,t,i){const s={title:i.title,widgets:i.widgets.map((e=>o()(e,["tempId"])))},d=e.requestPromise(`/organizations/${t}/dashboards/${i.id}/`,{method:"PUT",data:s});return d.catch((e=>{var t;const i=null!==(t=null==e?void 0:e.responseJSON)&&void 0!==t?t:null;if(i){const e=(0,r.Tk)(i,{});(0,a.Iw)(e[Object.keys(e)[0]])}else(0,a.Iw)((0,n.t)("Unable to update dashboard"))})),d}function g(e,t,i){const s=e.requestPromise(`/organizations/${t}/dashboards/${i}/`,{method:"DELETE"});return s.catch((e=>{var t;const i=null!==(t=null==e?void 0:e.responseJSON)&&void 0!==t?t:null;if(i){const e=(0,r.Tk)(i,{});(0,a.Iw)(e[Object.keys(e)[0]])}else(0,a.Iw)((0,n.t)("Unable to delete dashboard"))})),s}function h(e,t,i){return e.requestPromise(`/organizations/${t}/dashboards/widgets/`,{method:"POST",data:i})}},"./app/views/dashboardsV2/addWidget.tsx":(e,t,i)=>{i.d(t,{g:()=>u,Z:()=>h});var s=i("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),o=i("../node_modules/@dnd-kit/sortable/dist/sortable.esm.js"),a=i("./app/components/button.tsx"),n=i("./app/icons/index.tsx"),r=i("./app/locale.tsx"),d=i("./app/views/dashboardsV2/types.tsx"),l=i("./app/views/dashboardsV2/widgetWrapper.tsx"),c=i("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const u="add-widget-button",p={x:0,y:0,scaleX:1,scaleY:1};function g(e){let{onAddWidget:t}=e;const{setNodeRef:i,transform:s}=(0,o.nB)({disabled:!0,id:u,transition:null});return(0,c.tZ)(l.Z,{ref:i,displayType:d.FO.BIG_NUMBER,layoutId:u,style:{originX:0,originY:0},animate:s?{x:s.x,y:s.y,scaleX:null!=s&&s.scaleX&&s.scaleX<=1?s.scaleX:1,scaleY:null!=s&&s.scaleY&&s.scaleY<=1?s.scaleY:1}:p,transition:{duration:.25},children:(0,c.tZ)(b,{onClick:t,children:(0,c.tZ)(m,{"data-test-id":"widget-add",icon:(0,c.tZ)(n.N_,{size:"lg",isCircled:!0,color:"inactive"}),"aria-label":(0,r.t)("Add widget")})})},"add")}g.displayName="AddWidget";const h=g,m=(0,s.Z)(a.ZP,{target:"e1sxcph31"})({name:"6ayxgl",styles:"border:none;&,&:focus,&:active,&:hover{background:transparent;box-shadow:none;}"}),b=(0,s.Z)("div",{target:"e1sxcph30"})("width:100%;height:110px;border:2px dashed ",(e=>e.theme.border),";border-radius:",(e=>e.theme.borderRadius),";display:flex;align-items:center;justify-content:center;cursor:",(e=>e.onClick?"pointer":""),";")},"./app/views/dashboardsV2/layoutUtils.tsx":(e,t,i)=>{i.d(t,{c6:()=>h,$n:()=>b,Yb:()=>w,TE:()=>y,VW:()=>x,RI:()=>v,hq:()=>f,I_:()=>Z,WJ:()=>D,Sp:()=>_,Hh:()=>z,_F:()=>C,W8:()=>j,Bb:()=>k}),i("../node_modules/core-js/modules/web.dom-collections.iterator.js");var s=i("../node_modules/react-grid-layout/build/utils.js"),o=i("../node_modules/lodash/pickBy.js"),a=i.n(o),n=i("../node_modules/lodash/sortBy.js"),r=i.n(n),d=i("../node_modules/lodash/zip.js"),l=i.n(d),c=i("./app/utils.tsx"),u=i("./app/utils/guid.tsx"),p=i("./app/views/dashboardsV2/dashboard.tsx"),g=i("./app/views/dashboardsV2/types.tsx");const h=2,m=["x","y","w","h","minW","maxW","minH","maxH"];function b(e,t){return e.id?`${e.id}-index-${t}`:`index-${t}`}function w(e){var t;return`grid-item-${null!==(t=e.id)&&void 0!==t?t:e.tempId}`}function y(e){var t;return(null!==(t=e.id)&&void 0!==t?t:e.tempId)?e:{...e,tempId:(0,u.E)()}}function x(e,t){if(0===e.length)return[];const i=l()(e,t);return r()(i,["0.y","0.x"]).map(((e,t)=>{let[i,s]=e;return{...i,x:0,y:2*t,w:2,h:s.displayType===g.FO.BIG_NUMBER?1:2}}))}function v(e){return e.filter((e=>(0,c.ri)(e.layout))).map((e=>{let{layout:t,...i}=e;return{...t,i:w(i)}}))}function f(e){return a()(e,((e,t)=>(0,c.ri)(e)&&m.includes(t)))}function Z(e){return e===g.FO.BIG_NUMBER?1:2}function D(){return Array(p.ey).fill(0)}function _(e){const t=D();return e.forEach((e=>{let{x:i,w:s,y:o,h:a}=e;for(let e=i;e<i+s;e++)t[e]=Math.max(o+a,t[e])})),t}function z(e,t){const i=[...e],s=Math.max(...i);for(let e=0;e<=s;e++)for(let s=0;s<=i.length-h;s++){if(i[s]>e)continue;const o=s+h;if(i.slice(s,o).every((t=>t<=e))){for(let o=s;o<s+h;o++)i[o]=e+t;return[{x:s,y:e},[...i]]}}for(let e=0;e<h;e++)i[e]=s;return[{x:0,y:s},[...i]]}function C(e,t){let i=[...t];return e.map((e=>{if((0,c.ri)(e.layout))return e;const t=Z(e.displayType),[s,o]=z(i,t);return i=o,{...e,layout:{...s,h:t,minH:t,w:h}}}))}function j(e){var t;const{displayType:i,layout:s}=e,o={...e};if(!(0,c.ri)(s))return o;const a=Z(i),n={...s,h:Math.max(null!==(t=null==s?void 0:s.h)&&void 0!==t?t:a,a),minH:a};return{...o,layout:n}}function k(e){const t=(0,s.compact)(v(e),"vertical",p.ey);return e.map((e=>{const i=t.find((t=>{let{i}=t;return i===w(e)}));return i?{...e,layout:i}:e}))}},"./app/views/dashboardsV2/sortableWidget.tsx":(e,t,i)=>{i.d(t,{Z:()=>p});var s=i("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),o=i("../node_modules/react/index.js"),a=i("../node_modules/@dnd-kit/sortable/dist/sortable.esm.js"),n=i("./app/utils/theme.tsx"),r=i("./app/utils/withOrganization.tsx"),d=i("./app/views/dashboardsV2/widgetCard/index.tsx"),l=i("./app/views/dashboardsV2/widgetWrapper.tsx"),c=i("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function u(e){const{organization:t,widget:i,dragId:s,isEditing:r,widgetLimitReached:u,onDelete:p,onEdit:h,onDuplicate:m,isPreview:b,isMobile:w,windowWidth:y,index:x}=e,{attributes:v,listeners:f,setNodeRef:Z,transform:D,isDragging:_,isSorting:z}=(0,a.nB)({id:s,transition:null});(0,o.useEffect)((()=>{if(_)return document.body.style.cursor="grabbing",function(){document.body.style.cursor=""}}),[_]);let C={widget:i,isEditing:r,widgetLimitReached:u,onDelete:p,onEdit:h,onDuplicate:m,isSorting:z,hideToolbar:z,currentWidgetDragging:_,showContextMenu:!0,isPreview:b,showWidgetViewerButton:t.features.includes("widget-viewer-modal"),index:x};return t.features.includes("dashboard-grid-layout")?(C={...C,isMobile:w,windowWidth:y,isSorting:!1,currentWidgetDragging:!1,tableItemLimit:20},(0,c.tZ)(g,{children:(0,c.tZ)(d.Z,{...C})})):(C={...C,draggableProps:{attributes:v,listeners:f}},(0,c.tZ)(l.Z,{ref:Z,displayType:i.displayType,layoutId:s,style:{originX:_?1:0,originY:0,boxShadow:_?n.ZP.dropShadowHeavy:"none",borderRadius:_?n.ZP.borderRadius:void 0},animate:D?{x:D.x,y:D.y,scaleX:null!=D&&D.scaleX&&D.scaleX<=1?D.scaleX:1,scaleY:null!=D&&D.scaleY&&D.scaleY<=1?D.scaleY:1,zIndex:_?n.ZP.zIndex.modal:"auto"}:{zIndex:"auto"},transformTemplate:(e,t)=>r&&D?t:"none",transition:{duration:_?0:.25,easings:{type:"spring"}},children:(0,c.tZ)(d.Z,{...C})}))}u.displayName="SortableWidget";const p=(0,r.Z)(u),g=(0,s.Z)("div",{target:"e12vujy00"})({name:"13udsys",styles:"height:100%"})},"./app/views/dashboardsV2/widgetCard/index.tsx":(e,t,i)=>{i.d(t,{Z:()=>B});var s=i("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=i("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),a=(i("../node_modules/core-js/modules/web.dom-collections.iterator.js"),i("../node_modules/react/index.js")),n=i("../node_modules/react-lazyload/lib/index.js"),r=i("../node_modules/react-router/es/index.js"),d=i("./app/components/button.tsx"),l=i("./app/components/charts/styles.tsx"),c=i("./app/components/errorBoundary.tsx"),u=i("./app/components/panels/index.tsx"),p=i("./app/components/placeholder.tsx"),g=i("./app/components/tooltip.tsx"),h=i("./app/icons/index.tsx"),m=i("./app/locale.tsx"),b=i("./app/styles/overflowEllipsis.tsx"),w=i("./app/styles/space.tsx"),y=i("./app/utils/withApi.tsx"),x=i("./app/utils/withOrganization.tsx"),v=i("./app/utils/withPageFilters.tsx"),f=i("./app/views/dashboardsV2/dashboard.tsx"),Z=i("./app/views/dashboardsV2/widgetCard/widgetCardChartContainer.tsx"),D=i("./app/actionCreators/modal.tsx"),_=i("./app/components/confirm.tsx"),z=i("./app/components/dropdownMenuControlV2.tsx"),C=i("./app/components/modals/widgetViewerModal/utils.tsx"),j=i("./app/utils/analytics/trackAdvancedAnalyticsEvent.tsx"),k=i("./app/views/dashboardsV2/utils.tsx"),W=i("./app/views/dashboardsV2/types.tsx"),V=i("./app/views/dashboardsV2/widgetViewer/widgetViewerContext.tsx"),P=i("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function E(e){let{organization:t,selection:i,widget:s,widgetLimitReached:o,onDelete:a,onDuplicate:n,onEdit:r,showContextMenu:d,isPreview:l,showWidgetViewerButton:c,router:u,location:p,index:g,seriesData:b,tableData:w}=e;if(!d)return null;const y=[],x=[],v=e=>{(0,C.X)(p.pathname)||u.push({pathname:`${p.pathname}${p.pathname.endsWith("/")?"":"/"}widget/${e}/`,query:p.query})};if(l)return(0,P.tZ)(V.M.Consumer,{children:e=>{let{setData:t}=e;return(0,P.BX)(T,{children:[(0,P.tZ)(M,{items:[{key:"preview",label:(0,m.t)("This is a preview only. To edit, you must add this dashboard.")}],triggerProps:{"aria-label":(0,m.t)("Widget actions"),size:"xsmall",borderless:!0,showChevron:!1,icon:(0,P.tZ)(h.YR,{direction:"down",size:"sm"})},placement:"bottom right",disabledKeys:["preview"]}),c&&(0,P.tZ)(O,{"aria-label":(0,m.t)("Open Widget Viewer"),priority:"link",size:"zero",icon:(0,P.tZ)(h.qp,{size:"xs"}),onClick:()=>{(b||w)&&t({seriesData:b,tableData:w}),v(g)}})]})}});if(t.features.includes("discover-basic")&&s.widgetType===W.l9.DISCOVER&&s.queries.length){const e=(0,k.z1)(s,i,t);y.push({key:"open-in-discover",label:(0,m.t)("Open in Discover"),to:1===s.queries.length?e:void 0,onAction:()=>{1!==s.queries.length?((0,j.Z)("dashboards_views.query_selector.opened",{organization:t,widget_type:s.displayType}),(0,D.openDashboardWidgetQuerySelectorModal)({organization:t,widget:s})):(0,j.Z)("dashboards_views.open_in_discover.opened",{organization:t,widget_type:s.displayType})}})}if(s.widgetType===W.l9.ISSUE){const e=(0,k.hS)(s,i,t);y.push({key:"open-in-issues",label:(0,m.t)("Open in Issues"),to:e})}return t.features.includes("dashboards-edit")&&(y.push({key:"duplicate-widget",label:(0,m.t)("Duplicate Widget"),onAction:()=>null==n?void 0:n()}),o&&x.push("duplicate-widget"),y.push({key:"edit-widget",label:(0,m.t)("Edit Widget"),onAction:()=>null==r?void 0:r()}),y.push({key:"delete-widget",label:(0,m.t)("Delete Widget"),priority:"danger",onAction:()=>{(0,_._)({message:(0,m.t)("Are you sure you want to delete this widget?"),priority:"danger",onConfirm:()=>null==a?void 0:a()})}})),y.length?(0,P.tZ)(V.M.Consumer,{children:e=>{let{setData:t}=e;return(0,P.BX)(T,{children:[(0,P.tZ)(M,{items:y,triggerProps:{"aria-label":(0,m.t)("Widget actions"),size:"xsmall",borderless:!0,showChevron:!1,icon:(0,P.tZ)(h.YR,{direction:"down",size:"sm"})},placement:"bottom right",disabledKeys:x}),c&&(0,P.tZ)(O,{"aria-label":(0,m.t)("Open Widget Viewer"),priority:"link",size:"zero",icon:(0,P.tZ)(h.qp,{size:"xs"}),onClick:()=>{var e;(b||w)&&t({seriesData:b,tableData:w}),v(null!==(e=s.id)&&void 0!==e?e:g)}})]})}}):null}E.displayName="WidgetCardContextMenu";const I=E,T=(0,o.Z)("div",{target:"e1yltioa2"})("display:flex;align-items:center;height:",(0,w.Z)(3),";margin-left:",(0,w.Z)(1),";"),M=(0,o.Z)(z.Z,{target:"e1yltioa1"})({name:"gbbqag",styles:"&>button{z-index:auto;}"}),O=(0,o.Z)(d.ZP,{target:"e1yltioa0"})("padding:",(0,w.Z)(.75)," ",(0,w.Z)(1),";color:",(e=>e.theme.textColor),";&:hover{color:",(e=>e.theme.textColor),";background:",(e=>e.theme.surface400),";border-color:transparent;}");class R extends a.Component{constructor(){super(...arguments),(0,s.Z)(this,"state",{}),(0,s.Z)(this,"setData",(e=>{let{tableResults:t,timeseriesResults:i}=e;this.setState({seriesData:i,tableData:t})}))}renderToolbar(){const{onEdit:e,onDelete:t,onDuplicate:i,draggableProps:s,hideToolbar:o,isEditing:a,isMobile:n}=this.props;return a?(0,P.tZ)(q,{children:(0,P.BX)(X,{style:{visibility:o?"hidden":"visible"},children:[!n&&(0,P.tZ)(L,{size:"xsmall","aria-label":(0,m.t)("Drag Widget"),icon:(0,P.tZ)(h.LS,{}),borderless:!0,className:f.re,...null==s?void 0:s.listeners,...null==s?void 0:s.attributes}),(0,P.tZ)(d.ZP,{"data-test-id":"widget-edit","aria-label":(0,m.t)("Edit Widget"),size:"xsmall",borderless:!0,onClick:e,icon:(0,P.tZ)(h.yl,{})}),(0,P.tZ)(d.ZP,{"aria-label":(0,m.t)("Duplicate Widget"),size:"xsmall",borderless:!0,onClick:i,icon:(0,P.tZ)(h.vU,{})}),(0,P.tZ)(d.ZP,{"data-test-id":"widget-delete","aria-label":(0,m.t)("Delete Widget"),borderless:!0,size:"xsmall",onClick:t,icon:(0,P.tZ)(h.Fz,{})})]})}):null}renderContextMenu(){const{widget:e,selection:t,organization:i,showContextMenu:s,isPreview:o,widgetLimitReached:a,onEdit:n,onDuplicate:r,onDelete:d,isEditing:l,showWidgetViewerButton:c,router:u,location:p,index:g}=this.props,{seriesData:h,tableData:m}=this.state;return l?null:(0,P.tZ)(I,{organization:i,widget:e,selection:t,showContextMenu:s,isPreview:o,widgetLimitReached:a,onDuplicate:r,onEdit:n,onDelete:d,showWidgetViewerButton:c,router:u,location:p,index:g,seriesData:h,tableData:m})}render(){const{api:e,organization:t,selection:i,widget:s,isMobile:o,renderErrorMessage:a,tableItemLimit:r,windowWidth:d,noLazyLoad:l}=this.props;return(0,P.tZ)(c.Z,{customComponent:(0,P.tZ)(S,{children:(0,m.t)("Error loading widget data")}),children:(0,P.BX)($,{isDragging:!1,children:[(0,P.BX)(A,{children:[(0,P.tZ)(g.ZP,{title:s.title,containerDisplayMode:"grid",showOnlyOnOverflow:!0,children:(0,P.tZ)(N,{children:s.title})}),this.renderContextMenu()]}),l?(0,P.tZ)(Z.Z,{api:e,organization:t,selection:i,widget:s,isMobile:o,renderErrorMessage:a,tableItemLimit:r,windowWidth:d,onDataFetched:this.setData}):(0,P.tZ)(n.ZP,{once:!0,resize:!0,height:200,children:(0,P.tZ)(Z.Z,{api:e,organization:t,selection:i,widget:s,isMobile:o,renderErrorMessage:a,tableItemLimit:r,windowWidth:d,onDataFetched:this.setData})}),this.renderToolbar()]})})}}R.displayName="WidgetCard";const B=(0,y.Z)((0,x.Z)((0,v.Z)((0,r.withRouter)(R)))),S=(0,o.Z)(p.Z,{target:"e1fl0u6g6"})("display:flex;align-items:center;justify-content:center;background-color:",(e=>e.theme.alert.error.backgroundLight),";border:1px solid ",(e=>e.theme.alert.error.border),";color:",(e=>e.theme.alert.error.textLight),";border-radius:",(e=>e.theme.borderRadius),";margin-bottom:",(0,w.Z)(2),";"),$=(0,o.Z)(u.s_,{shouldForwardProp:e=>"isDragging"!==e,target:"e1fl0u6g5"})("margin:0;visibility:",(e=>e.isDragging?"hidden":"visible"),";height:100%;min-height:96px;display:flex;flex-direction:column;"),q=(0,o.Z)("div",{target:"e1fl0u6g4"})("position:absolute;top:0;left:0;z-index:2;width:100%;height:100%;display:flex;justify-content:flex-end;align-items:flex-start;background-color:",(e=>e.theme.overlayBackgroundAlpha),";border-radius:",(e=>e.theme.borderRadius),";"),X=(0,o.Z)("div",{target:"e1fl0u6g3"})("display:flex;margin:",(0,w.Z)(1),";touch-action:none;"),L=(0,o.Z)(d.ZP,{target:"e1fl0u6g2"})({name:"1fgcczm",styles:"cursor:grab"}),N=(0,o.Z)(l.Gh,{target:"e1fl0u6g1"})(b.Z,";font-weight:normal;"),A=(0,o.Z)("div",{target:"e1fl0u6g0"})("padding:",(0,w.Z)(2)," ",(0,w.Z)(1)," 0 ",(0,w.Z)(3),";min-height:36px;width:100%;display:flex;align-items:center;justify-content:space-between;")},"./app/views/dashboardsV2/widgetViewer/widgetViewerContext.tsx":(e,t,i)=>{i.d(t,{M:()=>s});const s=(0,i("../node_modules/react/index.js").createContext)({setData:()=>{}})},"./app/views/dashboardsV2/widgetWrapper.tsx":(e,t,i)=>{i.d(t,{Z:()=>a});var s=i("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),o=i("../node_modules/framer-motion/dist/es/render/dom/motion.mjs");const a=(0,s.Z)(o.E.div,{target:"ec3gecx0"})("position:relative;touch-action:manipulation;",(e=>"big_number"===e.displayType?`\n          /* 2 cols */\n          grid-area: span 1 / span 2;\n\n          @media (min-width: ${e.theme.breakpoints[0]}) {\n            /* 4 cols */\n            grid-area: span 1 / span 1;\n          }\n\n          @media (min-width: ${e.theme.breakpoints[3]}) {\n            /* 6 and 8 cols */\n            grid-area: span 1 / span 2;\n          }\n        `:"\n          /* 2, 4, 6 and 8 cols */\n          grid-area: span 2 / span 2;\n        "),";")}}]);
//# sourceMappingURL=../sourcemaps/app_actionCreators_dashboards_tsx-app_views_dashboardsV2_addWidget_tsx-app_views_dashboardsV2-f8f3bf.2c6cb9e9ec0fc1997181a8c8e625c89b.js.map