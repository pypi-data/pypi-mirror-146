id: deployment-bootstrap
type: service
version: 1.0.0
tasks:
  - id: start
    driver: print
    provides:
      - deployment-bootstrap.start
    requires:
      - deployment-state.bootstrap-start
    message: "DEPLOYMENT: bootstrap start"

  - id: deploy-steps-0
    driver: ansible_runner
    provides:
      - deployment-bootstrap.deploy-steps-0
    requires:
      - deployment-bootstrap.start
    playbook: deploy_steps_0_playbook.yaml
    runner_options:
      extravars: global_vars.yaml

  - id: selinux
    driver: ansible_runner
    provides:
      - deployment-bootstrap.selinux
    requires:
      - deployment-bootstrap.deploy-steps-0
    playbook: deploy_steps_selinux_playbook.yaml
    runner_options:
      extravars: global_vars.yaml

  - id: common-roles
    driver: ansible_runner
    provides:
      - deployment-bootstrap.common-roles
    requires:
      - deployment-bootstrap.selinux
    playbook: deploy_steps_common_roles_playbook.yaml
    runner_options:
      extravars: global_vars.yaml

  - id: deploy-steps-0-tasks
    driver: ansible_runner
    provides:
      - deployment-bootstrap.deploy-steps-0-tasks
    requires:
      - deployment-bootstrap.common-roles
    playbook: deploy_steps_0_tasks_playbook.yaml
    runner_options:
      extravars: global_vars.yaml

  - id: pre-network
    driver: ansible_runner
    provides:
      - deployment-bootstrap.pre-network
    requires:
      - deployment-bootstrap.deploy-steps-0-tasks
    playbook: deploy_steps_pre_network_playbook.yaml
    runner_options:
      extravars: global_vars.yaml

  - id: end
    driver: print
    provides:
      - deployment-bootstrap.end
    requires:
      - deployment-bootstrap.pre-network
    needed-by:
      - deployment-state.bootstrap-end
    message: "DEPLOYMENT: bootstrap end"
