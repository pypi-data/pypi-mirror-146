<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Credential management &mdash; DataLad 0.15.3+529.gc81453444.dirty documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="URL substitution" href="url_substitution.html" />
    <link rel="prev" title="Exception handling" href="exception_handling.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> DataLad
            <img src="../_static/datalad_logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                0.15
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Change log</a></li>
<li class="toctree-l1"><a class="reference internal" href="../acknowledgements.html">Acknowledgments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../publications.html">Publications</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../background.html">Background and motivation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../related.html">Delineation from related solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basics.html">Basic principles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../credentials.html">Credentials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../metadata.html">Metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="../customization.html">Customization and extension of functionality</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Design</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="application_vs_library_mode.html">Application-type vs. library-type usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="file_url_handling.html">File URL handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="result_records.html">Result records</a></li>
<li class="toctree-l2"><a class="reference internal" href="dataset_argument.html"><code class="docutils literal notranslate"><span class="pre">dataset</span></code> argument</a></li>
<li class="toctree-l2"><a class="reference internal" href="log_levels.html">Log levels</a></li>
<li class="toctree-l2"><a class="reference internal" href="drop.html">Drop dataset components</a></li>
<li class="toctree-l2"><a class="reference internal" href="python_imports.html">Python import statements</a></li>
<li class="toctree-l2"><a class="reference internal" href="miscpatterns.html">Miscellaneous patterns</a></li>
<li class="toctree-l2"><a class="reference internal" href="exception_handling.html">Exception handling</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Credential management</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#credentials">Credentials</a></li>
<li class="toctree-l3"><a class="reference internal" href="#providers">Providers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#integration-with-git">Integration with Git</a></li>
<li class="toctree-l3"><a class="reference internal" href="#authenticators">Authenticators</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="url_substitution.html">URL substitution</a></li>
<li class="toctree-l2"><a class="reference internal" href="threaded_runner.html">Threaded runner</a></li>
<li class="toctree-l2"><a class="reference internal" href="batched_command.html">BatchedCommand and BatchedAnnex</a></li>
<li class="toctree-l2"><a class="reference internal" href="standard_parameters.html">Standard parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="pos_vs_kw_parameters.html">Positional vs Keyword parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="docstrings.html">Docstrings</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../cmdline.html">Command line reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modref.html">Python module reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../config.html">Configuration</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">DataLad</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Design</a> &raquo;</li>
      <li>Credential management</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="credential-management">
<span id="chap-design-credentials"></span><h1>Credential management<a class="headerlink" href="#credential-management" title="Permalink to this headline"></a></h1>
<div class="topic">
<p class="topic-title">Specification scope and status</p>
<p>This specification describes the current implementation.</p>
</div>
<p>Various components of DataLad need to be passed credentials to interact with services that require authentication.
This includes downloading files, but also things like REST API usage or authenticated cloning.
Key components of Datalad’s credential management are credentials types, providers, authenticators and downloaders.</p>
<section id="credentials">
<h2>Credentials<a class="headerlink" href="#credentials" title="Permalink to this headline"></a></h2>
<p>Supported credential types include basic user/password combinations, access tokens, and a range of tailored solutions for particular services.
All credential type implementations are derived from a common <code class="xref py py-class docutils literal notranslate"><span class="pre">Credential</span></code> base class.
A mapping from string labels to credential classes is defined in <code class="docutils literal notranslate"><span class="pre">datalad.downloaders.CREDENTIAL_TYPES</span></code>.</p>
<p>Importantly, credentials must be identified by a name.
This name is a label that is often hard-coded in the program code of DataLad, any of its extensions, or specified in a dataset or in provider configurations (see below).</p>
<p>Given a credential <code class="docutils literal notranslate"><span class="pre">name</span></code>, one or more credential <code class="docutils literal notranslate"><span class="pre">component</span></code>(s) (e.g., <code class="docutils literal notranslate"><span class="pre">token</span></code>, <code class="docutils literal notranslate"><span class="pre">username</span></code>, or <code class="docutils literal notranslate"><span class="pre">password</span></code>) can be looked up by DataLad in at least two different locations.
These locations are tried in the following order, and the first successful lookup yields the final value.</p>
<ol class="arabic simple">
<li><p>A configuration item <code class="docutils literal notranslate"><span class="pre">datalad.credential.&lt;name&gt;.&lt;component&gt;</span></code>.
Such configuration items can be defined in any location supported by DataLad’s configuration system.
As with any other specification of configuration items, environment variables can be used to set or override credentials.
Variable names take the form of <code class="docutils literal notranslate"><span class="pre">DATALAD_CREDENTIAL_&lt;NAME&gt;_&lt;COMPONENT&gt;</span></code>, and standard replacement rules into configuration variable names apply.</p></li>
<li><p>DataLad uses the <cite>keyring</cite> package <a class="reference external" href="https://pypi.org/project/keyring">https://pypi.org/project/keyring</a> to connect to any of its supported back-ends for setting or getting credentials,
via a wrapper in <code class="xref py py-mod docutils literal notranslate"><span class="pre">keyring_</span></code>.
This provides support for credential storage on all major platforms, but also extensibility, providing 3rd-parties to implement and use specialized solutions.</p></li>
</ol>
<p>When a credential is required for operation, but could not be obtained via any of the above approaches, DataLad can prompt for credentials in interactive terminal sessions.
Interactively entered credentials will be stored in the active credential store available via the <code class="docutils literal notranslate"><span class="pre">keyring</span></code> package.
Note, however, that the keyring approach is somewhat abused by datalad.
The wrapper only uses <code class="docutils literal notranslate"><span class="pre">get_/set_password</span></code> of <code class="docutils literal notranslate"><span class="pre">keyring</span></code> with the credential’s <code class="docutils literal notranslate"><span class="pre">FIELDS</span></code> as the name to query (essentially turning the keyring into a plain key-value store) and “datalad-&lt;CREDENTIAL-LABEL&gt;” as the “service name”.
With this approach it’s not possible to use credentials in a system’s keyring that were defined by other, datalad unaware software (or users).</p>
<p>When a credential value is known but invalid, the invalid value must be removed or replaced in the active credential store.
By setting the configuration flag <code class="docutils literal notranslate"><span class="pre">datalad.credentials.force-ask</span></code>, DataLad can be instructed to force interactive credential re-entry to effectively override any store credential with a new value.</p>
</section>
<section id="providers">
<h2>Providers<a class="headerlink" href="#providers" title="Permalink to this headline"></a></h2>
<p>Providers are associating credentials with a context for using them and are defined by configuration files.
A single provider is represented by <code class="xref py py-class docutils literal notranslate"><span class="pre">Provider</span></code> object and the list of available providers is represented by the <code class="xref py py-class docutils literal notranslate"><span class="pre">Providers</span></code> class.
A provider is identified by a label and stored in a dedicated config file per provider named <cite>LABEL.cfg</cite>.
Such a file can reside in a dataset (under <cite>.datalad/providers/</cite>), at the user level (under <cite>{user_config_dir}/providers</cite>), at the system level (under <cite>{site_config_dir}/providers</cite>) or come packaged with the datalad distribution (in directory <cite>configs</cite> next to <cite>providers.py</cite>).
Such a provider specifies a regular expression to match URLs against and assigns authenticator abd credentials to be used for a match.
Credentials are referenced by their label, which in turn is the name of another section in such a file specifying the type of the credential.
References to credential and authenticator types are strings that are mapped to classes by the following dict definitions:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">datalad.downloaders.AUTHENTICATION_TYPES</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">datalad.downloaders.CREDENTIAL_TYPES</span></code></p></li>
</ul>
<p>Available providers can be loaded by <code class="docutils literal notranslate"><span class="pre">Providers.from_config_files</span></code> and <code class="docutils literal notranslate"><span class="pre">Providers.get_provider(url)</span></code> will match a given URL against them and return the appropriate <cite>Provider</cite> instance.
A <code class="xref py py-class docutils literal notranslate"><span class="pre">Provider</span></code> object will determine a downloader to use (derived from <code class="xref py py-class docutils literal notranslate"><span class="pre">BaseDownloader</span></code>), based on the URL’s protocol.</p>
<p>Note, that the provider config files are not currently following datalad’s general config approach.
Instead they are special config files, read by <code class="xref py py-class docutils literal notranslate"><span class="pre">configparser.ConfigParser</span></code> that are not compatible with <cite>git-config</cite> and hence the <code class="xref py py-class docutils literal notranslate"><span class="pre">ConfigManager</span></code>.</p>
<p>There are currently two ways of storing a provider and thus creating its config file: <code class="docutils literal notranslate"><span class="pre">Providers.enter_new</span></code> and <code class="docutils literal notranslate"><span class="pre">Providers._store_new</span></code>.
The former will only work interactively and provide the user with options to choose from, while the latter is non-interactive and can therefore only be used, when all properties of the provider config are known and passed to it.
There’s no way at the moment to store an existing <code class="xref py py-class docutils literal notranslate"><span class="pre">Provider</span></code> object directly.</p>
</section>
<section id="integration-with-git">
<h2>Integration with Git<a class="headerlink" href="#integration-with-git" title="Permalink to this headline"></a></h2>
<p>In addition, there’s a special case for interfacing <cite>git-credential</cite>: A dedicated <code class="xref py py-class docutils literal notranslate"><span class="pre">GitCredential</span></code> class is used to talk to Git’s <code class="docutils literal notranslate"><span class="pre">git-credential</span></code> command instead of the keyring wrapper.
This class has identical fields to the <code class="xref py py-class docutils literal notranslate"><span class="pre">UserPassword</span></code> class and thus can be used by the same authenticators.
Since Git’s way to deal with credentials doesn’t involve labels but only matching URLs, it is - in some sense - the equivalent of datalad’s provider layer.
However, providers don’t talk to a backend, credentials do.
Hence, a more seemless integration requires some changes in the design of datalad’s credential system as a whole.</p>
<p>In the opposite direction - making Git aware of datalad’s credentials, there’s no special casing, though.
Datalad comes with a <cite>git-credential-datalad</cite> executable.
Whenever Git is configured to use it by setting <cite>credential.helper=datalad</cite>, it will be able to query datalad’s credential system for a provider matching the URL in question and retrieve the referenced by this provider credentials.
This helper can also store a new provider+credentials when asked to do so by Git.
It can do this interactively, asking a user to confirm/change that config or - if <cite>credential.helper=’datalad –non-interactive’</cite> - try to non-interactively store with its defaults.</p>
</section>
<section id="authenticators">
<h2>Authenticators<a class="headerlink" href="#authenticators" title="Permalink to this headline"></a></h2>
<p>Authenticators are used by downloaders to issue authenticated requests.
They are not easily available to directly be applied to requests being made outside of the downloaders.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="exception_handling.html" class="btn btn-neutral float-left" title="Exception handling" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="url_substitution.html" class="btn btn-neutral float-right" title="URL substitution" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016-2022, DataLad team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>