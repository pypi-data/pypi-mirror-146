<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>datalad.api.aggregate_metadata &mdash; DataLad 0.15.3+529.gc81453444.dirty documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="datalad.api.extract_metadata" href="datalad.api.extract_metadata.html" />
    <link rel="prev" title="datalad.api.metadata" href="datalad.api.metadata.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> DataLad
            <img src="../_static/datalad_logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                0.15
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Change log</a></li>
<li class="toctree-l1"><a class="reference internal" href="../acknowledgements.html">Acknowledgments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../publications.html">Publications</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../background.html">Background and motivation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../related.html">Delineation from related solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basics.html">Basic principles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../credentials.html">Credentials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../metadata.html">Metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="../customization.html">Customization and extension of functionality</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/index.html">Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../cmdline.html">Command line reference</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../modref.html">Python module reference</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../modref.html#high-level-user-interface">High-level user interface</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../modref.html#dataset-operations">Dataset operations</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../modref.html#metadata-handling">Metadata handling</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="datalad.api.search.html">datalad.api.search</a></li>
<li class="toctree-l4"><a class="reference internal" href="datalad.api.metadata.html">datalad.api.metadata</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">datalad.api.aggregate_metadata</a></li>
<li class="toctree-l4"><a class="reference internal" href="datalad.api.extract_metadata.html">datalad.api.extract_metadata</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../modref.html#reproducible-execution">Reproducible execution</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modref.html#plumbing-commands">Plumbing commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modref.html#miscellaneous-commands">Miscellaneous commands</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../modref.html#support-functionality">Support functionality</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modref.html#configuration-management">Configuration management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modref.html#test-infrastructure">Test infrastructure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modref.html#command-line-interface-infrastructure">Command line interface infrastructure</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../config.html">Configuration</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">DataLad</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../modref.html">Python module reference</a> &raquo;</li>
      <li>datalad.api.aggregate_metadata</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="datalad-api-aggregate-metadata">
<h1>datalad.api.aggregate_metadata<a class="headerlink" href="#datalad-api-aggregate-metadata" title="Permalink to this headline"></a></h1>
<dl class="py function">
<dt class="sig sig-object py" id="datalad.api.aggregate_metadata">
<span class="sig-prename descclassname"><span class="pre">datalad.api.</span></span><span class="sig-name descname"><span class="pre">aggregate_metadata</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dataset</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">recursive</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">recursion_limit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">update_mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'target'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">incremental</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">force_extraction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#datalad.api.aggregate_metadata" title="Permalink to this definition"></a></dt>
<dd><p>Aggregate metadata of one or more datasets for later query.</p>
<p>Metadata aggregation refers to a procedure that extracts metadata present
in a dataset into a portable representation that is stored a single
standardized format. Moreover, metadata aggregation can also extract
metadata in this format from one dataset and store it in another
(super)dataset. Based on such collections of aggregated metadata it is
possible to discover particular datasets and specific parts of their
content, without having to obtain the target datasets first (see the
DataLad ‘search’ command).</p>
<p>To enable aggregation of metadata that are contained in files of a dataset,
one has to enable one or more metadata extractor for a dataset. DataLad
supports a number of common metadata standards, such as the Exchangeable
Image File Format (EXIF), Adobe’s Extensible Metadata Platform (XMP), and
various audio file metadata systems like ID3. DataLad extension packages
can provide metadata data extractors for additional metadata sources. For
example, the neuroimaging extension provides extractors for scientific
(meta)data standards like BIDS, DICOM, and NIfTI1.  Some metadata
extractors depend on particular 3rd-party software. The list of metadata
extractors available to a particular DataLad installation is reported by
the ‘wtf’ command (‘datalad wtf’).</p>
<p>Enabling a metadata extractor for a dataset is done by adding its name to the
‘datalad.metadata.nativetype’ configuration variable – typically in the
dataset’s configuration file (.datalad/config), e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">datalad</span> <span class="s2">&quot;metadata&quot;</span><span class="p">]</span>
  <span class="n">nativetype</span> <span class="o">=</span> <span class="n">exif</span>
  <span class="n">nativetype</span> <span class="o">=</span> <span class="n">xmp</span>
</pre></div>
</div>
<p>If an enabled metadata extractor is not available in a particular DataLad
installation, metadata extraction will not succeed in order to avoid
inconsistent aggregation results.</p>
<p>Enabling multiple extractors is supported. In this case, metadata are
extracted by each extractor individually, and stored alongside each other.
Metadata aggregation will also extract DataLad’s own metadata (extractors
‘datalad_core’, and ‘annex’).</p>
<p>Metadata aggregation can be performed recursively, in order to aggregate all
metadata across all subdatasets, for example, to be able to search across
any content in any dataset of a collection. Aggregation can also be performed
for subdatasets that are not available locally. In this case, pre-aggregated
metadata from the closest available superdataset will be considered instead.</p>
<p>Depending on the versatility of the present metadata and the number of dataset
or files, aggregated metadata can grow prohibitively large. A number of
configuration switches are provided to mitigate such issues.</p>
<dl class="simple">
<dt>datalad.metadata.aggregate-content-&lt;extractor-name&gt;</dt><dd><p>If set to false, content metadata aggregation will not be performed for
the named metadata extractor (a potential underscore ‘_’ in the extractor name must
be replaced by a dash ‘-‘). This can substantially reduce the runtime for
metadata extraction, and also reduce the size of the generated metadata
aggregate. Note, however, that some extractors may not produce any metadata
when this is disabled, because their metadata might come from individual
file headers only. ‘datalad.metadata.store-aggregate-content’ might be
a more appropriate setting in such cases.</p>
</dd>
<dt>datalad.metadata.aggregate-ignore-fields</dt><dd><p>Any metadata key matching any regular expression in this configuration setting
is removed prior to generating the dataset-level metadata summary (keys
and their unique values across all dataset content), and from the dataset
metadata itself. This switch can also be used to filter out sensitive
information prior aggregation.</p>
</dd>
<dt>datalad.metadata.generate-unique-&lt;extractor-name&gt;</dt><dd><p>If set to false, DataLad will not auto-generate a summary of unique content
metadata values for a particular extractor as part of the dataset-global metadata
(a potential underscore ‘_’ in the extractor name must be replaced by a dash ‘-‘).
This can be useful if such a summary is bloated due to minor uninformative (e.g.
numerical) differences, or when a particular extractor already provides a
carefully designed content metadata summary.</p>
</dd>
<dt>datalad.metadata.maxfieldsize</dt><dd><p>Any metadata value that exceeds the size threshold given by this configuration
setting (in bytes/characters) is removed.</p>
</dd>
<dt>datalad.metadata.store-aggregate-content</dt><dd><p>If set, extracted content metadata are still used to generate a dataset-level
summary of present metadata (all keys and their unique values across all
files in a dataset are determined and stored as part of the dataset-level
metadata aggregate, see datalad.metadata.generate-unique-&lt;extractor-name&gt;),
but metadata on individual files are not stored.
This switch can be used to avoid prohibitively large metadata files. Discovery
of datasets containing content matching particular metadata properties will
still be possible, but such datasets would have to be obtained first in order
to discover which particular files in them match these properties.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>path</strong> (<em>sequence of str</em><em> or </em><em>None</em><em>, </em><em>optional</em>) – path to datasets that shall be aggregated. When a given path is
pointing into a dataset, the metadata of the containing dataset will
be aggregated.  If no paths given, current dataset metadata is
aggregated. [Default: None]</p></li>
<li><p><strong>dataset</strong> (<a class="reference internal" href="datalad.api.Dataset.html#datalad.api.Dataset" title="datalad.api.Dataset"><em>Dataset</em></a><em> or </em><em>None</em><em>, </em><em>optional</em>) – topmost dataset metadata will be aggregated into. All dataset
between this dataset and any given path will receive updated
aggregated metadata from all given paths. [Default: None]</p></li>
<li><p><strong>recursive</strong> (<em>bool</em><em>, </em><em>optional</em>) – if set, recurse into potential subdatasets. [Default: False]</p></li>
<li><p><strong>recursion_limit</strong> (<em>int</em><em> or </em><em>None</em><em>, </em><em>optional</em>) – limit recursion into subdatasets to the given number of levels.
[Default: None]</p></li>
<li><p><strong>update_mode</strong> (<em>{'all'</em><em>, </em><em>'target'}</em><em>, </em><em>optional</em>) – which datasets to update with newly aggregated metadata: all
datasets from any leaf dataset to the top-level target dataset
including all intermediate datasets (all), or just the top-level
target dataset (target). [Default: ‘target’]</p></li>
<li><p><strong>incremental</strong> (<em>bool</em><em>, </em><em>optional</em>) – If set, all information on metadata records of subdatasets that have
not been (re-)aggregated in this run will be kept unchanged. This is
useful when (re-)aggregation only a subset of a dataset hierarchy,
for example, because not all subdatasets are locally available.
[Default: False]</p></li>
<li><p><strong>force_extraction</strong> (<em>bool</em><em>, </em><em>optional</em>) – If set, all enabled extractors will be engaged regardless of whether
change detection indicates that metadata has already been extracted
for a given dataset state. [Default: False]</p></li>
<li><p><strong>save</strong> (<em>bool</em><em>, </em><em>optional</em>) – by default all modifications to a dataset are immediately saved.
Giving this option will disable this behavior. [Default: True]</p></li>
<li><p><strong>on_failure</strong> (<em>{'ignore'</em><em>, </em><em>'continue'</em><em>, </em><em>'stop'}</em><em>, </em><em>optional</em>) – behavior to perform on failure: ‘ignore’ any failure is reported,
but does not cause an exception; ‘continue’ if any failure occurs an
exception will be raised at the end, but processing other actions
will continue for as long as possible; ‘stop’: processing will stop
on first failure and an exception is raised. A failure is any result
with status ‘impossible’ or ‘error’. Raised exception is an
IncompleteResultsError that carries the result dictionaries of the
failures in its <cite>failed</cite> attribute. [Default: ‘continue’]</p></li>
<li><p><strong>result_filter</strong> (<em>callable</em><em> or </em><em>None</em><em>, </em><em>optional</em>) – if given, each to-be-returned status dictionary is passed to this
callable, and is only returned if the callable’s return value does
not evaluate to False or a ValueError exception is raised. If the
given callable supports <cite>**kwargs</cite> it will additionally be passed
the keyword arguments of the original API call. [Default: None]</p></li>
<li><p><strong>result_renderer</strong> – select rendering mode command results. ‘tailored’ enables a command-
specific rendering style that is typically tailored to human
consumption, if there is one for a specific command, or otherwise
falls back on the the ‘generic’ result renderer; ‘generic’ renders
each result in one line  with key info like action, status, path,
and an optional message); ‘json’ a complete JSON line serialization
of the full result record; ‘json_pp’ like ‘json’, but pretty-printed
spanning multiple lines; ‘disabled’ turns off result rendering
entirely; ‘&lt;template&gt;’ reports any value(s) of any result properties
in any format indicated by the template (e.g. ‘{path}’, compare with
JSON output for all key-value choices). The template syntax follows
the Python “format() language”. It is possible to report individual
dictionary values, e.g. ‘{metadata[name]}’. If a 2nd-level key
contains a colon, e.g. ‘music:Genre’, ‘:’ must be substituted by ‘#’
in the template, like so: ‘{metadata[music#Genre]}’. [Default:
‘tailored’]</p></li>
<li><p><strong>result_xfm</strong> (<em>{'datasets'</em><em>, </em><em>'successdatasets-or-none'</em><em>, </em><em>'paths'</em><em>, </em><em>'relpaths'</em><em>, </em><em>'metadata'}</em><em> or </em><em>callable</em><em> or </em><em>None</em><em>, </em><em>optional</em>) – if given, each to-be-returned result status dictionary is passed to
this callable, and its return value becomes the result instead. This
is different from <cite>result_filter</cite>, as it can perform arbitrary
transformation of the result value. This is mostly useful for top-
level command invocations that need to provide the results in a
particular format. Instead of a callable, a label for a pre-crafted
result transformation can be given. [Default: None]</p></li>
<li><p><strong>return_type</strong> (<em>{'generator'</em><em>, </em><em>'list'</em><em>, </em><em>'item-or-list'}</em><em>, </em><em>optional</em>) – return value behavior switch. If ‘item-or-list’ a single value is
returned instead of a one-item return value list, or a list in case
of multiple return values. <cite>None</cite> is return in case of an empty
list. [Default: ‘list’]</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="datalad.api.metadata.html" class="btn btn-neutral float-left" title="datalad.api.metadata" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="datalad.api.extract_metadata.html" class="btn btn-neutral float-right" title="datalad.api.extract_metadata" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016-2022, DataLad team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>