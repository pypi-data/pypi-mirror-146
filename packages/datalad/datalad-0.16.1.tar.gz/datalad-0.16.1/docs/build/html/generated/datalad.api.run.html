<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>datalad.api.run &mdash; DataLad 0.15.3+529.gc81453444.dirty documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="datalad.api.rerun" href="datalad.api.rerun.html" />
    <link rel="prev" title="datalad.api.extract_metadata" href="datalad.api.extract_metadata.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> DataLad
            <img src="../_static/datalad_logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                0.15
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Change log</a></li>
<li class="toctree-l1"><a class="reference internal" href="../acknowledgements.html">Acknowledgments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../publications.html">Publications</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../background.html">Background and motivation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../related.html">Delineation from related solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basics.html">Basic principles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../credentials.html">Credentials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../metadata.html">Metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="../customization.html">Customization and extension of functionality</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/index.html">Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../cmdline.html">Command line reference</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../modref.html">Python module reference</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../modref.html#high-level-user-interface">High-level user interface</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../modref.html#dataset-operations">Dataset operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modref.html#metadata-handling">Metadata handling</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../modref.html#reproducible-execution">Reproducible execution</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#">datalad.api.run</a></li>
<li class="toctree-l4"><a class="reference internal" href="datalad.api.rerun.html">datalad.api.rerun</a></li>
<li class="toctree-l4"><a class="reference internal" href="datalad.api.run_procedure.html">datalad.api.run_procedure</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../modref.html#plumbing-commands">Plumbing commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modref.html#miscellaneous-commands">Miscellaneous commands</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../modref.html#support-functionality">Support functionality</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modref.html#configuration-management">Configuration management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modref.html#test-infrastructure">Test infrastructure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modref.html#command-line-interface-infrastructure">Command line interface infrastructure</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../config.html">Configuration</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">DataLad</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../modref.html">Python module reference</a> &raquo;</li>
      <li>datalad.api.run</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="datalad-api-run">
<h1>datalad.api.run<a class="headerlink" href="#datalad-api-run" title="Permalink to this headline"></a></h1>
<dl class="py function">
<dt class="sig sig-object py" id="datalad.api.run">
<span class="sig-prename descclassname"><span class="pre">datalad.api.</span></span><span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cmd</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dataset</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inputs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outputs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">expand</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">assume_ready</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">explicit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">message</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sidecar</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dry_run</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">jobs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#datalad.api.run" title="Permalink to this definition"></a></dt>
<dd><p>Run an arbitrary shell command and record its impact on a dataset.</p>
<p>It is recommended to craft the command such that it can run in the root
directory of the dataset that the command will be recorded in. However,
as long as the command is executed somewhere underneath the dataset root,
the exact location will be recorded relative to the dataset root.</p>
<p>If the executed command did not alter the dataset in any way, no record of
the command execution is made.</p>
<p>If the given command errors, a <cite>CommandError</cite> exception with the same exit
code will be raised, and no modifications will be saved.</p>
<p><em>Command format</em></p>
<p>A few placeholders are supported in the command via Python format
specification. “{pwd}” will be replaced with the full path of the
current working directory. “{dspath}” will be replaced with the full
path of the dataset that run is invoked on. “{tmpdir}” will be
replaced with the full path of a temporary directory. “{inputs}” and
“{outputs}” represent the values specified by <cite>inputs</cite> and <cite>outputs</cite>.
If multiple values are specified, the values will be joined by a
space. The order of the values will match that order from the command
line, with any globs expanded in alphabetical order (like bash).
Individual values can be accessed with an integer index (e.g.,
“{inputs[0]}”).</p>
<p>Note that the representation of the inputs or outputs in the formatted
command string depends on whether the command is given as a list of
arguments or as a string. The concatenated list of inputs or outputs
will be surrounded by quotes when the command is given as a list but
not when it is given as a string. This means that the string form is
required if you need to pass each input as a separate argument to a
preceding script (i.e., write the command as “./script {inputs}”,
quotes included). The string form should also be used if the input or
output paths contain spaces or other characters that need to be
escaped.</p>
<p>To escape a brace character, double it (i.e., “{{” or “}}”).</p>
<p>Custom placeholders can be added as configuration variables under
“datalad.run.substitutions”.  As an example:</p>
<blockquote>
<div><p>Add a placeholder “name” with the value “joe”:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">git</span> <span class="n">config</span> <span class="o">--</span><span class="n">file</span><span class="o">=.</span><span class="n">datalad</span><span class="o">/</span><span class="n">config</span> <span class="n">datalad</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">substitutions</span><span class="o">.</span><span class="n">name</span> <span class="n">joe</span>
<span class="o">%</span> <span class="n">datalad</span> <span class="n">save</span> <span class="o">-</span><span class="n">m</span> <span class="s2">&quot;Configure name placeholder&quot;</span> <span class="o">.</span><span class="n">datalad</span><span class="o">/</span><span class="n">config</span>
</pre></div>
</div>
<p>Access the new placeholder in a command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">datalad</span> <span class="n">run</span> <span class="s2">&quot;echo my name is </span><span class="si">{name}</span><span class="s2"> &gt;me&quot;</span>
</pre></div>
</div>
</div></blockquote>
<p class="rubric">Examples</p>
<p>Run an executable script and record the impact on a dataset:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">run</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s1">&#39;run my script&#39;</span><span class="p">,</span> <span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;code/script.sh&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Run a command and specify a directory as a dependency for the run. The
contents of the dependency will be retrieved prior to running the
script:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;code/script.sh&#39;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s1">&#39;run my script&#39;</span><span class="p">,</span>
      <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;data/*&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>Run an executable script and specify output files of the script to be
unlocked prior to running the script:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;code/script.sh&#39;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s1">&#39;run my script&#39;</span><span class="p">,</span>
      <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;data/*&#39;</span><span class="p">],</span> <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;output_dir&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>Specify multiple inputs and outputs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;code/script.sh&#39;</span><span class="p">,</span>
      <span class="n">message</span><span class="o">=</span><span class="s1">&#39;run my script&#39;</span><span class="p">,</span>
      <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;data/*&#39;</span><span class="p">,</span> <span class="s1">&#39;datafile.txt&#39;</span><span class="p">],</span>
      <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;output_dir&#39;</span><span class="p">,</span> <span class="s1">&#39;outfile.txt&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>Use ** to match any file at any directory depth recursively. Single *
does not check files within matched directories.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;code/script.sh&#39;</span><span class="p">,</span>
      <span class="n">message</span><span class="o">=</span><span class="s1">&#39;run my script&#39;</span><span class="p">,</span>
      <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;data/**/*.dat&#39;</span><span class="p">],</span>
      <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;output_dir/**&#39;</span><span class="p">])</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cmd</strong> – command for execution. A leading ‘–’ can be used to disambiguate
this command from the preceding options to DataLad. [Default: None]</p></li>
<li><p><strong>dataset</strong> (<a class="reference internal" href="datalad.api.Dataset.html#datalad.api.Dataset" title="datalad.api.Dataset"><em>Dataset</em></a><em> or </em><em>None</em><em>, </em><em>optional</em>) – specify the dataset to record the command results in. An attempt is
made to identify the dataset based on the current working directory.
If a dataset is given, the command will be executed in the root
directory of this dataset. [Default: None]</p></li>
<li><p><strong>inputs</strong> – A dependency for the run. Before running the command, the content of
this file will be retrieved. A value of “.” means “run
<strong class="command">datalad get .</strong>”. The value can also be a glob. [Default:
None]</p></li>
<li><p><strong>outputs</strong> – Prepare this file to be an output file of the command. A value of
“.” means “run <strong class="command">datalad unlock .</strong>” (and will fail if some
content isn’t present). For any other value, if the content of this
file is present, unlock the file. Otherwise, remove it. The value
can also be a glob. [Default: None]</p></li>
<li><p><strong>expand</strong> (<em>{None</em><em>, </em><em>'inputs'</em><em>, </em><em>'outputs'</em><em>, </em><em>'both'}</em><em>, </em><em>optional</em>) – Expand globs when storing inputs and/or outputs in the commit
message. [Default: None]</p></li>
<li><p><strong>assume_ready</strong> (<em>{None</em><em>, </em><em>'inputs'</em><em>, </em><em>'outputs'</em><em>, </em><em>'both'}</em><em>, </em><em>optional</em>) – Assume that inputs do not need to be retrieved and/or outputs do not
need to unlocked or removed before running the command. This option
allows you to avoid the expense of these preparation steps if you
know that they are unnecessary. [Default: None]</p></li>
<li><p><strong>explicit</strong> (<em>bool</em><em>, </em><em>optional</em>) – Consider the specification of inputs and outputs to be explicit.
Don’t warn if the repository is dirty, and only save modifications
to the listed outputs. [Default: False]</p></li>
<li><p><strong>message</strong> (<em>str</em><em> or </em><em>None</em><em>, </em><em>optional</em>) – a description of the state or the changes made to a dataset.
[Default: None]</p></li>
<li><p><strong>sidecar</strong> (<em>None</em><em> or </em><em>bool</em><em>, </em><em>optional</em>) – By default, the configuration variable ‘datalad.run.record-sidecar’
determines whether a record with information on a command’s
execution is placed into a separate record file instead of the
commit message (default: off). This option can be used to override
the configured behavior on a case-by-case basis. Sidecar files are
placed into the dataset’s ‘.datalad/runinfo’ directory (customizable
via the ‘datalad.run.record-directory’ configuration variable).
[Default: None]</p></li>
<li><p><strong>dry_run</strong> (<em>{None</em><em>, </em><em>'basic'</em><em>, </em><em>'command'}</em><em>, </em><em>optional</em>) – Do not run the command; just display details about the command
execution. A value of “basic” reports a few important details about
the execution, including the expanded command and expanded inputs
and outputs. “command” displays the expanded command only. Note that
input and output globs underneath an uninstalled dataset will be
left unexpanded because no subdatasets will be installed for a dry
run. [Default: None]</p></li>
<li><p><strong>jobs</strong> (<em>int</em><em> or </em><em>None</em><em> or </em><em>{'auto'}</em><em>, </em><em>optional</em>) – how many parallel jobs (where possible) to use. “auto” corresponds
to the number defined by ‘datalad.runtime.max-annex-jobs’
configuration item        NOTE: This option can only parallelize
input retrieval (get) and output recording (save). DataLad does NOT
parallelize your scripts for you. [Default: None]</p></li>
<li><p><strong>on_failure</strong> (<em>{'ignore'</em><em>, </em><em>'continue'</em><em>, </em><em>'stop'}</em><em>, </em><em>optional</em>) – behavior to perform on failure: ‘ignore’ any failure is reported,
but does not cause an exception; ‘continue’ if any failure occurs an
exception will be raised at the end, but processing other actions
will continue for as long as possible; ‘stop’: processing will stop
on first failure and an exception is raised. A failure is any result
with status ‘impossible’ or ‘error’. Raised exception is an
IncompleteResultsError that carries the result dictionaries of the
failures in its <cite>failed</cite> attribute. [Default: ‘continue’]</p></li>
<li><p><strong>result_filter</strong> (<em>callable</em><em> or </em><em>None</em><em>, </em><em>optional</em>) – if given, each to-be-returned status dictionary is passed to this
callable, and is only returned if the callable’s return value does
not evaluate to False or a ValueError exception is raised. If the
given callable supports <cite>**kwargs</cite> it will additionally be passed
the keyword arguments of the original API call. [Default: None]</p></li>
<li><p><strong>result_renderer</strong> – select rendering mode command results. ‘tailored’ enables a command-
specific rendering style that is typically tailored to human
consumption, if there is one for a specific command, or otherwise
falls back on the the ‘generic’ result renderer; ‘generic’ renders
each result in one line  with key info like action, status, path,
and an optional message); ‘json’ a complete JSON line serialization
of the full result record; ‘json_pp’ like ‘json’, but pretty-printed
spanning multiple lines; ‘disabled’ turns off result rendering
entirely; ‘&lt;template&gt;’ reports any value(s) of any result properties
in any format indicated by the template (e.g. ‘{path}’, compare with
JSON output for all key-value choices). The template syntax follows
the Python “format() language”. It is possible to report individual
dictionary values, e.g. ‘{metadata[name]}’. If a 2nd-level key
contains a colon, e.g. ‘music:Genre’, ‘:’ must be substituted by ‘#’
in the template, like so: ‘{metadata[music#Genre]}’. [Default:
‘tailored’]</p></li>
<li><p><strong>result_xfm</strong> (<em>{'datasets'</em><em>, </em><em>'successdatasets-or-none'</em><em>, </em><em>'paths'</em><em>, </em><em>'relpaths'</em><em>, </em><em>'metadata'}</em><em> or </em><em>callable</em><em> or </em><em>None</em><em>, </em><em>optional</em>) – if given, each to-be-returned result status dictionary is passed to
this callable, and its return value becomes the result instead. This
is different from <cite>result_filter</cite>, as it can perform arbitrary
transformation of the result value. This is mostly useful for top-
level command invocations that need to provide the results in a
particular format. Instead of a callable, a label for a pre-crafted
result transformation can be given. [Default: None]</p></li>
<li><p><strong>return_type</strong> (<em>{'generator'</em><em>, </em><em>'list'</em><em>, </em><em>'item-or-list'}</em><em>, </em><em>optional</em>) – return value behavior switch. If ‘item-or-list’ a single value is
returned instead of a one-item return value list, or a list in case
of multiple return values. <cite>None</cite> is return in case of an empty
list. [Default: ‘list’]</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="datalad.api.extract_metadata.html" class="btn btn-neutral float-left" title="datalad.api.extract_metadata" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="datalad.api.rerun.html" class="btn btn-neutral float-right" title="datalad.api.rerun" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016-2022, DataLad team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>