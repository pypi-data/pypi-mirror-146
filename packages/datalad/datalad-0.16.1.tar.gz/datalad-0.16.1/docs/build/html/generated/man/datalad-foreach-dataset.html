<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>datalad foreach-dataset &mdash; DataLad 0.15.3+529.gc81453444.dirty documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="datalad sshrun" href="datalad-sshrun.html" />
    <link rel="prev" title="datalad download-url" href="datalad-download-url.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> DataLad
            <img src="../../_static/datalad_logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                0.15
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Change log</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../acknowledgements.html">Acknowledgments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../publications.html">Publications</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../background.html">Background and motivation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../related.html">Delineation from related solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../basics.html">Basic principles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../credentials.html">Credentials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../metadata.html">Metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../customization.html">Customization and extension of functionality</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../design/index.html">Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../cmdline.html">Command line reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../cmdline.html#main-command">Main command</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cmdline.html#core-commands">Core commands</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../cmdline.html#extended-set-of-functionality">Extended set of functionality</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../cmdline.html#dataset-operations">Dataset operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../cmdline.html#dataset-siblings-and-3rd-party-platform-support">Dataset siblings and 3rd-party platform support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../cmdline.html#reproducible-execution">Reproducible execution</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../cmdline.html#metadata-handling">Metadata handling</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../../cmdline.html#helpers-and-support-utilities">Helpers and support utilities</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="datalad-add-archive-content.html">datalad add-archive-content: Extract and add the content of an archive to a dataset</a></li>
<li class="toctree-l4"><a class="reference internal" href="datalad-clean.html">datalad clean: Remove temporary left-overs of DataLad operations</a></li>
<li class="toctree-l4"><a class="reference internal" href="datalad-check-dates.html">datalad check-dates: Scan a dataset for dates and timestamps</a></li>
<li class="toctree-l4"><a class="reference internal" href="datalad-create-test-dataset.html">datalad create-test-dataset: Test helper</a></li>
<li class="toctree-l4"><a class="reference internal" href="datalad-download-url.html">datalad download-url: Download helper with support for DataLad's credential system</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">datalad foreach-dataset: Run a command or Python code on the dataset and/or each of its sub-datasets</a></li>
<li class="toctree-l4"><a class="reference internal" href="datalad-sshrun.html">datalad sshrun: Remote command execution using DataLad's connection management</a></li>
<li class="toctree-l4"><a class="reference internal" href="datalad-shell-completion.html">datalad shell-completion: Helper to support command completion</a></li>
<li class="toctree-l4"><a class="reference internal" href="datalad-test.html">datalad test: Frontend for running DataLad's internal test battery</a></li>
<li class="toctree-l4"><a class="reference internal" href="datalad-wtf.html">datalad wtf: Report on a DataLad installation and its configuration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../cmdline.html#deprecated-commands">Deprecated commands</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../modref.html">Python module reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../config.html">Configuration</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">DataLad</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../cmdline.html">Command line reference</a> &raquo;</li>
      <li>datalad foreach-dataset</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="datalad-foreach-dataset">
<span id="man-datalad-foreach-dataset"></span><h1>datalad foreach-dataset<a class="headerlink" href="#datalad-foreach-dataset" title="Permalink to this headline"></a></h1>
<section id="synopsis">
<h2>Synopsis<a class="headerlink" href="#synopsis" title="Permalink to this headline"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">datalad</span> <span class="n">foreach</span><span class="o">-</span><span class="n">dataset</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">cmd</span><span class="o">-</span><span class="nb">type</span> <span class="p">{</span><span class="n">auto</span><span class="o">|</span><span class="n">external</span><span class="o">|</span><span class="n">exec</span><span class="o">|</span><span class="nb">eval</span><span class="p">}]</span> <span class="p">[</span><span class="o">-</span><span class="n">d</span> <span class="n">DATASET</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">state</span>
    <span class="p">{</span><span class="n">present</span><span class="o">|</span><span class="n">absent</span><span class="o">|</span><span class="nb">any</span><span class="p">}]</span> <span class="p">[</span><span class="o">-</span><span class="n">r</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">R</span> <span class="n">LEVELS</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">contains</span> <span class="n">PATH</span><span class="p">]</span>
    <span class="p">[</span><span class="o">--</span><span class="n">bottomup</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">s</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">output</span><span class="o">-</span><span class="n">streams</span> <span class="p">{</span><span class="n">capture</span><span class="o">|</span><span class="k">pass</span><span class="o">-</span><span class="n">through</span><span class="p">}]</span>
    <span class="p">[</span><span class="o">--</span><span class="n">chpwd</span> <span class="p">{</span><span class="n">ds</span><span class="o">|</span><span class="n">pwd</span><span class="p">}]</span> <span class="p">[</span><span class="o">--</span><span class="n">safe</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">consume</span>
    <span class="p">{</span><span class="n">auto</span><span class="o">|</span><span class="nb">all</span><span class="o">-</span><span class="n">subds</span><span class="o">-</span><span class="n">done</span><span class="o">|</span><span class="n">superds</span><span class="o">-</span><span class="n">done</span><span class="o">|</span><span class="n">always</span><span class="p">}]</span> <span class="p">[</span><span class="o">-</span><span class="n">J</span> <span class="n">NJOBS</span><span class="p">]</span>
    <span class="p">[</span><span class="o">--</span><span class="n">version</span><span class="p">]</span> <span class="o">...</span>
</pre></div>
</div>
</section>
<section id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this headline"></a></h2>
<p>Run a command or Python code on the dataset and/or each of its sub-datasets.</p>
<p>This command provides a convenience for the cases were no dedicated DataLad command
is provided to operate across the hierarchy of datasets. It is very similar to
<cite>git submodule foreach</cite> command with the following major differences</p>
<ul class="simple">
<li><p>by default (unless –subdatasets-only) it would
include operation on the original dataset as well,</p></li>
<li><p>subdatasets could be traversed in bottom-up order,</p></li>
<li><p>can execute commands in parallel (see JOBS option), but would account for the order,
e.g. in bottom-up order command is executed in super-dataset only after it is executed
in all subdatasets.</p></li>
</ul>
<p>Additional notes:</p>
<ul class="simple">
<li><p>for execution of “external” commands we use the environment used to execute external
git and git-annex commands.</p></li>
</ul>
<p><em>Command format</em></p>
<p>–cmd-type external: A few placeholders are supported in the command
via Python format specification:</p>
<ul class="simple">
<li><p>“{pwd}” will be replaced with the full path of the current working directory.</p></li>
<li><p>“{ds}” and “{refds}” will provide instances of the dataset currently
operated on and the reference “context” dataset which was provided via <code class="docutils literal notranslate"><span class="pre">dataset</span></code>
argument.</p></li>
<li><p>“{tmpdir}” will be replaced with the full path of a temporary directory.</p></li>
</ul>
<p><em>Examples</em></p>
<p>Aggressively  git clean  all datasets, running 5 parallel jobs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">datalad</span> <span class="n">foreach</span><span class="o">-</span><span class="n">dataset</span> <span class="o">-</span><span class="n">r</span> <span class="o">-</span><span class="n">J</span> <span class="mi">5</span> <span class="n">git</span> <span class="n">clean</span> <span class="o">-</span><span class="n">dfx</span>
</pre></div>
</div>
</section>
<section id="options">
<h2>Options<a class="headerlink" href="#options" title="Permalink to this headline"></a></h2>
<section id="command">
<h3>COMMAND<a class="headerlink" href="#command" title="Permalink to this headline"></a></h3>
<p>command for execution. A leading ‘–’ can be used to disambiguate this command from the preceding options to DataLad. For –cmd-type exec or eval only a single command argument (Python code) is supported.</p>
</section>
<section id="h-help-help-np">
<h3><strong>-h</strong>, <strong>-\-help</strong>, <strong>-\-help-np</strong><a class="headerlink" href="#h-help-help-np" title="Permalink to this headline"></a></h3>
<p>show this help message. –help-np forcefully disables the use of a pager for displaying the help message</p>
</section>
<section id="cmd-type-auto-external-exec-eval">
<h3><strong>-\-cmd-type</strong> {auto|external|exec|eval}<a class="headerlink" href="#cmd-type-auto-external-exec-eval" title="Permalink to this headline"></a></h3>
<p>type of the command. EXTERNAL: to be run in a child process using dataset’s runner; ‘exec’: Python source code to execute using ‘exec(), no value returned; ‘eval’: Python source code to evaluate using ‘eval()’, return value is placed into ‘result’ field. ‘auto’: If used via Python API, and <cite>cmd</cite> is a Python function, it will use ‘eval’, and otherwise would assume ‘external’. Constraints: value must be one of (‘auto’, ‘external’, ‘exec’, ‘eval’) [Default: ‘auto’]</p>
</section>
<section id="d-dataset-dataset-dataset">
<h3><strong>-d</strong> <em>DATASET</em>, <strong>-\-dataset</strong> <em>DATASET</em><a class="headerlink" href="#d-dataset-dataset-dataset" title="Permalink to this headline"></a></h3>
<p>specify the dataset to operate on. If no dataset is given, an attempt is made to identify the dataset based on the input and/or the current working directory. Constraints: Value must be a Dataset or a valid identifier of a Dataset (e.g. a path)</p>
</section>
<section id="state-present-absent-any">
<h3><strong>-\-state</strong> {present|absent|any}<a class="headerlink" href="#state-present-absent-any" title="Permalink to this headline"></a></h3>
<p>indicate which (sub)datasets to consider: either only locally present, absent, or any of those two kinds. Constraints: value must be one of (‘present’, ‘absent’, ‘any’) [Default: ‘present’]</p>
</section>
<section id="r-recursive">
<h3><strong>-r</strong>, <strong>-\-recursive</strong><a class="headerlink" href="#r-recursive" title="Permalink to this headline"></a></h3>
<p>if set, recurse into potential subdatasets.</p>
</section>
<section id="r-levels-recursion-limit-levels">
<h3><strong>-R</strong> LEVELS, <strong>-\-recursion-limit</strong> LEVELS<a class="headerlink" href="#r-levels-recursion-limit-levels" title="Permalink to this headline"></a></h3>
<p>limit recursion into subdatasets to the given number of levels. Constraints: value must be convertible to type ‘int’</p>
</section>
<section id="contains-path">
<h3><strong>-\-contains</strong> PATH<a class="headerlink" href="#contains-path" title="Permalink to this headline"></a></h3>
<p>limit to the subdatasets containing the given path. If a root path of a subdataset is given, the last considered dataset will be the subdataset itself. This option can be given multiple times, in which case datasets that contain any of the given paths will be considered. Constraints: value must be a string</p>
</section>
<section id="bottomup">
<h3><strong>-\-bottomup</strong><a class="headerlink" href="#bottomup" title="Permalink to this headline"></a></h3>
<p>whether to report subdatasets in bottom-up order along each branch in the dataset tree, and not top-down.</p>
</section>
<section id="s-subdatasets-only">
<h3><strong>-s</strong>, <strong>-\-subdatasets-only</strong><a class="headerlink" href="#s-subdatasets-only" title="Permalink to this headline"></a></h3>
<p>whether to exclude top level dataset. It is implied if a non-empty CONTAINS is used.</p>
</section>
<section id="output-streams-capture-pass-through-o-s-capture-pass-through">
<h3><strong>-\-output-streams</strong> {capture|pass-through}, <strong>-\-o-s</strong> {capture|pass-through}<a class="headerlink" href="#output-streams-capture-pass-through-o-s-capture-pass-through" title="Permalink to this headline"></a></h3>
<p>whether to capture and return outputs from ‘cmd’ in the record (‘stdout’, ‘stderr’) or just ‘pass-through’ to the screen (and thus absent from returned record). Constraints: value must be one of (‘capture’, ‘pass-through’) [Default: ‘pass-through’]</p>
</section>
<section id="chpwd-ds-pwd">
<h3><strong>-\-chpwd</strong> {ds|pwd}<a class="headerlink" href="#chpwd-ds-pwd" title="Permalink to this headline"></a></h3>
<p>‘ds’ will change working directory to the top of the corresponding dataset. With ‘pwd’ no change of working directory will happen. Note that for Python commands, due to use of threads, we do not allow chdir=ds to be used with jobs &gt; 1. Hint: use ‘ds’ and ‘refds’ objects’ methods to execute commands in the context of those datasets. Constraints: value must be one of (‘ds’, ‘pwd’) [Default: ‘ds’]</p>
</section>
<section id="safe-to-consume-auto-all-subds-done-superds-done-always">
<h3><strong>-\-safe-to-consume</strong> {auto|all-subds-done|superds-done|always}<a class="headerlink" href="#safe-to-consume-auto-all-subds-done-superds-done-always" title="Permalink to this headline"></a></h3>
<p>Important only in the case of parallel (jobs greater than 1) execution. ‘all- subds-done’ instructs to not consider superdataset until command finished execution in all subdatasets (it is the value in case of ‘auto’ if traversal is bottomup). ‘superds-done’ instructs to not process subdatasets until command finished in the super-dataset (it is the value in case of ‘auto’ in traversal is not bottom up, which is the default). With ‘always’ there is no constraint on either to execute in sub or super dataset. Constraints: value must be one of (‘auto’, ‘all-subds-done’, ‘superds-done’, ‘always’) [Default: ‘auto’]</p>
</section>
<section id="j-njobs-jobs-njobs">
<h3><strong>-J</strong> NJOBS, <strong>-\-jobs</strong> NJOBS<a class="headerlink" href="#j-njobs-jobs-njobs" title="Permalink to this headline"></a></h3>
<p>how many parallel jobs (where possible) to use. “auto” corresponds to the number defined by ‘datalad.runtime.max-annex-jobs’ configuration item NOTE: This option can only parallelize input retrieval (get) and output recording (save). DataLad does NOT parallelize your scripts for you. Constraints: value must be convertible to type ‘int’, or value must be one of (‘auto’,)</p>
</section>
<section id="version">
<h3><strong>-\-version</strong><a class="headerlink" href="#version" title="Permalink to this headline"></a></h3>
<p>show the module and its version which provides the command</p>
</section>
</section>
<section id="authors">
<h2>Authors<a class="headerlink" href="#authors" title="Permalink to this headline"></a></h2>
<p>datalad is developed by The DataLad Team and Contributors &lt;<a class="reference external" href="mailto:team&#37;&#52;&#48;datalad&#46;org">team<span>&#64;</span>datalad<span>&#46;</span>org</a>&gt;.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="datalad-download-url.html" class="btn btn-neutral float-left" title="datalad download-url" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="datalad-sshrun.html" class="btn btn-neutral float-right" title="datalad sshrun" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016-2022, DataLad team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>