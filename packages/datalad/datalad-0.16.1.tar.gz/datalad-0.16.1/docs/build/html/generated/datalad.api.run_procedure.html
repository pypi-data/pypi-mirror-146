<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>datalad.api.run_procedure &mdash; DataLad 0.15.3+529.gc81453444.dirty documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="datalad.api.clean" href="datalad.api.clean.html" />
    <link rel="prev" title="datalad.api.rerun" href="datalad.api.rerun.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> DataLad
            <img src="../_static/datalad_logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                0.15
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Change log</a></li>
<li class="toctree-l1"><a class="reference internal" href="../acknowledgements.html">Acknowledgments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../publications.html">Publications</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../background.html">Background and motivation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../related.html">Delineation from related solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basics.html">Basic principles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../credentials.html">Credentials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../metadata.html">Metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="../customization.html">Customization and extension of functionality</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/index.html">Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../cmdline.html">Command line reference</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../modref.html">Python module reference</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../modref.html#high-level-user-interface">High-level user interface</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../modref.html#dataset-operations">Dataset operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modref.html#metadata-handling">Metadata handling</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../modref.html#reproducible-execution">Reproducible execution</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="datalad.api.run.html">datalad.api.run</a></li>
<li class="toctree-l4"><a class="reference internal" href="datalad.api.rerun.html">datalad.api.rerun</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">datalad.api.run_procedure</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../modref.html#plumbing-commands">Plumbing commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modref.html#miscellaneous-commands">Miscellaneous commands</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../modref.html#support-functionality">Support functionality</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modref.html#configuration-management">Configuration management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modref.html#test-infrastructure">Test infrastructure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modref.html#command-line-interface-infrastructure">Command line interface infrastructure</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../config.html">Configuration</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">DataLad</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../modref.html">Python module reference</a> &raquo;</li>
      <li>datalad.api.run_procedure</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="datalad-api-run-procedure">
<h1>datalad.api.run_procedure<a class="headerlink" href="#datalad-api-run-procedure" title="Permalink to this headline"></a></h1>
<dl class="py function">
<dt class="sig sig-object py" id="datalad.api.run_procedure">
<span class="sig-prename descclassname"><span class="pre">datalad.api.</span></span><span class="sig-name descname"><span class="pre">run_procedure</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spec</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dataset</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">discover</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">help_proc</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#datalad.api.run_procedure" title="Permalink to this definition"></a></dt>
<dd><p>Run prepared procedures (DataLad scripts) on a dataset</p>
<p><em>Concept</em></p>
<p>A “procedure” is an algorithm with the purpose to process a dataset in a
particular way. Procedures can be useful in a wide range of scenarios,
like adjusting dataset configuration in a uniform fashion, populating
a dataset with particular content, or automating other routine tasks,
such as synchronizing dataset content with certain siblings.</p>
<p>Implementations of some procedures are shipped together with DataLad,
but additional procedures can be provided by 1) any DataLad extension,
2) any (sub-)dataset, 3) a local user, or 4) a local system administrator.
DataLad will look for procedures in the following locations and order:</p>
<p>Directories identified by the configuration settings</p>
<ul class="simple">
<li><p>‘datalad.locations.user-procedures’ (determined by
platformdirs.user_config_dir; defaults to ‘$HOME/.config/datalad/procedures’
on GNU/Linux systems)</p></li>
<li><p>‘datalad.locations.system-procedures’ (determined by
platformdirs.site_config_dir; defaults to ‘/etc/xdg/datalad/procedures’ on
GNU/Linux systems)</p></li>
<li><p>‘datalad.locations.dataset-procedures’</p></li>
</ul>
<p>and subsequently in the ‘resources/procedures/’ directories of any
installed extension, and, lastly, of the DataLad installation itself.</p>
<p>Please note that a dataset that defines
‘datalad.locations.dataset-procedures’ provides its procedures to
any dataset it is a subdataset of. That way you can have a collection of
such procedures in a dedicated dataset and install it as a subdataset into
any dataset you want to use those procedures with. In case of a naming
conflict with such a dataset hierarchy, the dataset you’re calling
run-procedures on will take precedence over its subdatasets and so on.</p>
<p>Each configuration setting can occur multiple times to indicate multiple
directories to be searched. If a procedure matching a given name is found
(filename without a possible extension), the search is aborted and this
implementation will be executed. This makes it possible for individual
datasets, users, or machines to override externally provided procedures
(enabling the implementation of customizable processing “hooks”).</p>
<p><em>Procedure implementation</em></p>
<p>A procedure can be any executable. Executables must have the appropriate
permissions and, in the case of a script, must contain an appropriate
“shebang” line. If a procedure is not executable, but its filename ends
with ‘.py’, it is automatically executed by the ‘python’ interpreter
(whichever version is available in the present environment). Likewise,
procedure implementations ending on ‘.sh’ are executed via ‘bash’.</p>
<p>Procedures can implement any argument handling, but must be capable
of taking at least one positional argument (the absolute path to the
dataset they shall operate on).</p>
<p>For further customization there are two configuration settings per procedure
available:</p>
<ul>
<li><p>‘datalad.procedures.&lt;NAME&gt;.call-format’
fully customizable format string to determine how to execute procedure
NAME (see also datalad-run).
It currently requires to include the following placeholders:</p>
<ul>
<li><p>‘{script}’: will be replaced by the path to the procedure</p></li>
<li><p>‘{ds}’: will be replaced by the absolute path to the dataset the
procedure shall operate on</p></li>
<li><p>‘{args}’: (not actually required) will be replaced by</p>
<p>all but the first element of <cite>spec</cite> if <cite>spec</cite> is a list or tuple
As an example the default format string for a call to a python script is:
“python {script} {ds} {args}”</p>
</li>
</ul>
</li>
<li><p>‘datalad.procedures.&lt;NAME&gt;.help’
will be shown on <cite>datalad run-procedure –help-proc NAME</cite> to provide a
description and/or usage info for procedure NAME</p></li>
</ul>
<p class="rubric">Examples</p>
<p>Find out which procedures are available on the current system:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">run_procedure</span><span class="p">(</span><span class="n">discover</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Run the ‘yoda’ procedure in the current dataset:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">run_procedure</span><span class="p">(</span><span class="n">spec</span><span class="o">=</span><span class="s1">&#39;cfg_yoda&#39;</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>spec</strong> – Name and possibly additional arguments of the to-be-executed
procedure. [PY: Can also be a dictionary coming from run-
procedure(discover=True).]. [Default: None]</p></li>
<li><p><strong>dataset</strong> (<a class="reference internal" href="datalad.api.Dataset.html#datalad.api.Dataset" title="datalad.api.Dataset"><em>Dataset</em></a><em> or </em><em>None</em><em>, </em><em>optional</em>) – specify the dataset to run the procedure on. An attempt is made to
identify the dataset based on the current working directory.
[Default: None]</p></li>
<li><p><strong>discover</strong> (<em>bool</em><em>, </em><em>optional</em>) – if given, all configured paths are searched for procedures and one
result record per discovered procedure is yielded, but no procedure
is executed. [Default: False]</p></li>
<li><p><strong>help_proc</strong> (<em>bool</em><em>, </em><em>optional</em>) – if given, get a help message for procedure NAME from config setting
datalad.procedures.NAME.help. [Default: False]</p></li>
<li><p><strong>on_failure</strong> (<em>{'ignore'</em><em>, </em><em>'continue'</em><em>, </em><em>'stop'}</em><em>, </em><em>optional</em>) – behavior to perform on failure: ‘ignore’ any failure is reported,
but does not cause an exception; ‘continue’ if any failure occurs an
exception will be raised at the end, but processing other actions
will continue for as long as possible; ‘stop’: processing will stop
on first failure and an exception is raised. A failure is any result
with status ‘impossible’ or ‘error’. Raised exception is an
IncompleteResultsError that carries the result dictionaries of the
failures in its <cite>failed</cite> attribute. [Default: ‘continue’]</p></li>
<li><p><strong>result_filter</strong> (<em>callable</em><em> or </em><em>None</em><em>, </em><em>optional</em>) – if given, each to-be-returned status dictionary is passed to this
callable, and is only returned if the callable’s return value does
not evaluate to False or a ValueError exception is raised. If the
given callable supports <cite>**kwargs</cite> it will additionally be passed
the keyword arguments of the original API call. [Default: None]</p></li>
<li><p><strong>result_renderer</strong> – select rendering mode command results. ‘tailored’ enables a command-
specific rendering style that is typically tailored to human
consumption, if there is one for a specific command, or otherwise
falls back on the the ‘generic’ result renderer; ‘generic’ renders
each result in one line  with key info like action, status, path,
and an optional message); ‘json’ a complete JSON line serialization
of the full result record; ‘json_pp’ like ‘json’, but pretty-printed
spanning multiple lines; ‘disabled’ turns off result rendering
entirely; ‘&lt;template&gt;’ reports any value(s) of any result properties
in any format indicated by the template (e.g. ‘{path}’, compare with
JSON output for all key-value choices). The template syntax follows
the Python “format() language”. It is possible to report individual
dictionary values, e.g. ‘{metadata[name]}’. If a 2nd-level key
contains a colon, e.g. ‘music:Genre’, ‘:’ must be substituted by ‘#’
in the template, like so: ‘{metadata[music#Genre]}’. [Default:
‘tailored’]</p></li>
<li><p><strong>result_xfm</strong> (<em>{'datasets'</em><em>, </em><em>'successdatasets-or-none'</em><em>, </em><em>'paths'</em><em>, </em><em>'relpaths'</em><em>, </em><em>'metadata'}</em><em> or </em><em>callable</em><em> or </em><em>None</em><em>, </em><em>optional</em>) – if given, each to-be-returned result status dictionary is passed to
this callable, and its return value becomes the result instead. This
is different from <cite>result_filter</cite>, as it can perform arbitrary
transformation of the result value. This is mostly useful for top-
level command invocations that need to provide the results in a
particular format. Instead of a callable, a label for a pre-crafted
result transformation can be given. [Default: None]</p></li>
<li><p><strong>return_type</strong> (<em>{'generator'</em><em>, </em><em>'list'</em><em>, </em><em>'item-or-list'}</em><em>, </em><em>optional</em>) – return value behavior switch. If ‘item-or-list’ a single value is
returned instead of a one-item return value list, or a list in case
of multiple return values. <cite>None</cite> is return in case of an empty
list. [Default: ‘list’]</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="datalad.api.rerun.html" class="btn btn-neutral float-left" title="datalad.api.rerun" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="datalad.api.clean.html" class="btn btn-neutral float-right" title="datalad.api.clean" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016-2022, DataLad team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>