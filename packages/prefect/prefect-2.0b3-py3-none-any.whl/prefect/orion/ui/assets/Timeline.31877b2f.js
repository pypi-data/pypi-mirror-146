var I=Object.defineProperty,W=Object.defineProperties;var P=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var T=Object.prototype.hasOwnProperty,M=Object.prototype.propertyIsEnumerable;var x=(e,t,i)=>t in e?I(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,S=(e,t)=>{for(var i in t||(t={}))T.call(t,i)&&x(e,i,t[i]);if(w)for(var i of w(t))M.call(t,i)&&x(e,i,t[i]);return e},y=(e,t)=>W(e,P(t));var a=(e,t,i)=>(x(e,typeof t!="symbol"?t+"":t,i),i);import{ac as h,ad as B,ae as L,af as A,ag as R,c as q,ah as H,ai as O,aj as $,ak as j,al as G,am as N,an as z,ao as E,ap as F,aq as Y,ar as c,as as V,_ as J,y as K,o as d,h as g,l as _,H as C,p as m,at as f,F as Q,au as U,W as p}from"./index.af9a7d5e.js";var X=Object.defineProperty,Z=Object.getOwnPropertyDescriptor,tt=(e,t,i,s)=>{for(var r=s>1?void 0:s?Z(t,i):t,n=e.length-1,l;n>=0;n--)(l=e[n])&&(r=(s?l(t,i,r):l(r))||r);return s&&r&&X(t,i,r),r};const et=h(".%L"),it=h("%-I:%M:%S %p"),st=h("%-I:%M %p"),at=h("%-I %p"),rt=h("%a %d"),nt=h("%b %d"),lt=h("%B"),ot=h("%Y"),ht=e=>(j(e)<e?et:G(e)<e?it:N(e)<e?st:z(e)<e?at:E(e)<e?F(e)<e?rt:nt:Y(e)<e?lt:ot)(e);class dt{constructor(){a(this,"axisPosition",c({required:!1,default:"bottom"}));a(this,"backgroundColor",c({required:!1,default:null}));a(this,"items",c({required:!0}));a(this,"maxEndTime",c({required:!1,default:null}));a(this,"hideHeader",c({required:!1,default:()=>!1,type:Boolean}));a(this,"padding",c({required:!1,default:{top:0,bottom:0,middle:0,left:0,right:0}}))}}let v=class extends B(L).with(dt){constructor(){super(...arguments);a(this,"disableLeftScrollButton",!0);a(this,"disableRightScrollButton",!0);a(this,"computedItems",[]);a(this,"axisHeight",this.hideHeader?20:38);a(this,"intervalHeight",20);a(this,"intervalWidth",125);a(this,"xScale",A());a(this,"yScale",R());a(this,"rows",[]);a(this,"scrollContainer",q());a(this,"axisSvg",null);a(this,"gridSelection",null);a(this,"xAxisGroup",null);a(this,"backgroundRect",null);a(this,"xAxis",t=>t.transition().duration(250).attr("class","x-axis").call(O(this.xScale).ticks(this.numberIntervals).tickFormat(ht).tickSizeOuter(0).tickSizeInner(0)))}get interval(){return Object.entries(H).sort(([,t],[,i])=>i-t).reduce(([t,i],[s,r])=>this.totalSeconds<r?[s,r]:[t,i])[0]}get numberIntervals(){return Math.ceil(Math.max(this.totalSeconds/H[this.interval],this.width/this.intervalWidth)/this.intervalWidth)*this.intervalWidth}get numberRows(){return Math.max(this.rows.length,Math.ceil(this.height/this.intervalHeight))}get start(){return new Date(new Date(Math.min(...this.sortedItems.map(t=>new Date(t.start_time).getTime()))).getTime())}get end(){return new Date(this.maxEndTime?this.maxEndTime:new Date(Math.max(...this.sortedItems.map(t=>t.end_time?new Date(t.end_time).getTime():Date.now()))).getTime())}get totalSeconds(){return this.end.getTime()/1e3-this.start.getTime()/1e3}get chartHeight(){return this.container?this.numberRows*this.intervalHeight-this.paddingY:0}get chartWidth(){return Math.max(this.numberIntervals*this.intervalWidth,this.width)-this.paddingY}get sortedItems(){return this.items.sort((t,i)=>new Date(t.start_time).getTime()-new Date(i.start_time).getTime()).filter(t=>t.state_type!=="PENDING"&&t.start_time)}get nodeContainerStyle(){return{height:`${this.chartHeight}px`,width:`${this.chartWidth}px`}}get timelineAxisPosition(){return!this.container||this.axisPosition=="top"?{height:`${this.axisHeight}px`}:{height:`${this.axisHeight}px`,top:`${this.container.offsetHeight-this.axisHeight/2}px`}}resize(){this.update()}mounted(){this.createChart(),this.update(),this.handleScroll()}update(){var t;!((t=this.items)!=null&&t.length)||requestAnimationFrame(()=>{this.updateChart(),this.updateScales(),this.updateNodes(),this.updateGrid()})}updated(){(!this.svg||!this.gridSelection)&&this.createChart()}updateScales(){this.xScale.domain([new Date(this.start),new Date(this.end)]).range([0,this.chartWidth]).clamp(!0),this.xAxisGroup.call(this.xAxis)}createChart(){this.svg=$(`#${this.id}`),this.axisSvg=$(`#${this.id}-axis`),this.xAxisGroup=this.axisSvg.append("g"),this.backgroundRect=this.svg.append("g"),this.backgroundRect.append("rect").attr("fill",this.backgroundColor?`var(--${this.backgroundColor})`:"transparent").attr("rx",4).attr("width","100%").attr("height","100%"),this.gridSelection=this.svg.append("g")}updateChart(){this.svg.attr("viewbox",`0, 0, ${this.chartWidth}, ${this.chartHeight}`).style("width",`${this.chartWidth}px`).style("height",`${this.chartHeight}px`),this.axisSvg.attr("viewbox",`0, 0, ${this.chartWidth}, ${this.axisHeight}`).style("width",`${this.chartWidth}px`).style("height",`${this.axisHeight}px`)}updateNodes(){const t=[];this.computedItems=[...this.sortedItems].map(i=>{const s=new Date(i.start_time),r=i.end_time?new Date(i.end_time):new Date,n=this.xScale(s),l=Math.max(16,this.xScale(r)-this.xScale(s)),o=8,k=this.axisPosition=="top"?o+this.axisHeight:o;let u=0;for(;;){const b=t[u];if(b){const[,D]=b;if(n>D){t[u][1]=n+l;break}else{u++;continue}}else{t[u]=[n,n+l];break}}return y(S({},i),{style:{height:`${8}px`,left:`${n}px`,top:`${u*this.intervalHeight}px`,transform:`translate(0, ${k}px)`,width:`${l}px`}})}),this.rows=t}updateGrid(){this.gridSelection.selectAll(".grid-line.grid-x").data(Array.from({length:this.numberRows})).join(t=>t.append("line").attr("id",(i,s)=>`grid-line-x-${s}`).attr("class","grid-line grid-x").attr("stroke","var(--blue-20)").attr("x1",0).attr("x2",this.chartWidth).attr("y1",(i,s)=>s*this.intervalHeight).attr("y2",(i,s)=>s*this.intervalHeight),t=>t.attr("x1",0).attr("x2",this.chartWidth).attr("y1",(i,s)=>s*this.intervalHeight).attr("y2",(i,s)=>s*this.intervalHeight),t=>t.remove()),this.gridSelection.selectAll(".grid-line.grid-y").data(this.xScale.ticks(this.numberIntervals)).join(t=>t.append("line").attr("id",(i,s)=>`x-${s}`).attr("class","grid-line grid-y").attr("stroke","var(--blue-20)").attr("x1",(i,s)=>this.xScale(i)).attr("x2",(i,s)=>this.xScale(i)).attr("y1",0).attr("y2",this.chartHeight),t=>t.attr("x1",(i,s)=>this.xScale(i)).attr("x2",(i,s)=>this.xScale(i)).attr("y1",0).attr("y2",this.chartHeight),t=>t.remove())}handleScroll(){this.disableLeftScrollButton=this.scrollContainer.scrollLeft<=0,this.disableRightScrollButton=this.scrollContainer.scrollLeft>=this.scrollContainer.scrollWidth}panLeft(){this.scrollContainer.scroll({left:this.scrollContainer.scrollLeft-this.width,behavior:"smooth"})}panRight(){this.scrollContainer.scroll({left:this.scrollContainer.scrollLeft+this.width,behavior:"smooth"})}};v=tt([V({watch:{items(){this.update()},interval(){this.update()}}})],v);const ct=v,ut=["id"],gt=["id"],mt=["id"];function pt(e,t,i,s,r,n){const l=K("m-icon-button");return d(),g("div",{ref:"container",class:p(["component-container timeline d-flex flex-column",{"header-hidden":e.hideHeader,"header-visible":!e.hideHeader,"axis-bottom":e.axisPosition=="bottom","axis-top":e.axisPosition=="top"}]),style:{"max-height":"inherit"}},[e.hideHeader?C("",!0):(d(),_(l,{key:0,class:"pan-button left bg--white",icon:"pi pi-arrow-left-s-line pi-lg",flat:"",disabled:e.disableLeftScrollButton,onClick:e.panLeft},null,8,["disabled","onClick"])),e.hideHeader?C("",!0):(d(),_(l,{key:1,class:"pan-button right bg--white",icon:"pi pi-arrow-right-s-line pi-lg",flat:"",disabled:e.disableRightScrollButton,onClick:e.panRight},null,8,["disabled","onClick"])),m("div",{ref:"scrollContainer",class:"scroll-container",onScroll:t[0]||(t[0]=(...o)=>e.handleScroll&&e.handleScroll(...o))},[m("div",{class:"node-container",style:f(e.nodeContainerStyle)},[(d(!0),g(Q,null,U(e.computedItems,o=>(d(),g("div",{id:`node-${o.id}`,key:o.id,class:p(["node correct-text",[`${o.state.type.toLowerCase()}-bg`]]),style:f(o.style),tabindex:"0"},null,14,ut))),128)),m("div",{class:p(["timeline-axis",{"shadow-sm":e.axisPosition=="top"}]),style:f(e.timelineAxisPosition)},[(d(),g("svg",{id:`${e.id}-axis`,ref:"chart-axis"},null,8,gt))],6),(d(),g("svg",{id:e.id,class:"timeline-background"},null,8,mt))],4)],544),m("div",{class:p(["border-container",{top:e.axisPosition=="top",bottom:e.axisPosition=="bottom"}])},null,2)],2)}var vt=J(ct,[["render",pt],["__scopeId","data-v-689e583e"]]);export{vt as T};
